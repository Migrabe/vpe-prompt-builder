<!DOCTYPE html>
<!-- saved from url=(0045)https://migrabe.github.io/vpe-prompt-builder/ -->
<html lang="ru">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">



  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VPE Prompt Builder 2026 ‚Äî v3.1 Fixed</title>
  <link rel="preconnect" href="https://fonts.googleapis.com/" crossorigin="">

  <noscript>
    <link rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Manrope:wght@400;600;800&display=swap">
  </noscript>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box
    }

    :root {
      --bg-deep: #0f0f14;
      --bg-card: #1a1a24;
      --bg-card-hover: #22222f;
      --bg-section: #13131b;
      --border: #2a2a3a;
      --border-active: #6c5ce7;
      --accent: #6c5ce7;
      --accent-light: #a29bfe;
      --accent-glow: rgba(108, 92, 231, .25);
      --green: #00cec9;
      --green-glow: rgba(0, 206, 201, .2);
      --orange: #fdcb6e;
      --orange-glow: rgba(253, 203, 110, .15);
      --red: #ff7675;
      --text-primary: #e8e8f0;
      --text-secondary: #8888a0;
      --text-muted: #6f6f88;
      --radius: 10px;
      --radius-lg: 14px;
    }

    html {
      scroll-behavior: smooth
    }

    body {
      font-family: 'Manrope', -apple-system, BlinkMacSystemFont, system-ui, 'Segoe UI', sans-serif;
      background: var(--bg-deep);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.5;
    }

    /* === LAYOUT === */
    .app {
      display: flex;
      flex-direction: column;
      min-height: 100vh
    }

    .header {
      background: var(--bg-section);
      border-bottom: 1px solid var(--border);
      padding: 20px 28px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 100;
      -webkit-backdrop-filter: blur(12px);
      backdrop-filter: blur(12px);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 14px
    }

    .logo {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--accent), var(--green));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: 800;
      color: #fff;
    }

    .header h1 {
      font-size: 1.3em;
      font-weight: 800;
      letter-spacing: -.02em
    }

    .header h1 span {
      color: var(--accent-light);
      font-weight: 400;
      font-size: .75em;
      margin-left: 8px
    }

    .header-right {
      display: flex;
      gap: 8px
    }

    .main-grid {
      display: grid;
      grid-template-columns: 1fr 480px;
      flex: 1;
      overflow: hidden;
    }

    .left-panel {
      padding: 24px;
      overflow-y: auto;
      height: calc(100vh - 72px);
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .right-panel {
      border-left: 1px solid var(--border);
      padding: 24px;
      overflow-y: auto;
      height: calc(100vh - 72px);
      display: flex;
      flex-direction: column;
      gap: 16px;
      background: var(--bg-section);
    }

    /* === SECTIONS === */
    .section {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 18px;
      transition: border-color .2s;
    }

    .section:hover {
      border-color: #3a3a4f
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 14px;
    }

    .section-header h2 {
      font-size: 1em;
      font-weight: 800;
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-primary);
    }

    .section-header h2 .icon {
      width: 28px;
      height: 28px;
      border-radius: 8px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      flex-shrink: 0;
    }

    .icon-purple {
      background: rgba(108, 92, 231, .15);
      color: var(--accent-light)
    }

    .icon-green {
      background: var(--green-glow);
      color: var(--green)
    }

    .icon-orange {
      background: var(--orange-glow);
      color: var(--orange)
    }

    .icon-red {
      background: rgba(255, 118, 117, .15);
      color: var(--red)
    }

    .mode-badge {
      font-size: .7em;
      font-weight: 600;
      padding: 3px 8px;
      border-radius: 6px;
      background: rgba(108, 92, 231, .12);
      color: var(--accent-light);
      border: 1px solid rgba(108, 92, 231, .2);
      letter-spacing: .03em;
      text-transform: uppercase;
    }

    .mode-badge.multi {
      background: var(--green-glow);
      color: var(--green);
      border-color: rgba(0, 206, 201, .25)
    }

    .mode-badge.pa {
      background: var(--orange-glow);
      color: var(--orange);
      border-color: rgba(253, 203, 110, .25)
    }

    .sub-label {
      display: block;
      font-size: .85em;
      font-weight: 700;
      color: var(--text-secondary);
      margin: 12px 0 8px;
    }

    /* === BUTTONS === */
    .option-group {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 8px;
    }

    .option-btn {
      padding: 10px 12px;
      border: 1px solid var(--border);
      background: var(--bg-card);
      border-radius: var(--radius);
      cursor: pointer;
      transition: all .2s;
      font-size: .85em;
      text-align: left;
      position: relative;
      color: var(--text-primary);
      font-family: inherit;
      line-height: 1.3;
    }

    .option-btn:hover {
      border-color: var(--accent);
      background: var(--bg-card-hover);
      transform: translateY(-1px);
      box-shadow: 0 4px 16px rgba(0, 0, 0, .3);
    }

    .option-btn.active {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
      font-weight: 700;
      box-shadow: 0 0 20px var(--accent-glow);
    }

    .option-btn:disabled {
      opacity: .4;
      cursor: not-allowed;
      transform: none !important
    }

    /* Section-level disable when Quick Style preset is active */
    .disabled-section {
      position: relative;
      opacity: .35;
      pointer-events: none;
      user-select: none;
    }

    .disabled-section::after {
      content: 'üîí –°–Ω–∏–º–∏—Ç–µ –ø—Ä–µ—Å–µ—Ç –¥–ª—è —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏';
      position: absolute;
      top: 8px;
      right: 12px;
      font-size: .72em;
      color: var(--orange);
      background: rgba(15, 15, 20, .85);
      padding: 3px 10px;
      border-radius: 6px;
      pointer-events: none;
      z-index: 5;
    }

    .slot-tag {
      position: absolute;
      top: 6px;
      right: 6px;
      padding: 1px 6px;
      border-radius: 6px;
      font-size: .65em;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: .04em;
    }

    .slot-tag.primary {
      background: var(--green);
      color: #000
    }

    .slot-tag.accent {
      background: var(--orange);
      color: #000
    }

    /* === INPUTS === */
    .input-field {
      width: 100%;
      padding: 11px 14px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: .92em;
      transition: all .2s;
      background: var(--bg-deep);
      color: var(--text-primary);
      font-family: inherit;
    }

    .input-field:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-glow);
    }

    .input-field::placeholder {
      color: var(--text-muted)
    }

    textarea.input-field {
      resize: vertical;
      min-height: 80px
    }

    /* Tooltip ? */
    .help-tip {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: rgba(108, 92, 231, .18);
      color: var(--accent-light);
      font-size: .65em;
      font-weight: 800;
      cursor: help;
      position: relative;
      flex-shrink: 0;
      border: 1px solid rgba(108, 92, 231, .3);
      margin-left: 4px;
      line-height: 1
    }

    .help-tip .tip-text {
      visibility: hidden;
      opacity: 0;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: calc(100% + 8px);
      width: 320px;
      background: #1f1f2e;
      color: var(--text-primary);
      border: 1px solid var(--accent);
      border-radius: 10px;
      padding: 12px 14px;
      font-size: 12px;
      font-weight: 400;
      line-height: 1.5;
      z-index: 200;
      box-shadow: 0 8px 32px rgba(0, 0, 0, .6);
      pointer-events: none;
      transition: opacity .2s;
      text-align: left
    }

    .help-tip .tip-text::after {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 6px solid transparent;
      border-top-color: var(--accent)
    }

    .help-tip:hover .tip-text {
      visibility: visible;
      opacity: 1
    }

    /* Ref extract */
    .ref-extract-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px
    }

    .ref-extract-label {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: .78em;
      color: var(--text-secondary);
      background: var(--bg-deep);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 4px 8px;
      cursor: pointer;
      transition: all .2s;
      user-select: none
    }

    .ref-extract-label:has(input:checked),
    .ref-extract-label.ext-checked {
      border-color: var(--accent);
      color: var(--accent-light);
      background: rgba(108, 92, 231, .08)
    }

    .ref-extract-label input {
      width: 13px;
      height: 13px;
      accent-color: var(--accent)
    }

    .warn-box {
      background: rgba(253, 203, 110, .08);
      border-left: 3px solid var(--orange);
      padding: 10px 14px;
      border-radius: 0 var(--radius) var(--radius) 0;
      font-size: .82em;
      color: var(--orange);
      margin-top: 8px;
      display: none
    }

    .hint {
      color: var(--text-muted);
      font-size: .8em;
      margin-top: 6px;
      line-height: 1.4
    }

    /* === SCROLLBAR (Safari/Chrome) === */
    .output-box::-webkit-scrollbar,
    .json-box::-webkit-scrollbar {
      width: 6px;
    }

    .output-box::-webkit-scrollbar-track,
    .json-box::-webkit-scrollbar-track {
      background: transparent;
    }

    .output-box::-webkit-scrollbar-thumb,
    .json-box::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 3px;
    }

    /* === TOUCH (iOS) === */
    .left-panel,
    .right-panel {
      -webkit-overflow-scrolling: touch;
    }

    textarea,
    input[type="text"],
    input[type="number"] {
      font-size: 16px !important;
    }

    /* Prevent iOS zoom on focus */

    /* === RANGE INPUT (iOS) === */
    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 6px;
      background: var(--border);
      border-radius: 3px;
      outline: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--accent);
      cursor: pointer;
    }

    input[type="range"]::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--accent);
      cursor: pointer;
      border: none;
    }

    /* === TOGGLES === */
    .toggle-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap
    }

    .toggle-label {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      user-select: none;
      background: var(--bg-deep);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 9px 12px;
      font-size: .85em;
      color: var(--text-secondary);
      transition: all .2s;
    }

    .toggle-label:has(input:checked),
    .toggle-label.checked {
      border-color: var(--accent);
      color: var(--text-primary);
      background: rgba(108, 92, 231, .08);
    }

    .toggle-label input {
      width: 16px;
      height: 16px;
      accent-color: var(--accent);
    }

    /* === REFERENCE IMAGES === */
    .ref-upload {
      width: 100%;
      padding: 24px;
      border: 2px dashed var(--border);
      border-radius: var(--radius-lg);
      cursor: pointer;
      background: var(--bg-deep);
      text-align: center;
      color: var(--text-muted);
      font-size: .9em;
      transition: all .2s;
    }

    .ref-upload:hover {
      border-color: var(--accent);
      color: var(--text-secondary)
    }

    .image-preview-card {
      position: relative;
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      background: var(--bg-deep);
      display: grid;
      grid-template-columns: 140px 1fr;
      gap: 12px;
      padding: 12px;
      margin-top: 10px;
    }

    .image-preview-card img {
      width: 140px;
      height: 100px;
      object-fit: cover;
      border-radius: 8px;
    }

    .image-preview-details {
      display: flex;
      flex-direction: column;
      gap: 8px
    }

    .image-preview-info {
      font-size: .8em;
      color: var(--text-muted)
    }

    .image-remove-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: var(--red);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 26px;
      height: 26px;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all .2s;
    }

    .image-remove-btn:hover {
      transform: scale(1.1);
      filter: brightness(1.1)
    }

    .image-description-input {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: .82em;
      font-family: inherit;
      resize: vertical;
      min-height: 50px;
      background: var(--bg-card);
      color: var(--text-primary);
      transition: border .2s;
    }

    .image-description-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px var(--accent-glow)
    }

    /* Slider */
    input[type=range] {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 6px;
      border-radius: 4px;
      background: var(--border);
      outline: none;
      margin: 8px 0;
    }

    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--accent);
      cursor: pointer;
      box-shadow: 0 0 8px var(--accent-glow);
    }

    /* === RIGHT PANEL === */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 14px;
      text-align: center;
    }

    .stat-value {
      font-size: 1.8em;
      font-weight: 800;
      background: linear-gradient(135deg, var(--accent-light), var(--green));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .stat-label {
      font-size: .75em;
      color: var(--text-muted);
      margin-top: 2px;
      text-transform: uppercase;
      letter-spacing: .05em
    }

    /* Active tags */
    .tag-area {
      min-height: 60px;
      background: var(--bg-deep);
      border: 1px dashed var(--border);
      border-radius: var(--radius);
      padding: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-content: flex-start;
    }

    .tag-item {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: .75em;
      font-weight: 600;
      background: rgba(108, 92, 231, .12);
      color: var(--accent-light);
      border: 1px solid rgba(108, 92, 231, .2);
    }

    .tag-item.primary {
      background: var(--green-glow);
      color: var(--green);
      border-color: rgba(0, 206, 201, .25)
    }

    .tag-item.accent {
      background: var(--orange-glow);
      color: var(--orange);
      border-color: rgba(253, 203, 110, .25)
    }

    .tag-item .remove {
      cursor: pointer;
      font-weight: 900;
      color: var(--red);
      line-height: 1;
      user-select: none;
      font-size: 1.1em;
    }

    .tag-item .remove:hover {
      filter: brightness(1.2)
    }

    /* Output box */
    .output-box {
      background: var(--bg-deep);
      color: var(--green);
      padding: 16px;
      border-radius: var(--radius);
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: .82em;
      line-height: 1.7;
      overflow: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
      border: 1px solid var(--border);
      min-height: 200px;
      max-height: 400px;
      flex: 1;
    }

    .output-box.empty {
      color: var(--text-muted);
      font-style: italic
    }

    .json-box {
      background: var(--bg-deep);
      color: var(--accent-light);
      padding: 16px;
      border-radius: var(--radius);
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: .78em;
      line-height: 1.6;
      overflow: auto;
      white-space: pre;
      border: 1px solid var(--border);
      max-height: 300px;
    }

    /* Format tabs */
    .format-tabs {
      display: flex;
      gap: 4px;
      background: var(--bg-deep);
      border-radius: 8px;
      padding: 3px;
      border: 1px solid var(--border);
      margin-bottom: 12px;
    }

    .format-tab {
      flex: 1;
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      font-size: .82em;
      font-weight: 700;
      cursor: pointer;
      background: transparent;
      color: var(--text-muted);
      font-family: inherit;
      transition: all .2s;
    }

    .format-tab.active {
      background: var(--accent);
      color: #fff
    }

    .format-tab:hover:not(.active) {
      color: var(--text-primary)
    }

    /* Action buttons */
    .action-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap
    }

    .btn {
      flex: 1;
      padding: 12px 16px;
      border: none;
      border-radius: var(--radius);
      font-size: .88em;
      font-weight: 700;
      cursor: pointer;
      font-family: inherit;
      transition: all .2s;
      min-width: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn:hover {
      transform: translateY(-1px)
    }

    .btn:active {
      transform: translateY(0)
    }

    .btn-accent {
      background: var(--accent);
      color: #fff
    }

    .btn-accent:hover {
      box-shadow: 0 4px 20px var(--accent-glow);
      filter: brightness(1.1)
    }

    .btn-green {
      background: var(--green);
      color: #000
    }

    .btn-green:hover {
      filter: brightness(1.1)
    }

    .btn-ghost {
      background: var(--bg-card);
      color: var(--text-primary);
      border: 1px solid var(--border)
    }

    .btn-ghost:hover {
      border-color: var(--text-muted)
    }

    .btn-red {
      background: rgba(255, 118, 117, .12);
      color: var(--red);
      border: 1px solid rgba(255, 118, 117, .2)
    }

    .btn-red:hover {
      background: rgba(255, 118, 117, .2)
    }

    /* Notification */
    .notification {
      position: fixed;
      bottom: 24px;
      right: 24px;
      padding: 12px 20px;
      border-radius: var(--radius);
      font-size: .88em;
      font-weight: 700;
      box-shadow: 0 8px 32px rgba(0, 0, 0, .4);
      opacity: 0;
      transform: translateY(20px);
      transition: all .3s;
      z-index: 1000;
      font-family: inherit;
    }

    .notification.show {
      opacity: 1;
      transform: translateY(0)
    }

    .notification.success {
      background: var(--green);
      color: #000
    }

    .notification.warn {
      background: var(--orange);
      color: #000
    }

    .notification.err {
      background: var(--red);
      color: #fff
    }

    /* Warning/info boxes */
    .info-box {
      background: rgba(108, 92, 231, .08);
      border-left: 3px solid var(--accent);
      padding: 10px 14px;
      border-radius: 0 var(--radius) var(--radius) 0;
      font-size: .85em;
      color: var(--accent-light);
      margin-top: 8px;
    }

    /* Prompt format indicator */
    .format-indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: .75em;
      color: var(--text-muted);
      padding: 4px 10px;
      border-radius: 6px;
      background: var(--bg-deep);
      border: 1px solid var(--border);
    }

    .format-indicator .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--green);
    }

    /* Responsive */
    @media (max-width: 1100px) {
      .main-grid {
        grid-template-columns: 1fr
      }

      .right-panel {
        border-left: none;
        border-top: 1px solid var(--border);
        height: auto;
        max-height: none
      }

      .left-panel {
        height: auto;
        max-height: none
      }

      .image-preview-card {
        grid-template-columns: 1fr
      }

      .image-preview-card img {
        width: 100%;
        height: 180px
      }
    }

    @media (max-width: 600px) {
      .header {
        padding: 14px 16px;
        flex-direction: column;
        gap: 10px
      }

      .left-panel,
      .right-panel {
        padding: 14px
      }

      .option-group {
        grid-template-columns: repeat(auto-fill, minmax(130px, 1fr))
      }

      .stats-row {
        grid-template-columns: 1fr 1fr 1fr
      }
    }

    /* Disabled section style */
    .disabled-section {
      opacity: 0.4;
      pointer-events: none;
      filter: grayscale(100%);
      position: relative;
    }

    .disabled-section::after {
      content: "–û—Ç–∫–ª—é—á–µ–Ω–æ –≤ —Ä–µ–∂–∏–º–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.7);
      color: #fff;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 0.9em;
      font-weight: bold;
      pointer-events: none;
    }

    /* Conflict-disabled buttons */
    .option-btn.conflict-disabled {
      opacity: 0.25;
      cursor: not-allowed;
      transform: none !important;
      pointer-events: none;
      position: relative;
    }

    .option-btn.conflict-disabled::after {
      content: "‚ö†";
      position: absolute;
      top: 2px;
      right: 4px;
      font-size: 0.65em;
      opacity: 0.7;
    }

    /* === UX FIXES (visibility + stability) === */
    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    .option-btn:focus-visible,
    .format-tab:focus-visible,
    .btn:focus-visible,
    .toggle-label:focus-within {
      outline: 2px solid var(--accent-light);
      outline-offset: 2px;
    }

    /* Make selected buttons more obvious (extra ring) */
    .option-btn.active {
      box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.12), 0 0 20px var(--accent-glow);
    }

    /* Prevent horizontal drift while dragging sliders / trackpads */
    html,
    body {
      width: 100%;
      overflow-x: hidden;
    }

    .main-grid {
      width: 100%;
      max-width: 100vw;
    }

    .left-panel,
    .right-panel {
      overflow-x: hidden;
      min-width: 0;
    }

    input[type="range"] {
      touch-action: pan-y;
    }
  </style>
  <style type="text/css" id="operaUserStyle"></style>
  <style type="text/css"></style>
</head>

<body>
  <div class="app">

    <!-- HEADER -->
    <div class="header">
      <div style="display:flex;align-items:center;gap:12px;">
        <span style="font-size:1.6em;">üé®</span>
        <div>
          <div style="font-weight:900;font-size:1.15em;letter-spacing:-.5px;">VPE Prompt Builder</div>
          <div style="font-size:.78em;color:var(--text-muted);">Visual Prompt Engineering ‚Äî v3.1</div>
        </div>
      </div>
      <div style="display:flex;gap:8px;align-items:center;">
        <button class="action-btn" onclick="resetAll()" title="–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë">üîÑ –°–±—Ä–æ—Å</button>
      </div>
    </div>

    <div class="main-grid">
      <!-- LEFT PANEL -->
      <div class="left-panel">

        <!-- Quick Style Presets (moved to top for priority access) -->
        <div class="section" id="quickStyleSection">
          <div class="section-header">
            <h2><span class="icon icon-purple">üé®</span> –ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–µ—Å–µ—Ç—ã <span class="help-tip">?<span
                  class="tip-text">–°—Ç–∏–ª–µ–≤—ã–µ –ø—Ä–µ—Å–µ—Ç—ã –¥–æ–±–∞–≤–ª—è—é—Ç –ø–æ–ª–Ω—ã–π –±–ª–æ–∫ –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∏–ª—è –≤ –ø—Ä–æ–º–ø—Ç. –í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω ‚Äî –æ–Ω
                  –∑–∞–¥–∞—Å—Ç –æ—Å–≤–µ—â–µ–Ω–∏–µ, —Ü–≤–µ—Ç, —Ç–µ–∫—Å—Ç—É—Ä—É –∏ –∞—Ç–º–æ—Å—Ñ–µ—Ä—É. –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –ø—Ä–µ—Å–µ—Ç–∞ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ–Ω—é (–∫—Ä–æ–º–µ –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è
                  —Å—Ç–æ—Ä–æ–Ω) –æ—Ç–∫–ª—é—á–∞—é—Ç—Å—è. –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º —Å –∞–≤—Ç–æ—Ä—Å–∫–∏–º–∏ —Å—Ç–∏–ª—è–º–∏ (–§–æ—Ç–æ/–ö–∏–Ω–æ/–†–µ–∂–∏—Å—Å—ë—Ä).</span></span></h2>
            <span class="mode-badge">single</span>
          </div>
          <div class="option-group">
            <button class="option-btn" data-group="quickStyle" data-value="true-detective"
              title="HBO Noir aesthetic, harsh sun, swampy greens">üïµÔ∏è True Detective</button>
            <button class="option-btn" data-group="quickStyle" data-value="game-of-thrones"
              title="Epic fantasy, cold lighting, muted medieval tones">‚öîÔ∏è Game of Thrones</button>
            <button class="option-btn" data-group="quickStyle" data-value="the-last-of-us"
              title="Post-apocalyptic, overgrown nature, emotional light">üåø The Last of Us</button>
            <button class="option-btn" data-group="quickStyle" data-value="stranger-things"
              title="80s nostalgia, neon fog, warm suburban interiors">üö≤ Stranger Things</button>
            <button class="option-btn" data-group="quickStyle" data-value="the-crown"
              title="Royal elegance, rich jewel tones, soft natural light">üëë The Crown</button>
            <button class="option-btn" data-group="quickStyle" data-value="wednesday"
              title="Gothic dark academia, Tim Burton style, cool tones">üï∑Ô∏è Wednesday</button>
            <button class="option-btn" data-group="quickStyle" data-value="blade-runner-2049"
              title="Neo-noir cyberpunk, volumetric fog, orange/teal">ü§ñ Blade Runner 2049</button>
            <button class="option-btn" data-group="quickStyle" data-value="grand-budapest-hotel"
              title="Wes Anderson symmetry, pastel colors, whimsical">üè® Grand Budapest</button>
            <button class="option-btn" data-group="quickStyle" data-value="in-the-mood-for-love"
              title="Wong Kar-wai romance, lush reds, moody shadows">üèÆ In the Mood for Love</button>
            <button class="option-btn" data-group="quickStyle" data-value="mad-max-fury-road"
              title="High contrast desert action, saturated teal & orange">üèéÔ∏è Mad Max Fury</button>
            <button class="option-btn" data-group="quickStyle" data-value="the-revenant"
              title="Natural light wilderness, cold winter, immersive">‚ùÑÔ∏è The Revenant</button>
            <button class="option-btn" data-group="quickStyle" data-value="hero"
              title="Wuxia poetry, bold monochromatic color themes">üó°Ô∏è Hero</button>
            <button class="option-btn" data-group="quickStyle" data-value="la-la-land"
              title="Modern musical, Technicolor primaries, magical realism">üíÉ La La Land</button>
            <button class="option-btn" data-group="quickStyle" data-value="the-fall"
              title="Surreal maximalism, painterly colors, exotic locations">üë≥ The Fall</button>
            <button class="option-btn" data-group="quickStyle" data-value="1917"
              title="WWI one-shot realism, overcast day, firelight night">üí£ 1917</button>
            <button class="option-btn" data-group="quickStyle" data-value="amelie"
              title="Whimsical Paris, warm green/red palette, painterly">ü•Ñ Am√©lie</button>
            <button class="option-btn" data-group="quickStyle" data-value="shinkai-vibes"
              title="Makoto Shinkai style, vibrant clouds, lens flares">‚òÅÔ∏è Modern Anime</button>
            <button class="option-btn" data-group="quickStyle" data-value="90s-anime"
              title="Retro 90s cel animation, film grain, muted colors">üìº 90s Cel Style</button>
            <button class="option-btn" data-group="quickStyle" data-value="dark-fantasy-anime"
              title="Berserk/Elden Ring style, dark fantasy, grit">‚öîÔ∏è Dark Fantasy</button>
            <button class="option-btn" data-group="quickStyle" data-value="ghibli-style"
              title="Studio Ghibli hand-painted aesthetic, soft nature">üé® Ghibli Style</button>
          </div>
          <div class="hint">–°—Ç–∏–ª–µ–≤–æ–π –ø—Ä–µ—Å–µ—Ç –∑–∞–¥–∞—ë—Ç –ø–æ–ª–Ω—É—é –≤–∏–∑—É–∞–ª—å–Ω—É—é —ç—Å—Ç–µ—Ç–∏–∫—É: –æ—Å–≤–µ—â–µ–Ω–∏–µ, —Ü–≤–µ—Ç, —Ç–µ–∫—Å—Ç—É—Ä—É. –ü—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
            –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ–Ω—é.</div>
        </div>

        <!-- Generation Modes Master Toggle -->
        <div class="section" style="border: 2px solid var(--accent); background: rgba(108, 92, 231, 0.05);">
          <div class="section-header">
            <h2><span class="icon icon-orange">‚ú®</span> –†–µ–∂–∏–º –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ <span class="help-tip">?<span
                  class="tip-text"><b>Generate 4</b> ‚Äî —Å–æ–∑–¥–∞—ë—Ç 4 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å —Ä–∞–∑–Ω—ã–º–∏ –∫–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º–∏
                  —Ä–∞–∫—É—Ä—Å–∞–º–∏: Low Angle, Cowboy Shot, Dutch Angle, Three-Quarter. –ë–ª–æ–∫–∏—Ä—É–µ—Ç –æ–±—ä–µ–∫—Ç–∏–≤, —É–≥–æ–ª –∏ –ø–ª–∞–Ω (–æ–Ω–∏
                  –∑–∞–¥–∞–Ω—ã –≤ –≤–∞—Ä–∏–∞—Ü–∏—è—Ö). –ï—Å–ª–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ ¬´–û–ø–∏—Å–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã¬ª, —Å–ª–æ–≤–æ subject –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ –≤–∞—à
                  —Ç–µ–∫—Å—Ç.<br><br><b>3√ó3 Contact Sheet</b> ‚Äî –∫–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–∞–∫—Ç-–ª–∏—Å—Ç –∏–∑ 9 –∫–∞–¥—Ä–æ–≤ (–æ—Ç ELS –¥–æ ECU +
                  –≤–∏–¥ —Å–≤–µ—Ä—Ö—É/—Å–Ω–∏–∑—É) –≤ –µ–¥–∏–Ω–æ–π —Å–µ—Ç–∫–µ. –ë–ª–æ–∫–∏—Ä—É–µ—Ç –æ–±—ä–µ–∫—Ç–∏–≤, –¥–∏–∞—Ñ—Ä–∞–≥–º—É, —É–≥–æ–ª, –ø–ª–∞–Ω.<br><br><b>üîí –ú–∞–∫—Å.
                    –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å</b> ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª Identity Lock: –≤—Å–µ —á–µ—Ä—Ç—ã –ª–∏—Ü–∞, –≤–æ–ª–æ—Å, –∫–æ–∂–∏, —Ç–µ–ª–æ—Å–ª–æ–∂–µ–Ω–∏—è –∏
                  –æ–¥–µ–∂–¥—ã —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –∏ –Ω–µ –º–µ–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –∫–∞–¥—Ä–∞–º–∏. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Å–µ—Ä–∏–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –æ–¥–Ω–æ–≥–æ
                  –ø–µ—Ä—Å–æ–Ω–∞–∂–∞.<br><br>–í—Å–µ —Ç—Ä–∏ —Ä–µ–∂–∏–º–∞ –º–æ–∂–Ω–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–æ–º–µ Generate 4 + 3√ó3
                  (–≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏–µ).</span></span></h2>
          </div>
          <div class="toggle-row">
            <label class="toggle-label" id="generateFourModeLabel"
              style="flex:1; display:flex; justify-content:space-between; font-weight:bold; color:var(--accent-light);"
              title="">
              <span>üé¨ Generate 4 Variations</span>
              <input type="checkbox" id="generateFourMode">
            </label>
            <label class="toggle-label" id="grid3x3ModeLabel"
              style="flex:1; display:flex; justify-content:space-between; font-weight:bold; color:var(--green);"
              title="">
              <span>üìê 3√ó3 Contact Sheet</span>
              <input type="checkbox" id="grid3x3Mode">
            </label>
            <label class="toggle-label" id="maxConsistencyLabel"
              style="flex:1; display:flex; justify-content:space-between; font-weight:bold; color:var(--orange);"
              title="">
              <span>üîí –ú–∞–∫—Å. –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å</span>
              <input type="checkbox" id="maxConsistency">
            </label>
          </div>
        </div>

        <!-- Presets -->
        <div class="section">
          <div class="section-header">
            <h2><span class="icon icon-green">‚ö°</span> –ü—Ä–µ—Å–µ—Ç—ã <span class="help-tip">?<span class="tip-text">–ü—Ä–µ—Å–µ—Ç—ã ‚Äî
                  –≥–æ—Ç–æ–≤—ã–µ –Ω–∞–±–æ—Ä—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è —Ç–∏–ø–æ–≤—ã—Ö –∑–∞–¥–∞—á. –û–¥–Ω–∏–º –∫–ª–∏–∫–æ–º –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –≤—Å–µ
                  –Ω–∞—Å—Ç—Ä–æ–π–∫–∏. –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–æ–∂–Ω–æ –ø–æ–¥–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ª—é–±–æ–π –ø—É–Ω–∫—Ç.</span></span></h2>
          </div>
          <div class="option-group" id="presetGrid"><button class="option-btn" data-preset-index="0"
              style="border-color: var(--green); border-width: 2px;">üé¨ –ö–∏–Ω–æ–ø–æ—Ä—Ç—Ä–µ—Ç</button><button class="option-btn"
              data-preset-index="1" style="border-color: var(--green); border-width: 2px;">üì¶ –ü—Ä–µ–¥–º–µ—Ç–Ω–∞—è
              —Å—ä—ë–º–∫–∞</button><button class="option-btn" data-preset-index="2"
              style="border-color: var(--green); border-width: 2px;">üåÉ –ù–µ–æ–Ω–æ–≤—ã–π –∫–∏–±–µ—Ä–ø–∞–Ω–∫</button><button
              class="option-btn" data-preset-index="3" style="border-color: var(--green); border-width: 2px;">üé®
              –ö–æ–Ω—Ü–µ–ø—Ç-–∞—Ä—Ç</button><button class="option-btn" data-preset-index="4"
              style="border-color: var(--green); border-width: 2px;">üíº –ö–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è —Å—ä—ë–º–∫–∞</button><button
              class="option-btn" data-preset-index="5" style="border-color: var(--green); border-width: 2px;">üì∫
              –†–µ–∫–ª–∞–º–Ω—ã–π —Ä–æ–ª–∏–∫</button><button class="option-btn" data-preset-index="6"
              style="border-color: var(--green); border-width: 2px;">üî¨ –ú–∞–∫—Ä–æ —Ä–µ–∫–ª–∞–º–∞</button><button class="option-btn"
              data-preset-index="7" style="border-color: var(--green); border-width: 2px;">üì∑ –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π
              –ø–æ—Ä—Ç—Ä–µ—Ç</button><button class="option-btn" data-preset-index="8"
              style="border-color: var(--green); border-width: 2px;">üèôÔ∏è –£–ª–∏—á–Ω—ã–π —Ñ–æ—Ç–æ—Ä–µ–∞–ª–∏–∑–º</button><button
              class="option-btn" data-preset-index="9" style="border-color: var(--green); border-width: 2px;">üíé Beauty
              / –ö–æ—Å–º–µ—Ç–∏–∫–∞</button></div>
          <div class="hint">–ü—Ä–µ—Å–µ—Ç –∑–∞–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞ –æ–¥–∏–Ω –∫–ª–∏–∫. –ú–æ–∂–Ω–æ –ø–æ–¥–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ.</div>
        </div>

        <!-- Quick Style Presets ‚Äî moved to top of sidebar -->

        <!-- AI Model -->
        <div class="section">
          <div class="section-header">
            <h2><span class="icon icon-purple">ü§ñ</span> AI –ú–æ–¥–µ–ª—å <span class="help-tip">?<span
                  class="tip-text">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ–π—Ä–æ—Å–µ—Ç—å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏. –ö–∞–∂–¥–∞—è –º–æ–¥–µ–ª—å –∏–º–µ–µ—Ç —Å–≤–æ–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –ø—Ä–æ–º–ø—Ç–æ–≤.
                  Midjourney —Ç—Ä–µ–±—É–µ—Ç ¬´--¬ª –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, DALL¬∑E –∏ Flux ‚Äî –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫.</span></span></h2>
            <span class="mode-badge">single</span>
          </div>
          <div class="option-group">
            <button class="option-btn" data-group="aiModel" data-value="midjourney" title="">Midjourney</button>
            <button class="option-btn" data-group="aiModel" data-value="dall-e-3" title="">DALL¬∑E 3</button>
            <button class="option-btn" data-group="aiModel" data-value="stable-diffusion" title="">Stable
              Diffusion</button>
            <button class="option-btn" data-group="aiModel" data-value="flux" title="">Flux</button>
            <button class="option-btn" data-group="aiModel" data-value="ideogram" title="">Ideogram</button>
            <button class="option-btn" data-group="aiModel" data-value="gemini-imagen" title="">Gemini Imagen</button>
            <button class="option-btn" data-group="aiModel" data-value="chatgpt-image" title="">ChatGPT Image</button>
            <button class="option-btn" data-group="aiModel" data-value="nano-banana-pro" title="">Nano Banana
              Pro</button>
          </div>
          <div id="modelHint" class="hint" style="display: none;">SD: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ–≥–∞—Ç–∏–≤—ã, –≤–µ—Å–∞ —Ç–æ–∫–µ–Ω–æ–≤ (word:1.3),
            LoRA. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç Flat.</div>
        </div>

        <!-- Scene Description -->
        <div class="section">
          <div class="section-header">
            <h2><span class="icon icon-purple">üéØ</span> –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã <span class="help-tip">?<span
                  class="tip-text">–ì–ª–∞–≤–Ω–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ –ø—Ä–æ–º–ø—Ç–∞ ‚Äî —è–¥—Ä–æ –≤–∞—à–µ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è. –ü–∏—à–∏—Ç–µ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º –¥–ª—è
                  –ª—É—á—à–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.<br><br><b>–°—Ç—Ä—É–∫—Ç—É—Ä–∞:</b><br>1. ¬´–ö—Ç–æ/–ß—Ç–æ¬ª ‚Äî –æ–ø–∏—à–∏—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (–≤–æ–∑—Ä–∞—Å—Ç, –≤–Ω–µ—à–Ω–æ—Å—Ç—å,
                  –æ–¥–µ–∂–¥–∞)<br>2. ¬´–ì–¥–µ¬ª ‚Äî –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –ª–æ–∫–∞—Ü–∏—è<br>3. ¬´–î–µ–π—Å—Ç–≤–∏–µ/–ü–æ–∑–∞¬ª ‚Äî —á—Ç–æ –¥–µ–ª–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂<br>4. ¬´–î–µ—Ç–∞–ª–∏¬ª ‚Äî
                  –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞, –ø–æ–≥–æ–¥–∞, —Ü–≤–µ—Ç–∞<br><br><b>–ü—Ä–∏–º–µ—Ä:</b> A woman in her 30s with auburn hair, wearing a vintage
                  floral dress, standing at the edge of a misty lake at dawn, looking at the reflection</span></span>
            </h2>
          </div>
          <textarea class="input-field" id="mainSubject"
            placeholder="–ú—É–∂—á–∏–Ω–∞ 30 –ª–µ—Ç —Å—Ç–æ–∏—Ç –Ω–∞ –±–∞–ª–∫–æ–Ω–µ –Ω–µ–±–æ—Å–∫—Ä—ë–±–∞ —Å –≤–∏–¥–æ–º –Ω–∞ –Ω–µ–æ–Ω–æ–≤—ã–π –≥–æ—Ä–æ–¥ –≤ —Å—É–º–µ—Ä–∫–∞—Ö..."
            oninput="handleInput()"></textarea>
          <div style="display:flex;gap:8px;align-items:center;margin-top:6px;">
            <button type="button" id="translateBtn" class="btn btn-ghost"
              style="min-width:auto;padding:6px 14px;font-size:.82em;" onclick="translateScene()">
              üåê –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –Ω–∞ EN
            </button>
            <span id="translateStatus" style="font-size:.78em;color:var(--text-muted);"></span>
          </div>
          <div class="hint">–ú–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º ‚Äî –Ω–∞–∂–º–∏—Ç–µ ¬´–ü–µ—Ä–µ–≤–µ—Å—Ç–∏¬ª –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π. –°–Ω–∞—á–∞–ª–∞
            ¬´–∫—Ç–æ/—á—Ç–æ¬ª, –∑–∞—Ç–µ–º ¬´–≥–¥–µ¬ª, –ø–æ—Ç–æ–º ¬´—Å—Ç–∏–ª—å¬ª.
          </div>
        </div>

        <!-- Aspect Ratio -->
        <div class="section" id="aspectRatioSection">
          <div class="section-header">
            <h2><span class="icon icon-purple">üìê</span> –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω <span class="help-tip">?<span
                  class="tip-text">1:1 ‚Äî Instagram. 16:9 ‚Äî YouTube, –∫–∏–Ω–æ. 9:16 ‚Äî Stories/Reels. 21:9 ‚Äî —É–ª—å—Ç—Ä–∞-—à–∏—Ä–æ–∫–∏–π
                  –∫–∏–Ω–æ–∫–∞–¥—Ä. 3:4 ‚Äî Pinterest, –ø–æ—Ä—Ç—Ä–µ—Ç—ã. –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Å—Ç–∞–Ω—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è.</span></span></h2>
            <span class="mode-badge">single</span>
          </div>
          <div class="option-group" id="aspectRatioGroup">
            <button class="option-btn" data-group="aspectRatio" data-value="1:1" title="">1:1 –ö–≤–∞–¥—Ä–∞—Ç</button>
            <button class="option-btn" data-group="aspectRatio" data-value="16:9" title="">16:9 –®–∏—Ä–æ–∫–∏–π</button>
            <button class="option-btn" data-group="aspectRatio" data-value="9:16" title="">9:16
              –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π</button>
            <button class="option-btn" data-group="aspectRatio" data-value="4:3" title="">4:3 –°—Ç–∞–Ω–¥–∞—Ä—Ç</button>
            <button class="option-btn" data-group="aspectRatio" data-value="3:4" title="">3:4 –ü–æ—Ä—Ç—Ä–µ—Ç</button>
            <button class="option-btn" data-group="aspectRatio" data-value="21:9" title="">21:9 –ö–∏–Ω–æ</button>
            <button class="option-btn" data-group="aspectRatio" data-value="2:3" title="">2:3 –ö–ª–∞—Å—Å–∏–∫–∞</button>
            <button class="option-btn" data-group="aspectRatio" data-value="3:2" title="">3:2 –ü–µ–π–∑–∞–∂</button>
          </div>
        </div>

        <!-- Resolution -->
        <div class="section">
          <div class="section-header">
            <h2><span class="icon icon-purple">üìè</span> –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ <span class="help-tip">?<span
                  class="tip-text">–†–∞–∑–º–µ—Ä –≤ –ø–∏–∫—Å–µ–ª—è—Ö. –î–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π ‚Äî Full HD. –î–ª—è –ø–µ—á–∞—Ç–∏ ‚Äî 4K –∏ –≤—ã—à–µ. –ó–∞–≤–∏—Å–∏—Ç –æ—Ç
                  –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å—Ç–æ—Ä–æ–Ω.</span></span></h2>
            <span class="mode-badge">single</span>
          </div>
          <div id="resolutionInfo" class="info-box" style="display: block;">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω.</div>
          <div id="resolutionOptions" class="option-group" style="display: none;"></div>
        </div>

        <!-- Purpose & Format -->
        <div class="section">
          <div class="section-header">
            <h2><span class="icon icon-orange">üé¨</span> –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏ —Ñ–æ—Ä–º–∞—Ç <span class="help-tip">?<span
                  class="tip-text">¬´–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ¬ª ‚Äî –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å—ä—ë–º–∫–∏ (–ø—Ä–æ–¥—É–∫—Ç, —Ä–µ–∫–ª–∞–º–∞, –∫–∏–Ω–æ). ¬´–§–æ—Ä–º–∞—Ç¬ª ‚Äî —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π
                  —Å—Ç–∏–ª—å (—Ñ–æ—Ç–æ, 3D, –º–∞—Å–ª–æ). –ú–æ–∂–Ω–æ —Å–≤–æ–±–æ–¥–Ω–æ —Å–æ—á–µ—Ç–∞—Ç—å.</span></span></h2>
            <span class="mode-badge">single</span>
          </div>
          <span class="sub-label">–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ</span>
          <div class="option-group">
            <button class="option-btn" data-group="purpose" data-value="Photography" title="">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è</button>
            <button class="option-btn" data-group="purpose" data-value="Product Photography" title="">–ü—Ä–æ–¥—É–∫—Ç</button>
            <button class="option-btn" data-group="purpose" data-value="Advertising campaign" title="">–†–µ–∫–ª–∞–º–∞</button>
            <button class="option-btn" data-group="purpose" data-value="Infographic" title="">–ò–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫–∞</button>
            <button class="option-btn" data-group="purpose" data-value="Cinematic Still" title="">–ö–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ</button>
            <button class="option-btn" data-group="purpose" data-value="UI Design" title="">UI –î–∏–∑–∞–π–Ω</button>
            <button class="option-btn" data-group="purpose" data-value="Character Sheet" title="">–õ–∏—Å—Ç
              –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</button>
            <button class="option-btn" data-group="purpose" data-value="Logo Design" title="">–õ–æ–≥–æ—Ç–∏–ø</button>
            <button class="option-btn" data-group="purpose" data-value="Editorial" title="">–ñ—É—Ä–Ω–∞–ª—å–Ω–æ–µ —Ñ–æ—Ç–æ</button>
            <button class="option-btn" data-group="purpose" data-value="Concept Art" title="">–ö–æ–Ω—Ü–µ–ø—Ç-–∞—Ä—Ç</button>
          </div>

          <span class="sub-label">–•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç</span>
          <div class="option-group">
            <button class="option-btn" data-group="format" data-value="photorealistic" title="">–§–æ—Ç–æ—Ä–µ–∞–ª–∏–∑–º</button>
            <button class="option-btn" data-group="format" data-value="3D render" title="">3D –†–µ–Ω–¥–µ—Ä</button>
            <button class="option-btn" data-group="format" data-value="vector illustration" title="">–í–µ–∫—Ç–æ—Ä</button>
            <button class="option-btn" data-group="format" data-value="oil painting" title="">–ú–∞—Å–ª–æ</button>
            <button class="option-btn" data-group="format" data-value="pencil sketch" title="">–°–∫–µ—Ç—á</button>
            <button class="option-btn" data-group="format" data-value="pixel art" title="">–ü–∏–∫—Å–µ–ª—å-–∞—Ä—Ç</button>
            <button class="option-btn" data-group="format" data-value="watercolor" title="">–ê–∫–≤–∞—Ä–µ–ª—å</button>
            <button class="option-btn" data-group="format" data-value="anime style" title="">–ê–Ω–∏–º–µ</button>
          </div>
        </div>

        <!-- Camera Body -->
        <div class="section">
          <div class="section-header">
            <h2><span class="icon icon-purple">üì∏</span> –ö–∞–º–µ—Ä–∞ (–∫–æ—Ä–ø—É—Å)</h2>
            <span class="mode-badge">single</span>
          </div>
          <div class="option-group">
            <button class="option-btn" data-group="cameraBody" data-value="shot on Sony A7R V" title="">Sony A7R
              V</button>
            <button class="option-btn" data-group="cameraBody" data-value="shot on Canon EOS R5" title="">Canon EOS
              R5</button>
            <button class="option-btn" data-group="cameraBody" data-value="shot on Nikon Z9" title="">Nikon Z9</button>
            <button class="option-btn" data-group="cameraBody" data-value="shot on Fujifilm X-T5" title="">Fujifilm
              X-T5</button>
            <button class="option-btn" data-group="cameraBody" data-value="shot on Leica M11" title="">Leica
              M11</button>
            <button class="option-btn" data-group="cameraBody" data-value="shot on Hasselblad X2D 100C"
              title="">Hasselblad
              X2D</button>
            <button class="option-btn" data-group="cameraBody" data-value="shot on Phase One IQ4 150MP" title="">Phase
              One
              IQ4</button>
            <button class="option-btn" data-group="cameraBody" data-value="shot on ARRI ALEXA 35" title="">ARRI ALEXA
              35</button>
            <button class="option-btn" data-group="cameraBody" data-value="shot on RED V-Raptor" title="">RED
              V-Raptor</button>
            <button class="option-btn" data-group="cameraBody" data-value="shot on Blackmagic URSA Mini Pro 12K"
              title="">Blackmagic 12K</button>
          </div>
          <div class="hint">–§–æ—Ç–æ: Sony, Canon, Nikon, Fuji, Leica, Hasselblad, Phase One. –í–∏–¥–µ–æ: ARRI, RED, Blackmagic.
          </div>
        </div>

        <!-- Lens & Optics -->
        <div class="section" id="lensSection">
          <div class="section-header">
            <h2><span class="icon icon-purple">üî≠</span> –û–ø—Ç–∏–∫–∞ <span class="help-tip">?<span class="tip-text">–û–±—ä–µ–∫—Ç–∏–≤
                  –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—É, –±–æ–∫–µ –∏ —Ä–∏—Å—É–Ω–æ–∫. –®–∏—Ä–æ–∫–æ—É–≥–æ–ª—å–Ω—ã–µ (14-35mm) ‚Äî –ø–µ–π–∑–∞–∂–∏. –ü–æ—Ä—Ç—Ä–µ—Ç–Ω—ã–µ (50-85mm) ‚Äî
                  –ª–∏—Ü–∞. –ú–∞–∫—Ä–æ (100mm) ‚Äî –¥–µ—Ç–∞–ª–∏. –ö–∏–Ω–æ-–æ–ø—Ç–∏–∫–∞ ‚Äî –∫–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ.</span></span></h2>
            <span class="mode-badge">single</span>
          </div>

          <span class="sub-label">Canon</span>
          <div class="option-group">
            <button class="option-btn" data-group="lens" data-value="Canon RF 15-35mm f/2.8L USM" title="">RF 15-35mm
              f/2.8L</button>
            <button class="option-btn" data-group="lens" data-value="Canon RF 50mm f/1.2L USM" title="">RF 50mm
              f/1.2L</button>
            <button class="option-btn" data-group="lens" data-value="Canon RF 85mm f/1.2L USM" title="">RF 85mm
              f/1.2L</button>
            <button class="option-btn" data-group="lens" data-value="Canon RF 100mm f/2.8L Macro IS USM" title="">RF
              100mm f/2.8
              Macro</button>
          </div>

          <span class="sub-label">Sony</span>
          <div class="option-group">
            <button class="option-btn" data-group="lens" data-value="Sony FE 24-70mm f/2.8 GM II" title="">FE 24-70mm
              f/2.8 GM
              II</button>
            <button class="option-btn" data-group="lens" data-value="Sony FE 35mm f/1.4 GM" title="">FE 35mm f/1.4
              GM</button>
            <button class="option-btn" data-group="lens" data-value="Sony FE 85mm f/1.4 GM" title="">FE 85mm f/1.4
              GM</button>
            <button class="option-btn" data-group="lens" data-value="Sony FE 70-200mm f/2.8 GM II" title="">FE 70-200mm
              f/2.8 GM
              II</button>
          </div>

          <span class="sub-label">Nikon</span>
          <div class="option-group">
            <button class="option-btn" data-group="lens" data-value="Nikon Z 50mm f/1.2 S" title="">Z 50mm f/1.2
              S</button>
            <button class="option-btn" data-group="lens" data-value="Nikon Z 85mm f/1.2 S" title="">Z 85mm f/1.2
              S</button>
            <button class="option-btn" data-group="lens" data-value="Nikon Z 14-24mm f/2.8 S" title="">Z 14-24mm f/2.8
              S</button>
          </div>

          <span class="sub-label">Sigma / Zeiss / Leica</span>
          <div class="option-group">
            <button class="option-btn" data-group="lens" data-value="Sigma 35mm f/1.4 DG DN Art" title="">Sigma 35mm
              f/1.4
              Art</button>
            <button class="option-btn" data-group="lens" data-value="Sigma 85mm f/1.4 DG DN Art" title="">Sigma 85mm
              f/1.4
              Art</button>
            <button class="option-btn" data-group="lens" data-value="Sigma 105mm f/2.8 DG DN Macro Art" title="">Sigma
              105mm
              Macro Art</button>
            <button class="option-btn" data-group="lens" data-value="Zeiss Otus 55mm f/1.4" title="">Zeiss Otus 55mm
              f/1.4</button>
            <button class="option-btn" data-group="lens" data-value="Leica Summilux-M 50mm f/1.4 ASPH" title="">Leica
              Summilux
              50mm</button>
          </div>

          <span class="sub-label">–ö–∏–Ω–æ-–æ–ø—Ç–∏–∫–∞</span>
          <div class="option-group">
            <button class="option-btn" data-group="lens" data-value="Cooke S7/i 50mm T2.0 Full Frame Plus"
              title="">Cooke S7/i
              50mm</button>
            <button class="option-btn" data-group="lens" data-value="ARRI Signature Prime 35mm T1.8" title="">ARRI
              Signature
              35mm</button>
            <button class="option-btn" data-group="lens" data-value="Panavision Primo 70mm" title="">Panavision Primo
              70mm</button>
            <button class="option-btn" data-group="lens" data-value="Anamorphic 2x squeeze, oval bokeh, lens flare"
              title="">Anamorphic 2x</button>
          </div>
        </div>

        <!-- Film Stocks -->
        <div class="section" id="filmStockSection">
          <div class="section-header">
            <h2><span class="icon icon-yellow">üéûÔ∏è</span> –ö–∏–Ω–æ–ø–ª—ë–Ω–∫–∞ <span class="help-tip">?<span
                  class="tip-text">–≠–º—É–ª—è—Ü–∏—è –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã—Ö —Ñ–æ—Ç–æ- –∏ –∫–∏–Ω–æ–ø–ª—ë–Ω–æ–∫. –í–ª–∏—è–µ—Ç –Ω–∞ —Ü–≤–µ—Ç, –∑–µ—Ä–Ω–æ –∏
                  –∫–æ–Ω—Ç—Ä–∞—Å—Ç.</span></span></h2>
            <span class="mode-badge">single</span>
          </div>
          <div class="option-group">
            <button class="option-btn" data-group="filmStock" data-value="Kodak Portra 400"
              title="–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–∫–∏–Ω—Ç–æ–Ω—ã, —Ç—ë–ø–ª–∞—è –Ω–æ—Å—Ç–∞–ª—å–≥–∏—è">Kodak Portra 400</button>
            <button class="option-btn" data-group="filmStock" data-value="CineStill 800T"
              title="–í–µ—á–µ—Ä–Ω—è—è —Å—ä—ë–º–∫–∞, –æ—Ä–µ–æ–ª—ã –≤–æ–∫—Ä—É–≥ —Å–≤–µ—Ç–∞ (halation)">CineStill 800T</button>
            <button class="option-btn" data-group="filmStock" data-value="Kodak Gold 200"
              title="–ó–æ–ª–æ—Ç–∏—Å—Ç—ã–µ —Ç—ë–ø–ª—ã–µ —Ç–æ–Ω–∞, –∫–ª–∞—Å—Å–∏–∫–∞">Kodak Gold 200</button>
            <button class="option-btn" data-group="filmStock" data-value="Fujifilm Pro 400H"
              title="–ú—è–≥–∫–∏–µ –ø–∞—Å—Ç–µ–ª—å–Ω—ã–µ —Ç–æ–Ω–∞, —Ö–æ–ª–æ–¥–Ω—ã–µ —Ç–µ–Ω–∏">Fuji Pro 400H</button>
            <button class="option-btn" data-group="filmStock" data-value="Kodak Ektar 100"
              title="–í—ã—Å–æ–∫–∞—è –Ω–∞—Å—ã—â–µ–Ω–Ω–æ—Å—Ç—å –∏ —Ä–µ–∑–∫–æ—Å—Ç—å, –ø–µ–π–∑–∞–∂–∏">Kodak Ektar 100</button>
            <button class="option-btn" data-group="filmStock" data-value="Kodak Tri-X 400"
              title="–ß/–ë, –≤—ã—Å–æ–∫–∏–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç, –∑–µ—Ä–Ω–æ">Kodak Tri-X 400 (B&W)</button>
            <button class="option-btn" data-group="filmStock" data-value="Ilford HP5 Plus"
              title="–ß/–ë, —à–∏—Ä–æ–∫–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω, –º—è–≥–∫–æ–µ –∑–µ—Ä–Ω–æ">Ilford HP5 Plus (B&W)</button>
            <button class="option-btn" data-group="filmStock" data-value="Fujifilm Velvia 50"
              title="–≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–∞—è –Ω–∞—Å—ã—â–µ–Ω–Ω–æ—Å—Ç—å, –ø—Ä–∏—Ä–æ–¥–∞">Fuji Velvia 50</button>
            <button class="option-btn" data-group="filmStock" data-value="Kodak Vision3 500T"
              title="–ö–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–∏—á–Ω–∞—è –ø–ª—ë–Ω–∫–∞, –±–∞–ª–∞–Ω—Å –≤–æ–ª—å—Ñ—Ä–∞–º">Kodak Vision3 500T</button>
            <button class="option-btn" data-group="filmStock" data-value="Kodak Aerochrome"
              title="–ò–Ω—Ñ—Ä–∞–∫—Ä–∞—Å–Ω–∞—è –ø–ª—ë–Ω–∫–∞, —Ä–æ–∑–æ–≤–∞—è –ª–∏—Å—Ç–≤–∞">Kodak Aerochrome (IR)</button>
          </div>
        </div>

        <!-- Aperture & Angle & Composition -->
        <div class="section">
          <div class="section-header">
            <h2><span class="icon icon-orange">üé•</span> –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—ä—ë–º–∫–∏ <span class="help-tip">?<span
                  class="tip-text">¬´–î–∏–∞—Ñ—Ä–∞–≥–º–∞¬ª ‚Äî –≥–ª—É–±–∏–Ω–∞ —Ä–µ–∑–∫–æ—Å—Ç–∏. ¬´–£–≥–æ–ª¬ª ‚Äî –æ—Ç–∫—É–¥–∞ —Å–º–æ—Ç—Ä–∏—Ç –∫–∞–º–µ—Ä–∞. ¬´–†–∞–∫—É—Ä—Å/–ü–ª–∞–Ω¬ª ‚Äî
                  –∫—Ä—É–ø–Ω–æ—Å—Ç—å –ø–æ–∫–∞–∑–∞. –í—Å–µ —Ç—Ä–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã.</span></span></h2>
          </div>

          <span class="sub-label">–î–∏–∞—Ñ—Ä–∞–≥–º–∞ <span class="mode-badge" style="margin-left:6px">single</span></span>
          <div class="option-group">
            <button class="option-btn" data-group="aperture"
              data-value="f/1.2, extremely shallow depth of field, dreamy bokeh" title="">f/1.2 –ú–∞–∫—Å. –±–æ–∫–µ</button>
            <button class="option-btn" data-group="aperture" data-value="f/1.4, shallow depth of field, creamy bokeh"
              title="">f/1.4 –ë–æ–∫–µ</button>
            <button class="option-btn" data-group="aperture" data-value="f/1.8, portrait bokeh" title="">f/1.8
              –ü–æ—Ä—Ç—Ä–µ—Ç</button>
            <button class="option-btn" data-group="aperture" data-value="f/2.8, balanced depth of field" title="">f/2.8
              –ë–∞–ª–∞–Ω—Å</button>
            <button class="option-btn" data-group="aperture" data-value="f/5.6, moderate depth of field" title="">f/5.6
              –£–º–µ—Ä–µ–Ω–Ω–∞—è</button>
            <button class="option-btn" data-group="aperture" data-value="f/8, deep focus" title="">f/8 –ì–ª—É–±–æ–∫–∞—è
              —Ä–µ–∑–∫–æ—Å—Ç—å</button>
            <button class="option-btn" data-group="aperture" data-value="f/11, maximum sharpness" title="">f/11 –ú–∞–∫—Å.
              —Ä–µ–∑–∫–æ—Å—Ç—å</button>
            <button class="option-btn" data-group="aperture" data-value="f/16, hyperfocal distance, everything in focus"
              title="">f/16 –ì–∏–ø–µ—Ä—Ñ–æ–∫–∞–ª</button>
          </div>

          <span class="sub-label">–£–≥–æ–ª —Å—ä—ë–º–∫–∏ <span class="mode-badge" style="margin-left:6px">single</span></span>
          <div class="option-group">
            <button class="option-btn" data-group="angle" data-value="extreme low angle, worm&#39;s eye view"
              title="">–≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ
              —Å–Ω–∏–∑—É</button>
            <button class="option-btn" data-group="angle" data-value="low angle shot" title="">–°–Ω–∏–∑—É (Low
              Angle)</button>
            <button class="option-btn" data-group="angle" data-value="slightly low angle, hero shot"
              title="">–ì–µ—Ä–æ–∏—á–µ—Å–∫–∏–π (—á—É—Ç—å
              —Å–Ω–∏–∑—É)</button>
            <button class="option-btn" data-group="angle" data-value="eye level" title="">–£—Ä–æ–≤–µ–Ω—å –≥–ª–∞–∑</button>
            <button class="option-btn" data-group="angle" data-value="slightly high angle" title="">–ß—É—Ç—å —Å–≤–µ—Ä—Ö—É</button>
            <button class="option-btn" data-group="angle" data-value="high angle bird&#39;s eye view" title="">–°–≤–µ—Ä—Ö—É
              (High
              Angle)</button>
            <button class="option-btn" data-group="angle" data-value="top-down aerial drone shot" title="">–î—Ä–æ–Ω
              (–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ)</button>
            <button class="option-btn" data-group="angle" data-value="dutch angle, tilted frame" title="">Dutch Angle
              (–Ω–∞–∫–ª–æ–Ω)</button>
            <button class="option-btn" data-group="angle" data-value="over-the-shoulder shot" title="">–ß–µ—Ä–µ–∑ –ø–ª–µ—á–æ
              (OTS)</button>
            <button class="option-btn" data-group="angle" data-value="POV first person perspective" title="">POV (–æ—Ç
              –ø–µ—Ä–≤–æ–≥–æ
              –ª–∏—Ü–∞)</button>
          </div>

          <span class="sub-label">–†–∞–∫—É—Ä—Å / –ü–ª–∞–Ω <span class="mode-badge" style="margin-left:6px">single</span></span>
          <div class="option-group">
            <button class="option-btn" data-group="composition" data-value="extreme close-up, face detail"
              title="">–≠–∫—Å—Ç—Ä.
              –∫—Ä—É–ø–Ω—ã–π –ø–ª–∞–Ω</button>
            <button class="option-btn" data-group="composition" data-value="close-up portrait, head and shoulders"
              title="">–ö—Ä—É–ø–Ω—ã–π –ø–ª–∞–Ω</button>
            <button class="option-btn" data-group="composition" data-value="medium close-up, chest up" title="">–ü–æ—è—Å–Ω–æ–π
              –ø–ª–∞–Ω</button>
            <button class="option-btn" data-group="composition" data-value="medium shot, waist up" title="">–°—Ä–µ–¥–Ω–∏–π
              –ø–ª–∞–Ω</button>
            <button class="option-btn" data-group="composition" data-value="full body shot, head to toe" title="">–ü–æ–ª–Ω—ã–π
              —Ä–æ—Å—Ç</button>
            <button class="option-btn" data-group="composition" data-value="wide shot, subject in environment"
              title="">–û–±—â–∏–π
              –ø–ª–∞–Ω</button>
            <button class="option-btn" data-group="composition" data-value="extreme wide shot, vast landscape"
              title="">–î–∞–ª—å–Ω–∏–π
              –ø–ª–∞–Ω</button>
            <button class="option-btn" data-group="composition" data-value="overhead flat lay, knolling arrangement"
              title="">–†–∞—Å–∫–ª–∞–¥–∫–∞ (Flat lay)</button>
          </div>
        </div>

        <!-- Lighting -->
        <div class="section">
          <div class="section-header">
            <h2><span class="icon icon-orange">üí°</span> –û—Å–≤–µ—â–µ–Ω–∏–µ <span class="help-tip">?<span
                  class="tip-text">–ö–ª—é—á–µ–≤–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä. ¬´–¢–∏–ø¬ª ‚Äî Primary+Accent (1-–π –∫–ª–∏–∫ = –æ—Å–Ω–æ–≤–Ω–æ–π, 2-–π =
                  –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π). ¬´–í—Ä–µ–º—è —Å—É—Ç–æ–∫¬ª ‚Äî –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ. ¬´–≠—Ñ—Ñ–µ–∫—Ç—ã¬ª ‚Äî –º—É–ª—å—Ç–∏–≤—ã–±–æ—Ä.</span></span></h2>
          </div>

          <span class="sub-label">–¢–∏–ø –æ—Å–≤–µ—â–µ–Ω–∏—è <span class="mode-badge pa" style="margin-left:6px">primary +
              accent</span></span>
          <div class="option-group">
            <button class="option-btn" data-group="lightType" data-value="soft natural light" title="">–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π
              –º—è–≥–∫–∏–π</button>
            <button class="option-btn" data-group="lightType" data-value="studio three-point lighting" title="">–°—Ç—É–¥–∏—è
              3-—Ç–æ—á–∫–∏</button>
            <button class="option-btn" data-group="lightType" data-value="neon glow lighting" title="">Neon</button>
            <button class="option-btn" data-group="lightType" data-value="dramatic chiaroscuro"
              title="">–ö—å—è—Ä–æ—Å–∫—É—Ä–æ</button>
            <button class="option-btn" data-group="lightType" data-value="softbox beauty light"
              title="">Softbox</button>
            <button class="option-btn" data-group="lightType" data-value="backlighting silhouette" title="">–ö–æ–Ω—Ç—Ä–æ–≤–æ–π
              —Å–≤–µ—Ç</button>
            <button class="option-btn" data-group="lightType" data-value="Rembrandt lighting, triangle shadow on cheek"
              title="">–†–µ–º–±—Ä–∞–Ω–¥—Ç</button>
            <button class="option-btn" data-group="lightType" data-value="butterfly lighting, paramount glamour"
              title="">Butterfly (–ì–æ–ª–ª–∏–≤—É–¥)</button>
            <button class="option-btn" data-group="lightType" data-value="split lighting, half face shadow"
              title="">–°–ø–ª–∏—Ç
              (–ø–æ–ª–æ–≤–∏–Ω–∞)</button>
            <button class="option-btn" data-group="lightType" data-value="clamshell lighting, beauty commercial"
              title="">Clamshell (—Ä–µ–∫–ª–∞–º–∞)</button>
            <button class="option-btn" data-group="lightType" data-value="broad lighting, wide face illumination"
              title="">Broad
              Light</button>
            <button class="option-btn" data-group="lightType"
              data-value="high-key lighting, bright even exposure, minimal shadows" title="">High-Key (—è—Ä–∫–∏–π)</button>
          </div>
          <div class="hint">1-–π –∫–ª–∏–∫ = Primary (P), 2-–π –Ω–∞ –¥—Ä—É–≥—É—é = Accent (A). –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∫–ª–∏–∫ —Å–Ω–∏–º–∞–µ—Ç –≤—ã–±–æ—Ä.</div>

          <span class="sub-label">–í—Ä–µ–º—è —Å—É—Ç–æ–∫ <span class="mode-badge pa" style="margin-left:6px">primary +
              accent</span></span>
          <div class="option-group">
            <button class="option-btn" data-group="timeOfDay" data-value="golden hour warm sunlight" title="">Golden
              Hour</button>
            <button class="option-btn" data-group="timeOfDay" data-value="blue hour twilight" title="">Blue
              Hour</button>
            <button class="option-btn" data-group="timeOfDay" data-value="bright midday sun" title="">–ü–æ–ª–¥–µ–Ω—å</button>
            <button class="option-btn" data-group="timeOfDay" data-value="night, artificial lighting"
              title="">–ù–æ—á—å</button>
            <button class="option-btn" data-group="timeOfDay" data-value="overcast diffused light"
              title="">–ü–∞—Å–º—É—Ä–Ω–æ</button>
          </div>

          <span class="sub-label">–≠—Ñ—Ñ–µ–∫—Ç—ã <span class="mode-badge multi" style="margin-left:6px">multi</span></span>
          <div class="option-group">
            <button class="option-btn" data-group="lightFX" data-value="volumetric fog" title="">Volumetric
              Fog</button>
            <button class="option-btn" data-group="lightFX" data-value="subsurface scattering" title="">SSS</button>
            <button class="option-btn" data-group="lightFX" data-value="rim light" title="">Rim Light</button>
            <button class="option-btn" data-group="lightFX" data-value="god rays" title="">God Rays</button>
            <button class="option-btn" data-group="lightFX" data-value="lens flare" title="">Lens Flare</button>
            <button class="option-btn" data-group="lightFX" data-value="caustics" title="">–ö–∞—É—Å—Ç–∏–∫–∞</button>
            <button class="option-btn" data-group="lightFX" data-value="motion blur" title="">Motion Blur</button>
          </div>
        </div>


        <!-- Color Palette -->
        <div class="section">
          <div class="section-header">
            <h2><span class="icon icon-green">üé®</span> –¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞ <span class="help-tip">?<span
                  class="tip-text">–ó–∞–¥–∞—ë—Ç –¥–æ–º–∏–Ω–∏—Ä—É—é—â—É—é —Ü–≤–µ—Ç–æ–≤—É—é —Å—Ö–µ–º—É. –í–ª–∏—è–µ—Ç –Ω–∞ –æ–±—â–µ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, –∫–æ–Ω—Ç—Ä–∞—Å—Ç –∏ –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ
                  —Å—Ü–µ–Ω—ã.</span></span></h2>
            <span class="mode-badge">single</span>
          </div>
          <div class="option-group"
            style="display:grid;grid-template-columns:repeat(auto-fill,minmax(155px,1fr));gap:6px;">
            <button class="option-btn" data-group="colorPalette"
              data-value="warm golden tones, amber and honey hues, sunset warmth"
              style="position:relative;padding-left:40px;" title="">
              <span style="position:absolute;left:6px;top:50%;transform:translateY(-50%);display:flex;gap:2px;"><span
                  style="width:8px;height:18px;border-radius:2px;background:#D4A574;display:block;"></span><span
                  style="width:8px;height:18px;border-radius:2px;background:#C67D3E;display:block;"></span><span
                  style="width:8px;height:18px;border-radius:2px;background:#8B5E3C;display:block;"></span></span>–¢—ë–ø–ª—ã–µ
              –∑–æ–ª–æ—Ç—ã–µ</button>
            <button class="option-btn" data-group="colorPalette"
              data-value="cool blue tones, steel and ice palette, arctic atmosphere"
              style="position:relative;padding-left:40px;" title="">
              <span style="position:absolute;left:6px;top:50%;transform:translateY(-50%);display:flex;gap:2px;"><span
                  style="width:8px;height:18px;border-radius:2px;background:#A8C8E8;display:block;"></span><span
                  style="width:8px;height:18px;border-radius:2px;background:#5B8DB8;display:block;"></span><span
                  style="width:8px;height:18px;border-radius:2px;background:#2C5F8A;display:block;"></span></span>–•–æ–ª–æ–¥–Ω—ã–µ
              —Å–∏–Ω–∏–µ</button>
            <button class="option-btn" data-group="colorPalette"
              data-value="teal and orange cinematic color grading, complementary contrast"
              style="position:relative;padding-left:40px;" title="">
              <span style="position:absolute;left:6px;top:50%;transform:translateY(-50%);display:flex;gap:2px;"><span
                  style="width:8px;height:18px;border-radius:2px;background:#E8956A;display:block;"></span><span
                  style="width:8px;height:18px;border-radius:2px;background:#2D8B8B;display:block;"></span><span
                  style="width:8px;height:18px;border-radius:2px;background:#1A5C5C;display:block;"></span></span>Teal
              &amp; Orange</button>
            <button class="option-btn" data-group="colorPalette"
              data-value="desaturated muted earth tones, faded vintage palette"
              style="position:relative;padding-left:40px;" title="">
              <span style="position:absolute;left:6px;top:50%;transform:translateY(-50%);display:flex;gap:2px;"><span
                  style="width:8px;height:18px;border-radius:2px;background:#B8A898;display:block;"></span><span
                  style="width:8px;height:18px;border-radius:2px;background:#8C7B6B;display:block;"></span><span
                  style="width:8px;height:18px;border-radius:2px;background:#5C4F42;display:block;"></span></span>–ü—Ä–∏–≥–ª—É—à—ë–Ω–Ω—ã–µ</button>
            <button class="option-btn" data-group="colorPalette"
              data-value="high saturation vivid colors, bold primary palette, vibrant pop"
              style="position:relative;padding-left:40px;" title="">
              <span style="position:absolute;left:6px;top:50%;transform:translateY(-50%);display:flex;gap:2px;"><span
                  style="width:8px;height:18px;border-radius:2px;background:#FF4757;display:block;"></span><span
                  style="width:8px;height:18px;border-radius:2px;background:#2ED573;display:block;"></span><span
                  style="width:8px;height:18px;border-radius:2px;background:#3742FA;display:block;"></span></span>–Ø—Ä–∫–∏–µ
              / Vivid</button>
            <button class="option-btn active" data-group="colorPalette"
              data-value="soft pastel palette, delicate lavender and blush tones, dreamy muted colors"
              style="position:relative;padding-left:40px;" title="">
              <span style="position:absolute;left:6px;top:50%;transform:translateY(-50%);display:flex;gap:2px;"><span
                  style="width:8px;height:18px;border-radius:2px;background:#F8C8DC;display:block;"></span><span
                  style="width:8px;height:18px;border-radius:2px;background:#C3B1E1;display:block;"></span><span
                  style="width:8px;height:18px;border-radius:2px;background:#A8D8EA;display:block;"></span></span>–ü–∞—Å—Ç–µ–ª—å–Ω—ã–µ</button>
            <button class="option-btn" data-group="colorPalette"
              data-value="monochrome black and white, high contrast grayscale"
              style="position:relative;padding-left:40px;" title="">
              <span style="position:absolute;left:6px;top:50%;transform:translateY(-50%);display:flex;gap:2px;"><span
                  style="width:8px;height:18px;border-radius:2px;background:#222;display:block;"></span><span
                  style="width:8px;height:18px;border-radius:2px;background:#888;display:block;"></span><span
                  style="width:8px;height:18px;border-radius:2px;background:#DDD;display:block;"></span></span>–ß/–ë
              –º–æ–Ω–æ</button>
            <button class="option-btn" data-group="colorPalette"
              data-value="neon cyberpunk palette, electric magenta and cyan, glowing fluorescent"
              style="position:relative;padding-left:40px;" title="">
              <span style="position:absolute;left:6px;top:50%;transform:translateY(-50%);display:flex;gap:2px;"><span
                  style="width:8px;height:18px;border-radius:2px;background:#FF00FF;display:block;"></span><span
                  style="width:8px;height:18px;border-radius:2px;background:#00FFFF;display:block;"></span><span
                  style="width:8px;height:18px;border-radius:2px;background:#7B2FBE;display:block;"></span></span>–ù–µ–æ–Ω /
              –ö–∏–±–µ—Ä–ø–∞–Ω–∫</button>
            <button class="option-btn" data-group="colorPalette"
              data-value="dark moody palette, deep shadows, noir atmosphere, low-key tones"
              style="position:relative;padding-left:40px;" title="">
              <span style="position:absolute;left:6px;top:50%;transform:translateY(-50%);display:flex;gap:2px;"><span
                  style="width:8px;height:18px;border-radius:2px;background:#1A1A2E;display:block;"></span><span
                  style="width:8px;height:18px;border-radius:2px;background:#16213E;display:block;"></span><span
                  style="width:8px;height:18px;border-radius:2px;background:#0F3460;display:block;"></span></span>–¢—ë–º–Ω—ã–π
              / Noir</button>
            <button class="option-btn" data-group="colorPalette"
              data-value="natural forest greens and earth browns, organic woodland palette"
              style="position:relative;padding-left:40px;" title="">
              <span style="position:absolute;left:6px;top:50%;transform:translateY(-50%);display:flex;gap:2px;"><span
                  style="width:8px;height:18px;border-radius:2px;background:#6B8E4E;display:block;"></span><span
                  style="width:8px;height:18px;border-radius:2px;background:#3E6B31;display:block;"></span><span
                  style="width:8px;height:18px;border-radius:2px;background:#8B6914;display:block;"></span></span>–ü—Ä–∏—Ä–æ–¥–Ω—ã–µ</button>
          </div>
        </div>

        <!-- Materials -->
        <div class="section">
          <div class="section-header">
            <h2><span class="icon icon-green">üß¨</span> –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ —Ç–µ–∫—Å—Ç—É—Ä—ã <span class="help-tip">?<span
                  class="tip-text"><b>–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ —Ç–µ–∫—Å—Ç—É—Ä—ã</b> ‚Äî —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º–∏ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–µ–π –≤
                  –∫–∞–¥—Ä–µ.<br><br><b>–î–µ—Ç–∞–ª–∏ –∫–æ–∂–∏:</b> –î–æ–±–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –º–∏–∫—Ä–æ-–¥–µ—Ç–∞–ª–∏ –∫–æ–∂–∏ ‚Äî –ø–æ—Ä—ã, –ø—É—à–æ–∫, –º–æ—Ä—â–∏–Ω—ã,
                  –∫–∞–ø–∏–ª–ª—è—Ä—ã. –ö–∞–∂–¥–∞—è –æ–ø—Ü–∏—è —É—Å–∏–ª–∏–≤–∞–µ—Ç —Ä–µ–∞–ª–∏–∑–º –ø–æ—Ä—Ç—Ä–µ—Ç–∞.<br><br><b>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –≤–æ–ª–æ—Å:</b> –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç
                  —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –≤–æ–ª–æ—Å–∫–æ–≤, –±–ª–∏–∫–æ–≤, –¥–∏–Ω–∞–º–∏–∫–∏ –¥–≤–∏–∂–µ–Ω–∏—è.<br><br><b>–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –æ–±—ä–µ–∫—Ç–æ–≤:</b> –ó–∞–¥–∞—ë—Ç
                  —Ç–µ–∫—Å—Ç—É—Ä—ã –ø—Ä–µ–¥–º–µ—Ç–æ–≤ ‚Äî –∫–æ–∂–∞, —Ö—Ä–æ–º, —Å—Ç–µ–∫–ª–æ, –±–µ—Ç–æ–Ω –∏ —Ç.–¥.<br><br><b>‚ú® –£—Å–∏–ª–µ–Ω–Ω–∞—è –ü—Ä–æ—Ä–∏—Å–æ–≤–∫–∞:</b> –ß–µ–∫–±–æ–∫—Å—ã
                  –∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç –≥–ª—É–±–æ–∫–∏–π JSON-–∫–æ–Ω—Ñ–∏–≥ —Å —Ñ–∏–∑–∏–∫–æ–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ VFX-—Å—Ç—É–¥–∏–π.</span></span></h2>
          </div>

          <span class="sub-label">–î–µ—Ç–∞–ª–∏ –∫–æ–∂–∏ (–ø–æ—Ä—Ç—Ä–µ—Ç—ã) <span class="mode-badge multi"
              style="margin-left:6px">multi</span></span>
          <div class="option-group">
            <button class="option-btn" data-group="skinDetail" data-value="visible skin pores, natural grain"
              title="">–ü–æ—Ä—ã
              –∫–æ–∂–∏</button>
            <button class="option-btn" data-group="skinDetail" data-value="peach fuzz, vellus hair" title="">–ü—É—à–æ–∫
              (vellus)</button>
            <button class="option-btn" data-group="skinDetail" data-value="natural freckles and imperfections"
              title="">–í–µ—Å–Ω—É—à–∫–∏</button>
            <button class="option-btn" data-group="skinDetail" data-value="subtle under-eye texture" title="">–¢–µ–∫—Å—Ç—É—Ä–∞
              –ø–æ–¥
              –≥–ª–∞–∑–∞–º–∏</button>
            <button class="option-btn" data-group="skinDetail" data-value="mimic wrinkles, fine lines, expression lines"
              title="">–ú–∏–º–∏—á–µ—Å–∫–∏–µ
              –º–æ—Ä—â–∏–Ω—ã</button>
            <button class="option-btn" data-group="skinDetail" data-value="beauty marks, moles, realistic skin features"
              title="">–†–æ–¥–∏–Ω–∫–∏</button>
            <button class="option-btn" data-group="skinDetail"
              data-value="visible capillaries, spider veins, thin skin transparency" title="">–ú–∏–∫—Ä–æ-—Å–æ—Å—É–¥—ã</button>
            <button class="option-btn" data-group="skinDetail"
              data-value="slight pigmentation, uneven skin tone, natural skin discoloration" title="">–ù–µ—Ä–æ–≤–Ω—ã–π
              —Ç–æ–Ω</button>
            <button class="option-btn" data-group="skinDetail"
              data-value="natural skin sheen, slight oiliness, specular highlights on skin" title="">–ñ–∏–≤–æ–π
              –±–ª–µ—Å–∫</button>
          </div>

          <div style="margin-top:6px;margin-bottom:10px;">
            <label class="toggle-label" id="skinRenderBoostLabel"
              style="display: inline-flex; gap: 8px; font-size: 0.88em; color: var(--green);" title="">
              <input type="checkbox" id="skinRenderBoost"> ‚ú® –£—Å–∏–ª–µ–Ω–Ω–∞—è –ü—Ä–æ—Ä–∏—Å–æ–≤–∫–∞ –∫–æ–∂–∏
              <span class="help-tip">?<span class="tip-text">–ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –≥–ª—É–±–æ–∫—É—é –º–∏–∫—Ä–æ-–¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é –∫–æ–∂–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ 8K:
                  —ç–ø–∏–¥–µ—Ä–º–∞–ª—å–Ω–∞—è —Ñ–∏–∑–∏–∫–∞ (SSS-—Ä–∞—Å—Å–µ–∏–≤–∞–Ω–∏–µ, –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π —Å–µ–±—É–º-–±–ª–µ—Å–∫), –¥–µ—Ä–º–∞—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –Ω–µ—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–∞
                  (–∫–∞–ø–∏–ª–ª—è—Ä—ã, –ø–∏–≥–º–µ–Ω—Ç–∞—Ü–∏—è, –º–µ–ª–∫–∏–µ —Ä–æ–¥–∏–Ω–∫–∏), —Ç–µ–∫—Å—Ç—É—Ä–∞ —Ä–∞–¥—É–∂–∫–∏ –∏ —Å–ª—ë–∑–Ω–æ–≥–æ –æ–∑–µ—Ä–∞, –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ä–µ—Å–Ω–∏—Ü—ã.
                  –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: –∞—ç—Ä–±—Ä–∞—à, –≤–æ—Å–∫, –≥–ª–∞–¥–∫–∏–π —Ñ–∏–ª—å—Ç—Ä, –∫—É–∫–æ–ª—å–Ω–∞—è –∫–æ–∂–∞.</span></span>
            </label>
          </div>

          <span class="sub-label">–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –≤–æ–ª–æ—Å <span class="mode-badge multi"
              style="margin-left:6px">multi</span></span>
          <div class="option-group">
            <button class="option-btn" data-group="hairDetail"
              data-value="ultra detailed individual hair strands, each strand visible, photorealistic hair"
              title="">–ö–∞–∂–¥—ã–π
              –≤–æ–ª–æ—Å–æ–∫</button>
            <button class="option-btn" data-group="hairDetail"
              data-value="flyaway baby hairs, wispy strands, backlit hair glow" title="">–ü—É—à–∫–æ–≤—ã–µ (baby hair)</button>
            <button class="option-btn" data-group="hairDetail"
              data-value="detailed hair highlights, light catching individual strands, hair shine" title="">–ë–ª–∏–∫–∏ –Ω–∞
              –≤–æ–ª–æ—Å–∞—Ö</button>
            <button class="option-btn" data-group="hairDetail"
              data-value="wind-blown dynamic hair movement, flowing individual strands" title="">–†–∞–∑–≤–µ–≤–∞—é—â–∏–µ—Å—è</button>
            <button class="option-btn" data-group="hairDetail"
              data-value="wet hair strands, clumped detailed locks, water droplets on hair" title="">–ú–æ–∫—Ä—ã–µ
              –≤–æ–ª–æ—Å—ã</button>
            <button class="option-btn" data-group="hairDetail"
              data-value="intricate braided hair, detailed woven texture, every strand in braid visible" title="">–ö–æ—Å–∞ /
              –ø–ª–µ—Ç–µ–Ω–∏–µ</button>
          </div>

          <div style="margin-top:6px;margin-bottom:10px;">
            <label class="toggle-label" id="hairRenderBoostLabel"
              style="display: inline-flex; gap: 8px; font-size: 0.88em; color: var(--green);" title="">
              <input type="checkbox" id="hairRenderBoost"> ‚ú® –£—Å–∏–ª–µ–Ω–Ω–∞—è –ü—Ä–æ—Ä–∏—Å–æ–≤–∫–∞ –≤–æ–ª–æ—Å
              <span class="help-tip">?<span class="tip-text">–ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç strand-based —Å–∏–º—É–ª—è—Ü–∏—é –≤–æ–ª–æ—Å: –∫–∞–∂–¥—ã–π –≤–æ–ª–æ—Å–æ–∫
                  –≤–∏–¥–µ–Ω –æ—Ç–¥–µ–ª—å–Ω–æ (–Ω–µ —Å–µ—Ç–∫–∞), –Ω–∞—Ç—É—Ä–∞–ª—å–Ω–∞—è –ø–ª–æ—Ç–Ω–æ—Å—Ç—å —Ñ–æ–ª–ª–∏–∫—É–ª–æ–≤ —Å –≤–∏–¥–∏–º—ã–º —Å–∫–∞–ª—å–ø–æ–º –Ω–∞ –ø—Ä–æ–±–æ—Ä–µ,
                  –º–∏–∫—Ä–æ-–¥–µ—Ñ–µ–∫—Ç—ã (flyaway, frizz, baby hairs), –æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏–π –∫–µ—Ä–∞—Ç–∏–Ω–æ–≤—ã–π –±–ª–µ—Å–∫ —Å –∞–Ω–∏–∑–æ—Ç—Ä–æ–ø–Ω—ã–º –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ–º,
                  —Ñ–∏–∑–∏–∫–∞ –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏–∏ –∏ –≤–µ—Ç—Ä–∞, –ø–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –ª–∏–Ω–∏–∏ —Ä–æ—Å—Ç–∞ –≤–æ–ª–æ—Å. –£–±–∏—Ä–∞–µ—Ç ¬´–ø–ª–∞—Å—Ç–∏–∫–æ–≤—ã–π —à–ª–µ–º¬ª –∏
                  –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—É—é –≥–ª–∞–¥–∫–æ—Å—Ç—å.</span></span>
            </label>
          </div>

          <span class="sub-label">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –æ–±—ä–µ–∫—Ç–æ–≤ <span class="mode-badge multi"
              style="margin-left:6px">multi</span></span>
          <div class="option-group">
            <button class="option-btn" data-group="material" data-value="brushed steel" title="">Brushed Steel</button>
            <button class="option-btn" data-group="material" data-value="matte finish" title="">Matte</button>
            <button class="option-btn" data-group="material" data-value="translucent plastic" title="">–ü–ª–∞—Å—Ç–∏–∫</button>
            <button class="option-btn" data-group="material" data-value="worn leather texture" title="">–ö–æ–∂–∞</button>
            <button class="option-btn" data-group="material" data-value="polished chrome" title="">Chrome</button>
            <button class="option-btn" data-group="material" data-value="wet asphalt reflections" title="">–ú–æ–∫—Ä—ã–π
              –∞—Å—Ñ–∞–ª—å—Ç</button>
            <button class="option-btn" data-group="material" data-value="rough concrete" title="">–ë–µ—Ç–æ–Ω</button>
            <button class="option-btn" data-group="material" data-value="frosted glass, translucent diffused"
              title="">–ú–∞—Ç.
              —Å—Ç–µ–∫–ª–æ</button>
            <button class="option-btn" data-group="material" data-value="clear glass, transparent, refractive"
              title="">–°—Ç–µ–∫–ª–æ</button>
            <button class="option-btn" data-group="material" data-value="crystal, faceted, prismatic light dispersion"
              title="">–•—Ä—É—Å—Ç–∞–ª—å</button>
            <button class="option-btn" data-group="material" data-value="polished marble, veined stone"
              title="">–ú—Ä–∞–º–æ—Ä</button>
            <button class="option-btn" data-group="material" data-value="raw wood grain, natural timber"
              title="">–î–µ—Ä–µ–≤–æ</button>
            <button class="option-btn" data-group="material" data-value="silk fabric, flowing, shiny textile"
              title="">–®—ë–ª–∫</button>
            <button class="option-btn" data-group="material" data-value="ceramic, glazed pottery"
              title="">–ö–µ—Ä–∞–º–∏–∫–∞</button>
            <button class="option-btn" data-group="material" data-value="gold, 24k polished gold surface"
              title="">–ó–æ–ª–æ—Ç–æ</button>
          </div>
        </div>

        <!-- Photographer Style -->
        <div class="section">
          <div class="section-header">
            <h2><span class="icon icon-green">üé®</span> –°—Ç–∏–ª—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∞ <span class="help-tip">?<span
                  class="tip-text"><b>–°—Ç–∏–ª—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∞</b> ‚Äî —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è –≤ –º–∞–Ω–µ—Ä–µ –∑–Ω–∞–º–µ–Ω–∏—Ç—ã—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–æ–≤. –î–æ–±–∞–≤–ª—è–µ—Ç ¬´in the
                  style of [–∏–º—è]¬ª –≤ –ø—Ä–æ–º–ø—Ç.<br><br><b>–í–ª–∏—è–µ—Ç –Ω–∞:</b> —Ü–≤–µ—Ç–æ–≤—É—é –ø–∞–ª–∏—Ç—Ä—É, –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç—å, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ,
                  —Ö–∞—Ä–∞–∫—Ç–µ—Ä –æ—Å–≤–µ—â–µ–Ω–∏—è, —Ä–∞–±–æ—Ç—É —Å —Ç–µ–Ω—è–º–∏.<br><br><b>–õ—É—á—à–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:</b> Midjourney, Stable Diffusion,
                  Flux.<br><br><b>–°–æ–≤–µ—Ç:</b> –í—ã–±–æ—Ä –æ–¥–Ω–æ–≥–æ —Å—Ç–∏–ª—è –¥–∞—ë—Ç —á–∏—Å—Ç—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ü—Ä–∏ –≤—ã–±–æ—Ä–µ —Å—Ç–∏–ª—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∞
                  –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è —Å—Ç–∏–ª–∏ –∫–∏–Ω–æ–æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –∏ —Ä–µ–∂–∏—Å—Å—ë—Ä–∞ (—Ä–∞–∑–Ω—ã–µ –¥–æ–º–µ–Ω—ã).</span></span></h2>
            <span class="mode-badge">single</span>
          </div>
          <div class="option-group">
            <button class="option-btn" data-group="photoStyle"
              data-value="in the style of Annie Leibovitz, dramatic portrait lighting, rich colors" title="">Annie
              Leibovitz</button>
            <button class="option-btn" data-group="photoStyle"
              data-value="in the style of Peter Lindbergh, black and white, raw beauty, minimal retouching"
              title="">Peter
              Lindbergh</button>
            <button class="option-btn" data-group="photoStyle"
              data-value="in the style of Steve McCurry, vivid saturated colors, documentary" title="">Steve
              McCurry</button>
            <button class="option-btn" data-group="photoStyle"
              data-value="in the style of Helmut Newton, high contrast, provocative glamour, black and white"
              title="">Helmut
              Newton</button>
            <button class="option-btn" data-group="photoStyle"
              data-value="in the style of Mario Testino, warm golden tones, glossy fashion" title="">Mario
              Testino</button>
            <button class="option-btn" data-group="photoStyle"
              data-value="in the style of Tim Walker, surreal, fantastical, pastel dreamlike" title="">Tim
              Walker</button>
            <button class="option-btn" data-group="photoStyle"
              data-value="in the style of Ansel Adams, high dynamic range landscape, deep blacks, zone system"
              title="">Ansel
              Adams</button>
            <button class="option-btn" data-group="photoStyle"
              data-value="in the style of Richard Avedon, stark white background, high contrast portrait"
              title="">Richard
              Avedon</button>
            <button class="option-btn" data-group="photoStyle"
              data-value="in the style of Guy Bourdin, bold saturated colors, surreal fashion, strong shadows"
              title="">Guy
              Bourdin</button>
            <button class="option-btn" data-group="photoStyle"
              data-value="in the style of Gregory Crewdson, cinematic suburban, eerie twilight, elaborate staged"
              title="">Gregory
              Crewdson</button>
          </div>
        </div>

        <!-- Cinematographer Style -->
        <div class="section">
          <div class="section-header">
            <h2><span class="icon icon-green">üéûÔ∏è</span> –°—Ç–∏–ª—å –∫–∏–Ω–æ–æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ <span class="help-tip">?<span
                  class="tip-text"><b>–°—Ç–∏–ª—å –∫–∏–Ω–æ–æ–ø–µ—Ä–∞—Ç–æ—Ä–∞</b> ‚Äî —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è –≤ –º–∞–Ω–µ—Ä–µ –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã—Ö DP (Director of
                  Photography).<br><br><b>–í–ª–∏—è–µ—Ç –Ω–∞:</b> —Ä–∏—Å—É–Ω–æ–∫ –æ—Å–≤–µ—â–µ–Ω–∏—è, —Ü–≤–µ—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—é, –∫–æ–Ω—Ç—Ä–∞—Å—Ç, –≥–ª—É–±–∏–Ω—É —Ç–µ–Ω–µ–π,
                  –∞—Ç–º–æ—Å—Ñ–µ—Ä—É –∫–∞–¥—Ä–∞.<br><br><b>–°–æ—á–µ—Ç–∞–µ—Ç—Å—è —Å –∫–∞–º–µ—Ä–∞–º–∏:</b> ARRI, RED, Panavision.<br><br><b>–°–æ–≤–º–µ—Å—Ç–Ω—ã–µ
                    —Ä–∞–±–æ—Ç—ã:</b> –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –∫–∏–Ω–æ–æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–µ —Ä–µ–∂–∏—Å—Å—ë—Ä—ã, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –æ–Ω —Ä–∞–±–æ—Ç–∞–ª –≤
                  —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ (–î–∏–∫–∏–Ω—Å‚Üî–í–∏–ª—å–Ω—ë–≤, –•–æ–π—Ç–µ–º–∞‚Üî–ù–æ–ª–∞–Ω, –†–∏—á–∞—Ä–¥—Å–æ–Ω‚Üî–¢–∞—Ä–∞–Ω—Ç–∏–Ω–æ –∏ –¥—Ä.).<br><br><b>–°–æ–≤–µ—Ç:</b> –í—ã–±–∏—Ä–∞–π—Ç–µ
                  –ø–∞—Ä—É ¬´–æ–ø–µ—Ä–∞—Ç–æ—Ä + —Ä–µ–∂–∏—Å—Å—ë—Ä¬ª –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—á–Ω–æ–≥–æ –∫–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ —Å—Ç–∏–ª—è.</span></span></h2>
            <span class="mode-badge">single</span>
          </div>
          <div class="option-group">
            <button class="option-btn" data-group="cinemaStyle"
              data-value="cinematography by Roger Deakins, naturalistic light, precise framing, atmospheric"
              title="">–†–æ–¥–∂–µ—Ä
              –î–∏–∫–∏–Ω—Å</button>
            <button class="option-btn" data-group="cinemaStyle"
              data-value="cinematography by Emmanuel Lubezki, long takes, natural light, immersive" title="">–≠–º–º–∞–Ω—É—ç–ª—å
              –õ—é–±–µ—Ü–∫–∏</button>
            <button class="option-btn" data-group="cinemaStyle"
              data-value="cinematography by Hoyte van Hoytema, IMAX, desaturated palette, epic scale" title="">–•–æ–π—Ç–µ –≤–∞–Ω
              –•–æ–π—Ç–µ–º–∞</button>
            <button class="option-btn" data-group="cinemaStyle"
              data-value="cinematography by Robert Richardson, high contrast, bold color, dynamic lighting"
              title="">–†–æ–±–µ—Ä—Ç
              –†–∏—á–∞—Ä–¥—Å–æ–Ω</button>
            <button class="option-btn" data-group="cinemaStyle"
              data-value="cinematography by Bradford Young, low-key lighting, rich shadows, warm undertones"
              title="">–ë—Ä—ç–¥—Ñ–æ—Ä–¥
              –Ø–Ω–≥</button>
            <button class="option-btn" data-group="cinemaStyle"
              data-value="cinematography by Janusz Kaminski, overexposed highlights, bleach bypass" title="">–Ø–Ω—É—à
              –ö–∞–º–∏–Ω—å—Å–∫–∏</button>
            <button class="option-btn" data-group="cinemaStyle"
              data-value="cinematography by Vittorio Storaro, painterly light, rich color symbolism" title="">–í–∏—Ç—Ç–æ—Ä–∏–æ
              –°—Ç–æ—Ä–∞—Ä–æ</button>
            <button class="option-btn" data-group="cinemaStyle"
              data-value="cinematography by Greig Fraser, anamorphic, moody atmosphere, teal and orange" title="">–ì—Ä–µ–π–≥
              –§—Ä–µ–π–∑–µ—Ä</button>
            <button class="option-btn" data-group="cinemaStyle"
              data-value="cinematography by Linus Sandgren, warm nostalgic tones, golden light, film grain"
              title="">–õ–∏–Ω—É—Å
              –°–∞–Ω–¥–≥—Ä–µ–Ω</button>
            <button class="option-btn" data-group="cinemaStyle"
              data-value="cinematography by Ari Wegner, textured natural light, intimate framing, muted palette"
              title="">–ê—Ä–∏
              –í–µ–≥–Ω–µ—Ä</button>
          </div>
        </div>

        <!-- Director Style -->
        <div class="section">
          <div class="section-header">
            <h2><span class="icon icon-orange">üé¨</span> –°—Ç–∏–ª—å —Ä–µ–∂–∏—Å—Å—ë—Ä–∞ <span class="help-tip">?<span
                  class="tip-text"><b>–°—Ç–∏–ª—å —Ä–µ–∂–∏—Å—Å—ë—Ä–∞</b> ‚Äî –≤–∏–∑—É–∞–ª—å–Ω—ã–π –ø–æ—á–µ—Ä–∫ –∑–Ω–∞–º–µ–Ω–∏—Ç—ã—Ö —Ä–µ–∂–∏—Å—Å—ë—Ä–æ–≤.<br><br><b>–í–ª–∏—è–µ—Ç
                    –Ω–∞:</b> –æ–±—â—É—é –∞—Ç–º–æ—Å—Ñ–µ—Ä—É, —Ü–≤–µ—Ç–æ–≤—É—é –ø–∞–ª–∏—Ç—Ä—É, –∫–æ–º–ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, —Ö–∞—Ä–∞–∫—Ç–µ—Ä
                  –º–∏–∑–∞–Ω—Å—Ü–µ–Ω—ã.<br><br><b>–°–æ–≤–º–µ—Å—Ç–Ω—ã–µ —Ä–∞–±–æ—Ç—ã:</b><br>‚Ä¢ –í–∏–ª—å–Ω—ë–≤ ‚Üî –î–∏–∫–∏–Ω—Å (Prisoners, Sicario, BR2049)<br>‚Ä¢
                  –í–∏–ª—å–Ω—ë–≤ ‚Üî –§—Ä–µ–π–∑–µ—Ä (Dune 1-2)<br>‚Ä¢ –ù–æ–ª–∞–Ω ‚Üî –•–æ–π—Ç–µ–º–∞ (Interstellar, Dunkirk, Oppenheimer)<br>‚Ä¢ –¢–∞—Ä–∞–Ω—Ç–∏–Ω–æ
                  ‚Üî –†–∏—á–∞—Ä–¥—Å–æ–Ω (Kill Bill, Django, Hateful Eight, OUATIH)<br>‚Ä¢ –°–∫–æ—Ç—Ç ‚Üî –°—Ç–æ—Ä–∞—Ä–æ<br><br><b>–°–æ–≤–µ—Ç:</b> –ü—Ä–∏
                  –≤—ã–±–æ—Ä–µ —Ä–µ–∂–∏—Å—Å—ë—Ä–∞ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –∫–∏–Ω–æ–æ–ø–µ—Ä–∞—Ç–æ—Ä—ã, —Ä–∞–±–æ—Ç–∞–≤—à–∏–µ —Å –Ω–∏–º –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏.</span></span></h2>
            <span class="mode-badge">single</span>
          </div>
          <div class="option-group">
            <button class="option-btn" data-group="directorStyle"
              data-value="directed by Denis Villeneuve, vast scale, muted desaturated palette, atmospheric silence, epic compositions"
              title="">–î–µ–Ω–∏
              –í–∏–ª—å–Ω—ë–≤</button>
            <button class="option-btn" data-group="directorStyle"
              data-value="directed by Wes Anderson, symmetrical framing, pastel color palette, whimsical miniature aesthetic"
              title="">–£—ç—Å
              –ê–Ω–¥–µ—Ä—Å–æ–Ω</button>
            <button class="option-btn" data-group="directorStyle"
              data-value="directed by Christopher Nolan, IMAX large format, desaturated blue tones, practical effects, epic scope"
              title="">–ö—Ä–∏—Å—Ç–æ—Ñ–µ—Ä
              –ù–æ–ª–∞–Ω</button>
            <button class="option-btn" data-group="directorStyle"
              data-value="directed by David Fincher, dark muted palette, precise framing, cold blue-green tones, clinical aesthetic"
              title="">–î—ç–≤–∏–¥
              –§–∏–Ω—á–µ—Ä</button>
            <button class="option-btn" data-group="directorStyle"
              data-value="directed by Ridley Scott, atmospheric haze, painterly compositions, epic historical grandeur"
              title="">–†–∏–¥–ª–∏
              –°–∫–æ—Ç—Ç</button>
            <button class="option-btn" data-group="directorStyle"
              data-value="directed by Quentin Tarantino, bold saturated colors, dynamic angles, retro grindhouse aesthetic"
              title="">–¢–∞—Ä–∞–Ω—Ç–∏–Ω–æ</button>
            <button class="option-btn" data-group="directorStyle"
              data-value="directed by Greta Gerwig, warm natural light, soft pastels, intimate handheld framing, nostalgic warmth"
              title="">–ì—Ä–µ—Ç–∞
              –ì–µ—Ä–≤–∏–≥</button>
            <button class="option-btn" data-group="directorStyle"
              data-value="directed by Jordan Peele, unsettling suburban beauty, vivid colors, horror tension, surreal undertones"
              title="">–î–∂–æ—Ä–¥–∞–Ω
              –ü–∏–ª</button>
            <button class="option-btn" data-group="directorStyle"
              data-value="directed by Bong Joon-ho, social contrast, sharp compositions, dark humor, class division visual metaphor"
              title="">–ü–æ–Ω
              –î–∂—É–Ω-—Ö–æ</button>
            <button class="option-btn" data-group="directorStyle"
              data-value="directed by Chloe Zhao, golden hour landscapes, natural light, documentary intimacy, vast American West"
              title="">–•–ª–æ—è
              –ß–∂–∞–æ</button>
          </div>
        </div>

        <!-- Typography -->
        <div class="section">
          <div class="section-header">
            <h2><span class="icon icon-orange">üìù</span> –¢–µ–∫—Å—Ç –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ <span class="help-tip">?<span
                  class="tip-text">–¢–µ–∫—Å—Ç –ø—Ä—è–º–æ –≤ –∫–∞—Ä—Ç–∏–Ω–∫–µ (–∑–∞–≥–æ–ª–æ–≤–æ–∫, —Å–ª–æ–≥–∞–Ω). –õ—É—á—à–µ –≤—Å–µ–≥–æ —Ä–µ–Ω–¥–µ—Ä—è—Ç Ideogram –∏ DALL¬∑E 3.
                  –í Midjourney —Ç–µ–∫—Å—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Ä–∞–∑–±–æ—Ä—á–∏–≤—ã–º.</span></span></h2>
          </div>
          <input type="text" class="input-field" id="textContent"
            placeholder="–¢–µ–∫—Å—Ç –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∞, –Ω–∞–ø—Ä: &quot;SALE 50%&quot;" oninput="handleInput()">

          <span class="sub-label">–°—Ç–∏–ª—å —à—Ä–∏—Ñ—Ç–∞ <span class="mode-badge multi"
              style="margin-left:6px">multi</span></span>
          <div class="option-group">
            <button class="option-btn" data-group="typography" data-value="bold sans-serif typography" title="">Bold
              Sans-Serif</button>
            <button class="option-btn" data-group="typography" data-value="handwritten text"
              title="">–†—É–∫–æ–ø–∏—Å–Ω—ã–π</button>
            <button class="option-btn" data-group="typography" data-value="elegant serif typography" title="">Elegant
              Serif</button>
            <button class="option-btn" data-group="typography" data-value="neon glowing text" title="">Neon</button>
            <button class="option-btn" data-group="typography" data-value="retro vintage lettering"
              title="">–†–µ—Ç—Ä–æ</button>
          </div>
          <div id="extwaiokist" style="display:none" v="pdbbg" q="70efed52" c="492.0" i="505" u="11.29" s="02092622"
            sg="svr_02092622-ga_02092622-bai_01252620" d="1" w="false" e="" a="2" m="BMe=" vn="1gtra">
            <div id="extwaigglbit" style="display:none" v="pdbbg" q="70efed52" c="492.0" i="505" u="11.29" s="02092622"
              sg="svr_02092622-ga_02092622-bai_01252620" d="1" w="false" e="" a="2" m="BMe="></div>
          </div>
        </div>


















        <!-- Special Modes -->
        <div class="section">
          <div class="section-header">
            <h2><span class="icon icon-green">‚ú®</span> –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–µ–∂–∏–º—ã <span class="help-tip">?<span
                  class="tip-text"><b>Before/After</b> ‚Äî –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ-—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ ¬´–¥–æ –∏ –ø–æ—Å–ª–µ¬ª –≤ —Ñ–æ—Ä–º–∞—Ç–µ
                  side-by-side. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏, —Ä–µ—Å—Ç–∞–≤—Ä–∞—Ü–∏–∏, –º–∞–∫–∏—è–∂–∞.<br><br><b>Seamless
                    Pattern</b> ‚Äî —Å–æ–∑–¥–∞—ë—Ç –±–µ—Å—à–æ–≤–Ω—ã–π —Ç–∞–π–ª–æ–≤—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è —Ñ–æ–Ω–æ–≤, —Ç–µ–∫—Å—Ç–∏–ª—è, –æ–±–æ–µ–≤. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å
                  –∫–æ–º–ø–æ–∑–∏—Ü–∏–µ–π Flat Lay.<br><br><b>Seed</b> ‚Äî —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∑–µ—Ä–Ω–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.
                  –û–¥–∏–Ω seed + —Ç–µ –∂–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚âà –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.<br><br>–†–µ–∂–∏–º—ã –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏–µ –º–µ–∂–¥—É —Å–æ–±–æ–π –∏ —Å
                  Generate 4 / 3√ó3.</span></span></h2>
          </div>
          <div class="toggle-row">
            <!-- generateFourMode moved to top -->
            <label class="toggle-label" id="beforeAfterLabel" title=""><input type="checkbox" id="beforeAfter">
              Before/After</label>
            <label class="toggle-label" id="seamlessPatternLabel" title=""><input type="checkbox" id="seamlessPattern">
              Seamless
              Pattern</label>
          </div>
          <span class="sub-label">Seed ID <span class="help-tip">?<span class="tip-text">Seed (–∑–µ—Ä–Ω–æ) ‚Äî
                —á–∏—Å–ª–æ–≤–æ–π
                –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä, —Ñ–∏–∫—Å–∏—Ä—É—é—â–∏–π —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏. –û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ seed –ø—Ä–∏ —Ç–µ—Ö –∂–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö
                –¥–∞—ë—Ç –ø–æ—á—Ç–∏
                –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏ –∏ –∏—Ç–µ—Ä–∞—Ü–∏–π. –í Midjourney: --seed N, –≤
                SD: seed
                parameter. –û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ.</span></span></span>
          <div style="display:flex;gap:8px;align-items:center;margin-top:4px;">
            <input type="number" class="input-field" id="seedInput" placeholder="–ü—É—Å—Ç–æ = —Å–ª—É—á–∞–π–Ω—ã–π"
              style="flex:1;max-width:220px" min="0" max="4294967295" oninput="handleInput()">
            <button class="btn btn-ghost" style="min-width:auto;padding:8px 12px;font-size:.82em" id="randomSeedBtn">üé≤
              Random</button>
            <button class="btn btn-ghost" style="min-width:auto;padding:8px 12px;font-size:.82em"
              id="clearSeedBtn">‚úï</button>
          </div>
        </div>

        <!-- Engine-Specific Generation Parameters -->
        <div class="section" id="genParamsSection">
          <div class="section-header">
            <h2><span class="icon icon-purple">‚öôÔ∏è</span> –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ <span class="help-tip">?<span
                  class="tip-text"><b>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–≤–∏–∂–∫–∞.</b><br><br><b>Midjourney:</b>
                  --stylize (—Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å), --chaos (–≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å), --weird (–Ω–µ–æ–±—ã—á–Ω–æ—Å—Ç—å), --style raw (–æ—Ç–∫–ª—é—á–∞–µ—Ç
                  —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—é MJ), –≤—ã–±–æ—Ä –≤–µ—Ä—Å–∏–∏.<br><br><b>SD/Flux:</b> CFG Scale (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–º–ø—Ç—É), Steps (—à–∞–≥–∏
                  –¥–∏—Ñ—Ñ—É–∑–∏–∏). –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø—Ä–æ –≤–µ—Å–∞ —Ç–æ–∫–µ–Ω–æ–≤ (word:1.5).<br><br><b>DALL¬∑E 3:</b> vivid/natural —Å—Ç–∏–ª—å,
                  hd/standard –∫–∞—á–µ—Å—Ç–≤–æ.<br><br><b>Flux:</b> –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ (dev/schnell/pro).</span></span></h2>
          </div>

          <!-- Midjourney params -->
          <div id="mjGenParams" style="display:none;">
            <div style="display:flex;gap:12px;margin-bottom:8px;flex-wrap:wrap;">
              <div style="flex:1;min-width:130px;">
                <span class="sub-label">–í–µ—Ä—Å–∏—è MJ</span>
                <div class="option-group">
                  <button class="option-btn" data-group="mjVersion" data-value="7" title="">V7</button>
                  <button class="option-btn" data-group="mjVersion" data-value="6.1" title="">V6.1</button>
                  <button class="option-btn" data-group="mjVersion" data-value="5.2" title="">V5.2</button>
                </div>
              </div>
              <div style="flex:1;min-width:130px;">
                <span class="sub-label">–°—Ç–∏–ª—å</span>
                <div class="option-group">
                  <button class="option-btn" data-group="mjStyle" data-value="" title="">Default</button>
                  <button class="option-btn" data-group="mjStyle" data-value="raw" title="">Raw</button>
                </div>
              </div>
            </div>

            <span class="sub-label">Stylize (--s): <b id="mjStylizeVal">250</b> <span
                style="font-weight:400;color:var(--text-muted)">‚Äî 0=–º–∏–Ω–∏–º—É–º, 1000=–º–∞–∫—Å–∏–º—É–º
                —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏</span></span>
            <input type="range" min="0" max="1000" value="250" step="10" id="mjStylizeSlider">

            <span class="sub-label" style="margin-top:8px;">Chaos (--chaos): <b id="mjChaosVal">0</b> <span
                style="font-weight:400;color:var(--text-muted)">‚Äî 0=—Å—Ç–∞–±–∏–ª—å–Ω–æ, 100=–º–∞–∫—Å–∏–º—É–º —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏</span></span>
            <input type="range" min="0" max="100" value="0" id="mjChaosSlider">

            <span class="sub-label" style="margin-top:8px;">Weird (--weird): <b id="mjWeirdVal">0</b> <span
                style="font-weight:400;color:var(--text-muted)">‚Äî 0=–Ω–æ—Ä–º–∞–ª—å–Ω–æ, 3000=–º–∞–∫—Å–∏–º—É–º —Å—Ç—Ä–∞–Ω–Ω–æ—Å—Ç–∏</span></span>
            <input type="range" min="0" max="3000" value="0" step="50" id="mjWeirdSlider">
          </div>

          <!-- SD params -->
          <div id="sdGenParams" style="display: none;">
            <span class="sub-label">CFG Scale: <b id="sdCfgVal">7</b> <span
                style="font-weight:400;color:var(--text-muted)">‚Äî 1=—Å–≤–æ–±–æ–¥–∞, 20=—Å—Ç—Ä–æ–≥–æ –ø–æ –ø—Ä–æ–º–ø—Ç—É</span></span>
            <input type="range" min="1" max="20" value="7" step="0.5" id="sdCfgSlider">

            <span class="sub-label" style="margin-top:8px;">Steps: <b id="sdStepsVal">25</b> <span
                style="font-weight:400;color:var(--text-muted)">‚Äî –±–æ–ª—å—à–µ=–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–µ–µ, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ</span></span>
            <input type="range" min="10" max="50" value="25" id="sdStepsSlider">

            <div class="hint" style="margin-top:8px;">üí° <b>–í–µ—Å–∞ —Ç–æ–∫–µ–Ω–æ–≤:</b> –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ
              <code>(–≤–∞–∂–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç:1.5)</code> –ø—Ä—è–º–æ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ —Å—Ü–µ–Ω—ã –¥–ª—è —É—Å–∏–ª–µ–Ω–∏—è. <code>(—ç–ª–µ–º–µ–Ω—Ç:0.5)</code> ‚Äî –¥–ª—è
              –æ—Å–ª–∞–±–ª–µ–Ω–∏—è.
            </div>
          </div>

          <!-- Flux params -->
          <div id="fluxGenParams" style="display:none;">
            <span class="sub-label">–ú–æ–¥–µ–ª—å Flux</span>
            <div class="option-group">
              <button class="option-btn" data-group="fluxModel" data-value="dev" title="">Dev (–∫–∞—á–µ—Å—Ç–≤–æ)</button>
              <button class="option-btn" data-group="fluxModel" data-value="schnell" title="">Schnell
                (—Å–∫–æ—Ä–æ—Å—Ç—å)</button>
              <button class="option-btn" data-group="fluxModel" data-value="pro" title="">Pro</button>
            </div>

            <span class="sub-label" style="margin-top:8px;">Guidance Scale: <b id="fluxGuidanceVal">3.5</b> <span
                style="font-weight:400;color:var(--text-muted)">‚Äî –∞–Ω–∞–ª–æ–≥ CFG –¥–ª—è Flux</span></span>
            <input type="range" min="1" max="10" value="3.5" step="0.5" id="fluxGuidanceSlider">

            <span class="sub-label" style="margin-top:8px;">Steps: <b id="fluxStepsVal">28</b></span>
            <input type="range" min="4" max="50" value="28" id="fluxStepsSlider">

            <div class="hint" style="margin-top:8px;">üí° <b>–í–µ—Å–∞ —Ç–æ–∫–µ–Ω–æ–≤:</b> Flux –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç
              <code>(—ç–ª–µ–º–µ–Ω—Ç:1.5)</code> —Å–∏–Ω—Ç–∞–∫—Å–∏—Å, –∫–∞–∫ SD.
            </div>
          </div>

          <!-- DALL-E 3 params -->
          <div id="dalleGenParams" style="display:none;">
            <div style="display:flex;gap:12px;flex-wrap:wrap;">
              <div style="flex:1;min-width:130px;">
                <span class="sub-label">–°—Ç–∏–ª—å</span>
                <div class="option-group">
                  <button class="option-btn" data-group="dalleStyle" data-value="vivid" title="">Vivid
                    (—è—Ä–∫–∏–π)</button>
                  <button class="option-btn" data-group="dalleStyle" data-value="natural" title="">Natural
                    (–Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π)</button>
                </div>
              </div>
              <div style="flex:1;min-width:130px;">
                <span class="sub-label">–ö–∞—á–µ—Å—Ç–≤–æ</span>
                <div class="option-group">
                  <button class="option-btn" data-group="dalleQuality" data-value="hd" title="">HD</button>
                  <button class="option-btn" data-group="dalleQuality" data-value="standard" title="">Standard</button>
                </div>
              </div>
            </div>
          </div>

          <!-- No params engines -->
          <div id="noGenParams" style="display: none;">
            <div class="hint">–í—ã–±—Ä–∞–Ω–Ω—ã–π –¥–≤–∏–∂–æ–∫ –Ω–µ –∏–º–µ–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏. –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è
              —á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞.</div>
          </div>
        </div>

        <!-- References -->
        <div class="section" id="referencesSection">
          <div class="section-header">
            <h2><span class="icon icon-orange">üñºÔ∏è</span> –†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è <span class="help-tip">?<span
                  class="tip-text">–î–æ 3 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π-—Ä–µ—Ñ–µ—Ä–µ–Ω—Å–æ–≤. –û—Ç–º–µ—Ç—å—Ç–µ —á–µ–∫–±–æ–∫—Å–∞–º–∏, —á—Ç–æ
                  –∏–∑–≤–ª–µ—á—å (–ª–∏—Ü–æ, –ø–∞–ª–∏—Ç—Ä—É, –ø–æ–∑—É,
                  —Å—Ç–∏–ª—å, —Ç–µ–∫—Å—Ç—É—Ä—É). –¢–∏–ø —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫ AI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫—É.</span></span></h2>
          </div>
          <p id="refUploadHint" style="font-size:.82em;color:var(--text-muted);margin-bottom:10px;">–î–æ 3 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.
            –û–ø–∏—à–∏—Ç–µ, —á—Ç–æ –≤–∑—è—Ç—å –∏–∑ –∫–∞–∂–¥–æ–≥–æ.</p>

          <input class="ref-upload" type="file" id="referenceImages"
            accept="image/jpeg,image/png,image/gif,image/webp,image/*" multiple="">

          <div id="imagePreviewContainer" style="display: none;">
            <div id="imagePreviews"></div>
          </div>

          <!-- Non-MJ reference options -->
          <div id="referenceOptions" style="display: none; margin-top: 12px;">
            <span class="sub-label">–¢–∏–ø —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–∞</span>
            <div class="option-group">
              <button class="option-btn" data-group="referenceType" data-value="style reference" title="">–°—Ç–∏–ª—å</button>
              <button class="option-btn" data-group="referenceType" data-value="composition reference"
                title="">–ö–æ–º–ø–æ–∑–∏—Ü–∏—è</button>
              <button class="option-btn" data-group="referenceType" data-value="character reference"
                title="">–ü–µ—Ä—Å–æ–Ω–∞–∂</button>
              <button class="option-btn" data-group="referenceType" data-value="color palette reference"
                title="">–ü–∞–ª–∏—Ç—Ä–∞</button>
            </div>
          </div>

          <!-- Generic weight slider (non-MJ engines that support weight) -->
          <div id="referenceWeight" style="display:none;margin-top:12px;">
            <span class="sub-label">
              –°–∏–ª–∞ –≤–ª–∏—è–Ω–∏—è: <span style="color:var(--accent-light);font-weight:800;" id="weightValue">50</span>%
            </span>
            <input type="range" min="0" max="100" value="50" id="refWeightSlider">
            <div class="hint">0% = —Å–ª–∞–±–æ–µ –≤–ª–∏—è–Ω–∏–µ, 100% = –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
          </div>
        </div>

        <!-- Quality -->
        <div class="section">
          <div class="section-header">
            <h2><span class="icon icon-purple">üèÅ</span> –ö–∞—á–µ—Å—Ç–≤–æ <span class="help-tip">?<span
                  class="tip-text">–ö–ª—é—á–µ–≤—ã–µ
                  —Å–ª–æ–≤–∞ –∫–∞—á–µ—Å—Ç–≤–∞. Ultra (8K) ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è. High (4K) ‚Äî
                  –¥–ª—è
                  –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –∑–∞–¥–∞—á. Standard ‚Äî –±—ã—Å—Ç—Ä–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è.</span></span></h2>
            <span class="mode-badge">single</span>
          </div>
          <div class="option-group">
            <button class="option-btn" data-group="quality" data-value="8k, masterpiece, best quality, ultra detailed"
              title="">Ultra
              (8K)</button>
            <button class="option-btn" data-group="quality" data-value="4k, high quality, detailed" title="">High
              (4K)</button>
            <button class="option-btn" data-group="quality" data-value="high quality" title="">Standard</button>
          </div>
        </div>

        <!-- Negative -->
        <div class="section">
          <div class="section-header">
            <h2><span class="icon icon-red">üö´</span> –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–º–ø—Ç <span class="help-tip">?<span
                  class="tip-text">–ß—Ç–æ
                  –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏. –†–∞–±–æ—Ç–∞–µ—Ç –≤ SD (–æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ) –∏ MJ
                  (--no). DALL¬∑E
                  3 –∏ Flux –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –Ω–µ–≥–∞—Ç–∏–≤—ã.</span></span></h2>
          </div>
          <textarea class="input-field" id="negativePrompt" placeholder="–ß—Ç–æ –∏—Å–∫–ª—é—á–∏—Ç—å –∏–∑ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏..."
            oninput="handleInput()"></textarea>
          <div class="option-group" style="margin-top:8px;">
            <button class="option-btn" data-action="addNegative"
              data-value="blurry, low quality, artifacts, noise">–ê–Ω—Ç–∏-–±—Ä–∞–∫</button>
            <button class="option-btn" data-action="addNegative"
              data-value="cartoon, CGI, unrealistic">–ê–Ω—Ç–∏-CGI</button>
            <button class="option-btn" data-action="addNegative"
              data-value="airbrushed, plastic skin, overly smooth">–ê–Ω—Ç–∏-–ø–ª–∞—Å—Ç–∏–∫</button>
            <button class="option-btn" data-action="addNegative"
              data-value="extra fingers, deformed hands, bad anatomy, mutated">–ê–Ω—Ç–∏-–∞–Ω–∞—Ç–æ–º–∏—è</button>
            <button class="option-btn" data-action="addNegative"
              data-value="text, watermark, signature, logo">–ê–Ω—Ç–∏-—Ç–µ–∫—Å—Ç</button>
            <button class="option-btn" data-action="addNegative"
              data-value="cropped, out of frame, cut off">–ê–Ω—Ç–∏-–∫—Ä–æ–ø</button>
          </div>
        </div>

        <div id="conflictWarnings" class="warn-box" style="display: none;">‚ö†Ô∏è <b>–í–æ–∑–º–æ–∂–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã:</b><br>‚Ä¢ –ë—ã—Å—Ç—Ä—ã–π
          —Å—Ç–∏–ª–µ–≤–æ–π –ø—Ä–µ—Å–µ—Ç + –∞–≤—Ç–æ—Ä—Å–∫–∏–π —Å—Ç–∏–ª—å ‚Äî –∫–æ–Ω—Ñ–ª–∏–∫—Ç. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—Å—Ç–∞–≤–∏—Ç—å —á—Ç–æ-—Ç–æ –æ–¥–Ω–æ.<br>‚Ä¢ –°—Ç–∏–ª–µ–≤–æ–π –ø—Ä–µ—Å–µ—Ç —É–∂–µ
          –∑–∞–¥–∞—ë—Ç –∫–∞–º–µ—Ä—É/–æ–ø—Ç–∏–∫—É ‚Äî –≤–∞—à –≤—ã–±–æ—Ä –º–æ–∂–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å.<br>‚Ä¢ üîí –ú–∞–∫—Å. –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ –≤—Å–µ–≥–æ —Å
          –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º–∏ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω—ã–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏.</div>

      </div>

      <!-- RIGHT PANEL -->
      <div class="right-panel">

        <div class="stats-row">
          <div class="stat-card">
            <div class="stat-value" id="charCount">75</div>
            <div class="stat-label">–°–∏–º–≤–æ–ª–æ–≤</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="wordCount">11</div>
            <div class="stat-label">–°–ª–æ–≤</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="paramCount">4</div>
            <div class="stat-label">–ü–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</div>
          </div>
        </div>

        <!-- Active Tags -->
        <div class="section">
          <div class="section-header">
            <h2><span class="icon icon-purple">üè∑Ô∏è</span> –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h2>
          </div>
          <div class="tag-area" id="activeTags"><span class="tag-item"><span>colorPalette: <b>soft pastel palette,
                  delicate lavender and blush tones, dreamy muted colors</b></span><span class="remove">√ó</span></span>
          </div>
        </div>

        <!-- Prompt Output -->
        <div class="section" style="flex:1;display:flex;flex-direction:column;">
          <div class="section-header">
            <h2><span class="icon icon-green">üìã</span> –ü—Ä–æ–º–ø—Ç</h2>
            <div class="format-indicator"><span class="dot"></span> <span id="promptFormatLabel">Flat (–ü–ª–æ—Å–∫–∏–π)</span>
            </div>
          </div>

          <!-- Format selector -->
          <div class="format-tabs">
            <button class="format-tab active" data-format="flat" onclick="setPromptFormat(&#39;flat&#39;)">Flat
              (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)</button>
            <button class="format-tab" data-format="structured"
              onclick="setPromptFormat(&#39;structured&#39;)">Structured</button>
            <button class="format-tab" data-format="midjourney"
              onclick="setPromptFormat(&#39;midjourney&#39;)">Midjourney</button>
          </div>

          <div class="output-box" id="promptOutput">soft pastel palette, delicate lavender and blush tones, dreamy muted
            colors</div>

          <div class="action-row" style="margin-top:12px;">
            <button class="btn btn-accent" id="copyPromptBtn">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn btn-ghost" id="compactBtn" title="–°–≤–µ—Å—Ç–∏ –ø—Ä–æ–º–ø—Ç –∫ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –Ω—É–∂–Ω–æ–º—É —è–¥—Ä—É">‚ö°
              –ö–æ–º–ø–∞–∫—Ç</button>
            <button class="btn btn-green" id="saveBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button class="btn btn-red" id="resetBtn">üóëÔ∏è –°–±—Ä–æ—Å</button>
          </div>
        </div>

        <!-- JSON Output -->
        <div class="section">
          <div class="section-header">
            <h2><span class="icon icon-orange">üßæ</span> JSON</h2>
          </div>
          <div class="json-box" id="jsonOutput">{
            "schema": "vpe-prompt-builder-v2",
            "model": null,
            "subject": "",
            "prompt_flat": "soft pastel palette, delicate lavender and blush tones, dreamy muted colors",
            "technical": {
            "aspect_ratio": null,
            "resolution": null
            },
            "parameters": {
            "purpose": null,
            "format": null,
            "camera": {
            "body": null,
            "lens": null,
            "aperture": null,
            "angle": null,
            "composition": null
            },
            "lighting": {
            "type": {
            "primary": null,
            "accent": null
            },
            "time": {
            "primary": null,
            "accent": null
            },
            "effects": [],
            "palette": "soft pastel palette, delicate lavender and blush tones, dreamy muted colors"
            },
            "materials": {
            "skin": [],
            "hair": [],
            "objects": []
            },
            "text": null,
            "quality": null,
            "photo_style": null,
            "cinema_style": null,
            "director_style": null,
            "quick_style": null
            },
            "modes": {
            "generateFour": false,
            "grid3x3": false,
            "maxConsistency": false,
            "before_after": false,
            "seamless_pattern": false
            },
            "renderBoost": {
            "skin": false,
            "hair": false
            },
            "seed": null,
            "engine_params": null,
            "references": {
            "type": null,
            "weight": 50,
            "images": []
            },
            "negative": ""
            }</div>
          <div class="action-row" style="margin-top:8px;">
            <button class="btn btn-ghost" id="copyJsonBtn">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å JSON</button>
          </div>
        </div>



      </div>



      <script>
        // =============================================
        // CONFIG
        // =============================================
        const groupConfig = {
          aiModel: { mode: "single" },
          cameraBody: { mode: "single" },
          aspectRatio: { mode: "single" },
          resolution: { mode: "single" },
          purpose: { mode: "single" },
          format: { mode: "single" },
          lens: { mode: "single" },
          aperture: { mode: "single" },
          angle: { mode: "single" },
          composition: { mode: "single" },
          quality: { mode: "single" },
          mjVersion: { mode: "single" },
          mjStyle: { mode: "single" },
          fluxModel: { mode: "single" },
          dalleStyle: { mode: "single" },
          dalleQuality: { mode: "single" },
          referenceType: { mode: "single" },
          photoStyle: { mode: "single" },
          cinemaStyle: { mode: "single" },
          directorStyle: { mode: "single" },
          colorPalette: { mode: "single" },
          lightType: { mode: "primaryAccent" },
          timeOfDay: { mode: "primaryAccent" },
          lightFX: { mode: "multi" },
          skinDetail: { mode: "multi" },
          hairDetail: { mode: "multi" },
          material: { mode: "multi" },
          typography: { mode: "multi" },
          quickStyle: { mode: "single" }
        };

        const resolutionMap = {
          '1:1': [{ value: '1024x1024', label: '1K (1024√ó1024)' }, { value: '2048x2048', label: '2K (2048√ó2048)' }, { value: '4096x4096', label: '4K (4096√ó4096)' }],
          '16:9': [{ value: '1920x1080', label: 'Full HD (1920√ó1080)' }, { value: '2560x1440', label: '2K (2560√ó1440)' }, { value: '3840x2160', label: '4K UHD (3840√ó2160)' }, { value: '7680x4320', label: '8K (7680√ó4320)' }],
          '9:16': [{ value: '1080x1920', label: 'Full HD (1080√ó1920)' }, { value: '1440x2560', label: '2K (1440√ó2560)' }, { value: '2160x3840', label: '4K UHD (2160√ó3840)' }],
          '4:3': [{ value: '1024x768', label: 'XGA (1024√ó768)' }, { value: '2048x1536', label: '2K (2048√ó1536)' }, { value: '4096x3072', label: '4K (4096√ó3072)' }],
          '3:4': [{ value: '768x1024', label: '–ü–æ—Ä—Ç—Ä–µ—Ç (768√ó1024)' }, { value: '1536x2048', label: '2K (1536√ó2048)' }, { value: '3072x4096', label: '4K (3072√ó4096)' }],
          '21:9': [{ value: '2560x1080', label: 'UltraWide (2560√ó1080)' }, { value: '3440x1440', label: 'UWQHD (3440√ó1440)' }, { value: '5120x2160', label: '5K UW (5120√ó2160)' }],
          '2:3': [{ value: '1366x2048', label: '2K (1366√ó2048)' }, { value: '2732x4096', label: '4K (2732√ó4096)' }],
          '3:2': [{ value: '2048x1366', label: '2K (2048√ó1366)' }, { value: '4096x2732', label: '4K (4096√ó2732)' }]
        };

        // Model-specific tips
        const modelTips = {
          'midjourney': 'MJ: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ --ar, --v, --s, --cref –≤ –∫–æ–Ω—Ü–µ –ø—Ä–æ–º–ø—Ç–∞. –§–æ—Ä–º–∞—Ç ¬´Midjourney¬ª —Å—Ç—Ä–æ–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å.',
          'dall-e-3': 'DALL¬∑E 3: –ø–∏—à–∏—Ç–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º —è–∑—ã–∫–æ–º, –∫–∞–∫ –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã. –ù–µ–≥–∞—Ç–∏–≤—ã –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è.',
          'stable-diffusion': 'SD: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ–≥–∞—Ç–∏–≤—ã, –≤–µ—Å–∞ —Ç–æ–∫–µ–Ω–æ–≤ (word:1.3), LoRA. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç Flat.',
          'flux': 'Flux: –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫, –∫–∞–∫ DALL¬∑E. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç --ar.',
          'ideogram': 'Ideogram: –æ—Ç–ª–∏—á–Ω–æ —Ä–µ–Ω–¥–µ—Ä–∏—Ç —Ç–µ–∫—Å—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫.',
          'gemini-imagen': 'Gemini Imagen: –æ–ø–∏—à–∏—Ç–µ —Å—Ü–µ–Ω—É + –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å—ã –≤ —á–∞—Ç.',
          'chatgpt-image': 'ChatGPT Image (GPT-Image-1 / gpt-4o): –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ –¥–∏–∞–ª–æ–≥. –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä —Ç–µ–∫—Å—Ç–∞.',
          'nano-banana-pro': 'Nano Banana Pro: –±—ã—Å—Ç—Ä–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–º–ø—Ç—ã –≤ —Å—Ç–∏–ª–µ Stable Diffusion. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏.'
        };

        // Presets
        const presets = [
          {
            name: "üé¨ –ö–∏–Ω–æ–ø–æ—Ä—Ç—Ä–µ—Ç",
            values: {
              aiModel: "stable-diffusion", cameraBody: "shot on Sony A7R V", aspectRatio: "3:4", purpose: "Cinematic Still", format: "photorealistic",
              lens: "Sony FE 85mm f/1.4 GM", aperture: "f/1.8, portrait bokeh", angle: "eye level", composition: "close-up portrait, head and shoulders",
              quality: "4k, high quality, detailed",
              lightType: { primary: "dramatic chiaroscuro", accent: "backlighting silhouette" },
              timeOfDay: { primary: "golden hour warm sunlight", accent: "" },
              lightFX: ["rim light"], skinDetail: ["visible skin pores, natural grain", "natural freckles and imperfections"],
              material: [], typography: []
            }
          },
          {
            name: "üì¶ –ü—Ä–µ–¥–º–µ—Ç–Ω–∞—è —Å—ä—ë–º–∫–∞",
            values: {
              aiModel: "stable-diffusion", cameraBody: "shot on Hasselblad X2D 100C", aspectRatio: "1:1", purpose: "Product Photography", format: "photorealistic",
              lens: "Canon RF 100mm f/2.8L Macro IS USM", aperture: "f/8, deep focus", angle: "eye level", composition: "overhead flat lay, knolling arrangement",
              quality: "8k, masterpiece, best quality, ultra detailed",
              lightType: { primary: "studio three-point lighting", accent: "softbox beauty light" },
              timeOfDay: { primary: "bright midday sun", accent: "" },
              lightFX: [], skinDetail: [],
              material: ["matte finish", "polished chrome"], typography: []
            }
          },
          {
            name: "üåÉ –ù–µ–æ–Ω–æ–≤—ã–π –∫–∏–±–µ—Ä–ø–∞–Ω–∫",
            values: {
              aiModel: "midjourney", cameraBody: "shot on RED V-Raptor", aspectRatio: "21:9", purpose: "Cinematic Still", format: "photorealistic",
              lens: "ARRI Signature Prime 35mm T1.8", aperture: "f/2.8, balanced depth of field", angle: "low angle shot", composition: "wide shot, subject in environment",
              quality: "4k, high quality, detailed",
              lightType: { primary: "neon glow lighting", accent: "dramatic chiaroscuro" },
              timeOfDay: { primary: "night, artificial lighting", accent: "blue hour twilight" },
              lightFX: ["god rays", "lens flare", "volumetric fog"], skinDetail: [],
              material: ["wet asphalt reflections"], typography: []
            }
          },
          {
            name: "üé® –ö–æ–Ω—Ü–µ–ø—Ç-–∞—Ä—Ç",
            values: {
              aiModel: "stable-diffusion", cameraBody: "", aspectRatio: "16:9", purpose: "Concept Art", format: "oil painting",
              lens: "", aperture: "f/2.8, balanced depth of field", angle: "eye level", composition: "extreme wide shot, vast landscape",
              quality: "4k, high quality, detailed",
              lightType: { primary: "soft natural light", accent: "" },
              timeOfDay: { primary: "golden hour warm sunlight", accent: "" },
              lightFX: ["volumetric fog", "god rays"], skinDetail: [],
              material: [], typography: []
            }
          },
          {
            name: "üíº –ö–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è —Å—ä—ë–º–∫–∞",
            values: {
              aiModel: "stable-diffusion", cameraBody: "shot on Phase One IQ4 150MP", aspectRatio: "4:3", purpose: "Product Photography", format: "photorealistic",
              lens: "Canon RF 50mm f/1.2L USM", aperture: "f/5.6, moderate depth of field", angle: "slightly high angle", composition: "medium shot, waist up",
              quality: "8k, masterpiece, best quality, ultra detailed",
              lightType: { primary: "studio three-point lighting", accent: "softbox beauty light" },
              timeOfDay: { primary: "bright midday sun", accent: "" },
              lightFX: ["subsurface scattering"], skinDetail: ["visible skin pores, natural grain"],
              material: ["matte finish"], typography: []
            }
          },
          {
            name: "üì∫ –†–µ–∫–ª–∞–º–Ω—ã–π —Ä–æ–ª–∏–∫",
            values: {
              aiModel: "midjourney", cameraBody: "shot on ARRI ALEXA 35", aspectRatio: "16:9", purpose: "Cinematic Still", format: "photorealistic",
              lens: "Cooke S7/i 50mm T2.0 Full Frame Plus", aperture: "f/2.8, balanced depth of field", angle: "slightly low angle, hero shot", composition: "medium close-up, chest up",
              quality: "4k, high quality, detailed",
              lightType: { primary: "studio three-point lighting", accent: "backlighting silhouette" },
              timeOfDay: { primary: "bright midday sun", accent: "golden hour warm sunlight" },
              lightFX: ["rim light", "lens flare"], skinDetail: ["visible skin pores, natural grain", "peach fuzz, vellus hair"],
              material: ["polished chrome"], typography: ["bold sans-serif typography"]
            }
          },
          {
            name: "üî¨ –ú–∞–∫—Ä–æ —Ä–µ–∫–ª–∞–º–∞",
            values: {
              aiModel: "stable-diffusion", cameraBody: "shot on Canon EOS R5", aspectRatio: "1:1", purpose: "Product Photography", format: "photorealistic",
              lens: "Canon RF 100mm f/2.8L Macro IS USM", aperture: "f/2.8, balanced depth of field", angle: "eye level", composition: "extreme close-up, face detail",
              quality: "8k, masterpiece, best quality, ultra detailed",
              lightType: { primary: "softbox beauty light", accent: "studio three-point lighting" },
              timeOfDay: { primary: "bright midday sun", accent: "" },
              lightFX: ["subsurface scattering", "caustics"], skinDetail: [],
              material: ["frosted glass, translucent diffused", "polished chrome"], typography: []
            }
          }
          ,
          { name: "üì∑ –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–æ—Ä—Ç—Ä–µ—Ç", values: { aiModel: "flux", cameraBody: "shot on Sony A7R V", aspectRatio: "3:4", purpose: "Photography", format: "photorealistic", lens: "Sony FE 85mm f/1.4 GM", aperture: "f/1.4, shallow depth of field, creamy bokeh", angle: "eye level", composition: "close-up portrait, head and shoulders", quality: "8k, masterpiece, best quality, ultra detailed", lightType: { primary: "soft natural light", accent: "" }, timeOfDay: { primary: "golden hour warm sunlight", accent: "" }, lightFX: ["rim light"], skinDetail: ["visible skin pores, natural grain", "peach fuzz, vellus hair"], hairDetail: ["ultra detailed individual hair strands, each strand visible, photorealistic hair", "flyaway baby hairs, wispy strands, backlit hair glow"], material: [], typography: [], photoStyle: "in the style of Annie Leibovitz, dramatic portrait lighting, rich colors", cinemaStyle: "", directorStyle: "" } },
          { name: "üèôÔ∏è –£–ª–∏—á–Ω—ã–π —Ñ–æ—Ç–æ—Ä–µ–∞–ª–∏–∑–º", values: { aiModel: "stable-diffusion", cameraBody: "shot on Leica M11", aspectRatio: "3:2", purpose: "Photography", format: "photorealistic", lens: "Leica Summilux-M 50mm f/1.4 ASPH", aperture: "f/2.8, balanced depth of field", angle: "eye level", composition: "medium shot, waist up", quality: "4k, high quality, detailed", lightType: { primary: "soft natural light", accent: "backlighting silhouette" }, timeOfDay: { primary: "overcast diffused light", accent: "" }, lightFX: ["volumetric fog"], skinDetail: ["visible skin pores, natural grain"], hairDetail: [], material: ["wet asphalt reflections", "rough concrete"], typography: [], photoStyle: "in the style of Steve McCurry, vivid saturated colors, documentary", cinemaStyle: "", directorStyle: "" } },
          { name: "üíé Beauty / –ö–æ—Å–º–µ—Ç–∏–∫–∞", values: { aiModel: "stable-diffusion", cameraBody: "shot on Hasselblad X2D 100C", aspectRatio: "3:4", purpose: "Advertising campaign", format: "photorealistic", lens: "Canon RF 85mm f/1.2L USM", aperture: "f/1.8, portrait bokeh", angle: "slightly high angle", composition: "extreme close-up, face detail", quality: "8k, masterpiece, best quality, ultra detailed", lightType: { primary: "clamshell lighting, beauty commercial", accent: "softbox beauty light" }, timeOfDay: { primary: "bright midday sun", accent: "" }, lightFX: ["subsurface scattering", "rim light"], skinDetail: ["visible skin pores, natural grain", "peach fuzz, vellus hair", "subtle under-eye texture"], hairDetail: ["ultra detailed individual hair strands, each strand visible, photorealistic hair", "detailed hair highlights, light catching individual strands, hair shine"], material: ["polished chrome"], typography: [], photoStyle: "in the style of Mario Testino, warm golden tones, glossy fashion", cinemaStyle: "", directorStyle: "" } },

        ];

        // =============================================
        // QUICK STYLE PRESETS
        // =============================================
        const QUICK_STYLES = {
          "true-detective": "True Detective HBO noir cinematography aesthetic. LIGHTING: harsh Louisiana sun creating extreme contrast, or dim atmospheric interior lighting with practical sources (desk lamps, neon signs), oppressive heat haze visual quality, golden hour magic light with long shadows, smoky atmospheric diffusion. COLOR GRADING: heavily desaturated with sickly greens and murky browns, swampy atmospheric color palette, crushed blacks and blown highlights for noir effect, melancholic despondent mood, teal shadows with amber highlights, low saturation high contrast. TECHNICAL: extreme shallow depth of field (f/1.4 feel), anamorphic lens flares and aberrations, 35mm film grain texture, wide desolate landscape compositions alternating with claustrophobic close-ups, natural vignetting. ATMOSPHERE: oppressive humidity, existential dread, Southern Gothic decay, time and mortality themes. QUALITY: photorealistic, 8K resolution, Cary Fukunaga directorial style, award-winning cinematography, prestige crime drama aesthetic.",

          "game-of-thrones": "Game of Thrones HBO epic fantasy cinematography. LIGHTING: dramatic natural lighting with overcast skies, torch-lit and candlelit interiors with warm flickering practical lights, cold Northern daylight with diffused sun, dramatic fire and shadow interplay, motivated medieval lighting sources only. COLOR GRADING: desaturated medieval color palette with muted earth tones, cold blue-grey exteriors, warm amber interiors, gritty realistic texture, low saturation to convey harsh realism, teal and orange separation for dramatic scenes. TECHNICAL: sweeping wide establishing shots of landscapes and castles, intimate medium close-ups for dialogue, shallow to medium depth of field (f/2.8-f/5.6), IMAX camera quality for battle sequences, natural film grain, handheld camera for battle chaos. ATMOSPHERE: medieval fantasy realism, political intrigue gravitas, epic scale with intimate character moments, harsh unforgiving world, winter is coming mood. QUALITY: photorealistic, 8K resolution, prestige fantasy television, award-winning cinematography, theatrical production value, gritty realistic medieval aesthetic.",

          "the-last-of-us": "The Last of Us HBO post-apocalyptic cinematography aesthetic. LIGHTING: soft diffused overcast natural light, nature reclaiming urban environments with dappled sunlight through overgrown vegetation, golden hour warmth for emotional moments, cold blue-grey for tension and danger, practical flashlight and lantern sources in dark interiors, atmospheric dust particles in light beams. COLOR GRADING: desaturated with selective warm color pops (rust, autumn leaves, golden light), muted greens of overgrown nature, cold concrete greys, earthy browns and ochres, melancholic yet beautiful color palette, teal shadows with amber highlights in key scenes. TECHNICAL: intimate character-focused cinematography, shallow depth of field for emotional beats (f/2-f/2.8), medium depth for environmental storytelling (f/5.6), natural handheld camera movement, subtle film grain texture, wide shots emphasizing isolation and scale of abandoned cities. ATMOSPHERE: post-pandemic desolation, nature reclaiming civilization, hope amid despair, survival drama, emotional father-daughter relationship undertones, quiet apocalypse beauty, melancholic yet hopeful. QUALITY: photorealistic, 8K resolution, prestige video game adaptation, award-winning cinematography, theatrical production quality, naturalistic performances.",

          "stranger-things": "Stranger Things Netflix 1980s nostalgia cinematography aesthetic. LIGHTING: practical 1980s sources (neon signs, flashlights, Christmas lights, arcade machines), moody atmospheric fog with colored gel lighting, dramatic red and blue police light flashes, warm suburban home interiors with table lamps, eerie Upside Down scenes with cold flickering lights, golden hour suburban Americana. COLOR GRADING: vibrant saturated 1980s color palette with heavy red and teal contrast, neon pink and electric blue accents, warm amber suburban scenes, cold desaturated Upside Down sequences, nostalgic film stock emulation, Spielberg-inspired warm family moments contrasting with horror elements. TECHNICAL: anamorphic lens flares and aberrations, shallow depth of field for character focus (f/2-f/2.8), Steadicam smooth tracking shots, wide establishing shots of suburban Indiana, intimate close-ups during emotional beats, subtle film grain texture, practical special effects aesthetic. ATMOSPHERE: 1980s nostalgia, supernatural mystery, coming-of-age adventure, Spielberg meets Stephen King, suburban horror, friendship and loyalty themes, synth-wave retro vibes. QUALITY: photorealistic, 8K resolution, Netflix prestige series, Duffer Brothers visual style, award-winning cinematography, theatrical production value, 1980s period accuracy.",

          "the-crown": "The Crown Netflix prestige royal drama cinematography aesthetic. LIGHTING: soft diffused natural window light in palace interiors, elegant chandelier and sconce lighting, overcast British daylight, sophisticated three-point studio lighting for formal portraits, natural outdoor light for countryside estates, subtle rim lighting for royal gravitas. COLOR GRADING: rich saturated jewel tones (deep reds, royal blues, emerald greens), warm golden interiors with mahogany and brass, muted British countryside greens and greys, sophisticated color palette, period-accurate color reproduction, elegant restrained grading. TECHNICAL: static composed camera work emphasizing formality and tradition, slow deliberate camera movements, symmetrical framing for power and authority, medium depth of field (f/4-f/5.6), 35mm and 50mm lens aesthetic, classical composition following rule of thirds and golden ratio, pristine clean image quality. ATMOSPHERE: British royal elegance, political intrigue, duty versus desire, historical gravitas, restrained emotion, palace formality, period drama sophistication, understated luxury. QUALITY: photorealistic, 8K resolution, Netflix prestige historical drama, award-winning cinematography, theatrical production quality, meticulous period detail, BBC drama aesthetic elevated.",

          "wednesday": "Wednesday Netflix gothic dark academia cinematography aesthetic. LIGHTING: moody overcast natural light, gothic architecture with dramatic shadows, candlelit and lantern-lit interiors, moonlight through stained glass windows, cold blue-grey daylight, dramatic chiaroscuro contrast, Tim Burton-inspired expressionistic lighting, fog and mist atmospheric effects. COLOR GRADING: heavily desaturated with deep blacks and cool greys, selective color pops (blood red, poison purple, toxic green), monochromatic gothic palette, cold blue undertones, high contrast with crushed blacks, Burton-esque dark whimsy color treatment. TECHNICAL: Dutch angles and off-kilter framing for unease, symmetrical centered compositions for gothic formality, wide shots emphasizing gothic architecture, intimate close-ups with deadpan expressions, shallow to medium depth of field (f/2.8-f/4), Tim Burton visual language, stylized yet grounded aesthetic. ATMOSPHERE: gothic dark comedy, macabre humor, teenage outsider angst, supernatural mystery, Addams Family legacy, dark academia aesthetic, deadpan wit, Burton-meets-teen-drama. QUALITY: photorealistic with stylized gothic elements, 8K resolution, Netflix prestige teen series, Tim Burton directorial style, award-winning production design, theatrical gothic aesthetic, darkly whimsical.",

          "blade-runner-2049": "Blade Runner 2049 neo-noir cyberpunk cinematography, Roger Deakins masterwork. LIGHTING: dramatic volumetric fog with laser light beams, monumental scale lighting, orange sodium vapor dystopian exteriors, cool blue-grey rain-soaked scenes, warm amber interior glow, god rays through industrial haze, practical neon signs and holographic advertisements. COLOR GRADING: bold saturated orange and teal separation, monochromatic sequences (orange desert, purple Vegas), deep blacks with vibrant color accents, cyberpunk neon palette, desaturated with selective color pops, cinematic color contrast pushed to maximum. TECHNICAL: ultra-wide establishing shots emphasizing scale and isolation, symmetrical centered compositions, extreme shallow depth of field (f/1.4), anamorphic lens flares, slow deliberate camera movements, IMAX quality, pristine sharp image. ATMOSPHERE: dystopian future noir, existential loneliness, monumental architecture, technological decay, philosophical sci-fi, visual poetry. QUALITY: photorealistic, 8K IMAX resolution, Academy Award-winning cinematography, Roger Deakins visual mastery.",

          "grand-budapest-hotel": "The Grand Budapest Hotel Wes Anderson symmetrical whimsical cinematography. LIGHTING: soft even studio lighting, pastel-friendly neutral temperature, theatrical stage lighting aesthetic, natural window light in symmetrical compositions, warm interior hotel lighting, bright clean exterior daylight. COLOR GRADING: vibrant pastel color palette (pink, purple, mint green, coral, baby blue), highly saturated candy colors, meticulously color-coordinated production design, distinct color schemes for different time periods, storybook aesthetic. TECHNICAL: perfectly centered symmetrical compositions, flat frontal camera angles, whip pans and snap zooms, miniature model shots, stop-motion animation sequences, planimetric framing, dollhouse aesthetic. ATMOSPHERE: whimsical European nostalgia, theatrical storybook charm, meticulous detail, quirky sophistication, fairy tale elegance. QUALITY: photorealistic with stylized production design, 8K resolution, Academy Award-winning production design, Wes Anderson signature visual style.",

          "in-the-mood-for-love": "In the Mood for Love Wong Kar-wai romantic melancholy cinematography, Christopher Doyle color mastery. LIGHTING: warm tungsten practical lighting, neon signs through rain-soaked windows, moody low-key lighting, colored gels (red, amber, teal), intimate close-up lighting, shadows and silhouettes, Hong Kong night ambiance. COLOR GRADING: rich saturated reds and warm ambers, teal and orange romantic contrast, lush vibrant colors, nostalgic 1960s Hong Kong palette, deep shadows with glowing highlights, sensual color temperature. TECHNICAL: slow motion romantic sequences, tight intimate framing through doorways and windows, voyeuristic camera placement, shallow depth of field (f/1.4-f/2), handheld intimate camera work, vertical compositions, step-printing slow motion. ATMOSPHERE: forbidden romance, unspoken longing, 1960s Hong Kong nostalgia, sensual restraint, melancholic beauty, time and memory. QUALITY: photorealistic, 8K restoration quality, Cannes Film Festival award-winning cinematography, Wong Kar-wai poetic visual language.",

          "mad-max-fury-road": "Mad Max Fury Road post-apocalyptic action cinematography, John Seale visual intensity. LIGHTING: harsh Australian desert sun, extreme contrast daylight, practical fire and explosion lighting, dust storm diffusion, golden hour chase sequences, moonlight night scenes with cool blue tones, flare gun and flame lighting. COLOR GRADING: teal and orange pushed to extreme, desaturated desert with vibrant sky blues, warm sand tones contrasting cool shadows, day-for-night blue sequences, high contrast high saturation, comic book color intensity. TECHNICAL: high-speed action photography, wide-angle dynamic compositions, practical stunts and effects, minimal CGI aesthetic, fast cutting with clear spatial geography, multiple camera angles for action, IMAX sequences. ATMOSPHERE: post-apocalyptic survival, kinetic energy, practical action spectacle, wasteland beauty, relentless momentum, visual storytelling without dialogue. QUALITY: photorealistic practical effects, 8K resolution, Academy Award-winning cinematography and editing, visceral action cinema.",

          "the-revenant": "The Revenant natural light wilderness cinematography, Emmanuel Lubezki three-time Oscar winner. LIGHTING: exclusively natural available light, golden hour magic hour sequences, overcast diffused daylight, campfire and torch practical lighting, harsh midday sun through forest canopy, blue hour twilight, moonlight night scenes, no artificial lighting. COLOR GRADING: desaturated natural earth tones, cold blue-grey winter palette, warm firelight contrast, muted greens and browns, realistic color reproduction, subtle grading preserving natural light quality. TECHNICAL: long continuous takes with invisible cuts, immersive Steadicam and handheld work, wide-angle lenses capturing environment, shallow depth of field for intimacy (f/2-f/2.8), natural lens flares, IMAX sequences. ATMOSPHERE: brutal survival, man versus nature, 1820s American frontier, visceral realism, spiritual journey, elemental forces. QUALITY: photorealistic, 8K resolution, Academy Award-winning cinematography, natural light mastery, immersive realism.",

          "hero": "Hero Zhang Yimou color-coded wuxia cinematography, Christopher Doyle visual poetry. LIGHTING: soft diffused natural light, dramatic backlight for martial arts silhouettes, colored gel lighting matching story segments, golden hour desert sequences, overcast grey skies, lantern and candle interiors, rain and water reflections. COLOR GRADING: bold monochromatic color schemes per story version (red, blue, green, white, black), highly saturated single-color dominance, color as narrative device, vibrant silk costumes against matching environments, painterly color composition. TECHNICAL: sweeping crane shots over landscapes, slow-motion martial arts choreography, wire-work enhanced movements, symmetrical compositions, wide establishing shots, balletic camera movements. ATMOSPHERE: Chinese wuxia poetry, color as storytelling, martial arts ballet, philosophical conflict, visual opera, ancient China grandeur. QUALITY: photorealistic with stylized color, 8K resolution, visually groundbreaking cinematography, painterly aesthetic.",

          "la-la-land": "La La Land modern Hollywood musical cinematography, Linus Sandgren Technicolor homage. LIGHTING: golden hour Los Angeles magic light, vibrant sunset colors, theatrical stage lighting for musical numbers, romantic twilight blue hour, warm practical streetlights, studio musical lighting aesthetic, colorful gel lighting. COLOR GRADING: vibrant saturated primary colors (red, blue, yellow, purple), Technicolor-inspired bold palette, romantic warm tones, dreamy pastel sequences, high saturation celebrating classic musicals, teal and magenta Los Angeles nights. TECHNICAL: sweeping Steadicam musical choreography, long continuous takes for dance numbers, crane and dolly moves, classical Hollywood camera language, planetarium sequence with starry visuals. ATMOSPHERE: romantic Los Angeles dreams, jazz and ambition, classic Hollywood musical revival, bittersweet romance, city of stars magic, nostalgic optimism. QUALITY: photorealistic, 8K resolution, Academy Award-winning cinematography, modern musical masterpiece.",

          "the-fall": "The Fall Tarsem Singh surreal visual maximalism cinematography, Colin Watkinson painterly compositions. LIGHTING: dramatic natural light in exotic locations, golden hour magic across 28 countries, theatrical color gel lighting, stained glass window light, desert sun and palace interiors, fantasy dreamscape lighting. COLOR GRADING: ultra-saturated jewel tones, vibrant reds blues golds, painterly color composition, surreal color combinations, Baroque painting aesthetic, maximum color intensity, fantasy storybook palette. TECHNICAL: symmetrical centered compositions, wide establishing shots of breathtaking locations, slow deliberate camera movements, shallow depth of field isolating subjects, practical locations worldwide, minimal CGI. ATMOSPHERE: fever dream fantasy, storybook surrealism, visual poetry, imagination versus reality, baroque maximalism, fairy tale darkness. QUALITY: photorealistic with surreal production design, 8K resolution, most visually ambitious independent film, painterly cinematography.",

          "1917": "1917 one-shot WWI cinematography, Roger Deakins immersive realism. LIGHTING: overcast grey WWI daylight, muddy trench natural light, dramatic flare-lit night town sequence (orange fire glow), golden hour no-man's-land, practical explosion and fire lighting, moonlight and starlight night scenes. COLOR GRADING: desaturated war-torn palette, muddy browns and greys, cold blue overcast skies, dramatic orange firelight sequence contrasting cool night, muted greens of French countryside, realistic period color. TECHNICAL: seamless invisible cuts creating one continuous shot illusion, immersive Steadicam and handheld work, choreographed camera movements with actors, real-time storytelling, practical effects emphasis. ATMOSPHERE: WWI trench warfare immediacy, real-time tension, immersive you-are-there realism, relentless forward momentum, visceral war experience. QUALITY: photorealistic, 8K resolution, Academy Award-winning cinematography, technical filmmaking mastery, immersive realism.",

          "amelie": "Am√©lie Jean-Pierre Jeunet whimsical Parisian cinematography, Bruno Delbonnel painterly warmth. LIGHTING: warm golden Parisian light, cozy interior caf√© and apartment lighting, soft diffused natural window light, warm tungsten practical sources, romantic evening streetlights, nostalgic warm glow throughout. COLOR GRADING: vibrant warm palette dominated by reds yellows greens, desaturated blues creating teal-orange separation, painterly color grading, nostalgic postcard Paris aesthetic, high saturation in warm tones, storybook color treatment. TECHNICAL: whimsical camera movements and snap zooms, centered symmetrical compositions, shallow depth of field (f/2), creative transitions and visual effects, playful camera angles, miniature tilt-shift sequences. ATMOSPHERE: whimsical Parisian romance, magical realism, quirky charm, nostalgic warmth, fairy tale Paris, innocent wonder, visual poetry. QUALITY: photorealistic with stylized color, 8K resolution, C√©sar Award-winning cinematography, iconic French cinema aesthetic.",

          "shinkai-vibes": "Makoto Shinkai anime aesthetic. LIGHTING: brilliant lens flares, god rays piercing through clouds, hyper-realistic lighting, golden hour magic, bioluminescent night scenes, star-filled skies, vibrant city lights. COLOR GRADING: hyper-vibrant saturated colors, azure blue skies, emerald greens, impossible sunsets with purple and pink gradients, high contrast but airy feel. TECHNICAL: wide angle establishing shots of cityscapes and nature, extreme attention to detail in background art, photorealistic clouds and water, crisp sharp lines, digital animation perfection. ATMOSPHERE: emotional longing, separation, bittersweet romance, urban fantasy, everyday magic, breathtaking beauty. QUALITY: 8K anime wallpaper, Comix Wave Films production quality, masterpiece animation.",

          "90s-anime": "Retro 90s cel animation aesthetic. LIGHTING: flat cel shading, hard shadows, dramatic rim lighting, limited lighting complexity typical of hand-drawn era. COLOR GRADING: slightly muted or pastel palette, specific 90s broadcast colors, film grain simulation, VHS noise or slight chromatic aberration, analog warmth. TECHNICAL: hand-drawn line art look, traditional ink and paint style, limited frame rate feel (on threes), static backgrounds with moving characters. ATMOSPHERE: nostalgic, classic anime, cyberpunk or mecha vibes, magical girl transformations, lo-fi aesthetic. QUALITY: high quality scan of vintage cel, DVD box set art, Cowboy Bebop or Evangelion visual style.",

          "dark-fantasy-anime": "Dark Epic Fantasy anime aesthetic (Berserk/Elden Ring style). LIGHTING: dramatic chiaroscuro, heavy shadows, torchlight and firelight, cold moonlight, ominous atmospheric fog, rim lighting on armor. COLOR GRADING: desaturated gritty palette, blacks, greys, blood reds, cold blues, muted earth tones, high contrast. TECHNICAL: detailed line work, cross-hatching textures, heavy ink lines, dynamic action composition, extreme angles. ATMOSPHERE: dread, epic struggle, cosmic horror, medieval grit, violence and beauty, supernatural power. QUALITY: 8K resolution, MAPPA or Ufotable high budget production, theatrical feature quality.",

          "ghibli-style": "Studio Ghibli Hayao Miyazaki hand-painted aesthetic. LIGHTING: soft natural sun-drenched lighting, dappled forest light, puffy cumulus cloud shadows, warm inviting interior lamplight. COLOR GRADING: naturalistic watercolor palette, lush greens, azure skies, earthy browns, vibrant but natural colors, gouache painted backgrounds. TECHNICAL: hand-painted background art style, soft character outlines, fluid motion emphasis (flying sequences), attention to nature details (grass blowing, water flowing). ATMOSPHERE: childhood wonder, nature worship, pacifism, magical realism, nostalgia, cozy comfort, environmental beauty. QUALITY: 8K resolution, theatrical animation masterpiece, hand-drawn production value."
        };

        // =============================================
        // STATE
        // =============================================
        const state = {
          aiModel: "", cameraBody: "", aspectRatio: "", resolution: "", purpose: "", format: "", photoStyle: "", cinemaStyle: "", directorStyle: "", filmStock: "",
          lens: "", aperture: "", angle: "", composition: "", quality: "",
          lightType: { primary: "", accent: "" },
          timeOfDay: { primary: "", accent: "" },
          lightFX: [], colorPalette: "", skinDetail: [], hairDetail: [], material: [], typography: [],
          referenceType: "", referenceWeight: 50,
          mainSubject: "", textContent: "", negativePrompt: "",
          quickStyle: "",
          generateFourMode: false, grid3x3Mode: false, maxConsistency: false, beforeAfter: false, seamlessPattern: false, seed: "",
          // Engine-specific generation params
          mjVersion: "7", mjStyle: "", mjStylize: 250, mjChaos: 0, mjWeird: 0,
          sdCfg: 7, sdSteps: 25,
          fluxModel: "dev", fluxGuidance: 3.5, fluxSteps: 28,
          dalleStyle: "vivid", dalleQuality: "hd",
          skinRenderBoost: false, hairRenderBoost: false,
          referenceImages: [],
          promptFormat: "flat"  // flat | structured | midjourney
        };

        const GENERATE_FOUR_PREFIX = `{
  "task": "GENERATE_SCENE_VARIATIONS",
  "instruction": "STRICT REQUIREMENT: Generate 4 SEPARATE, INDIVIDUAL image files. Do NOT create a single image containing a grid or collage. You must execute the image generation tool 4 separate times, once for each prompt below, and present 4 distinct outputs.",
  "reference_instruction": "Use the primary render ONLY for overall scene and style consistency. The subject's face, facial structure, proportions, and overall appearance MUST be taken exclusively from the uploaded reference photo and have absolute priority over any generated render.",
  "base_prompt": "",
  "base_prompt_note": "No primary prompt available.",
  "global_settings": {
    "aspect_ratio": "21:9",
    "image_size": "2K",
    "model": "gemini-3-pro-image-preview"
  },
  "variations": [
    {
      "id": 1,
      "shot_type": "Low angle shot of the scene facing the right side of the camera:",
      "prompt": "A photorealistic image of a low angle shot of the scene facing the right side of the camera: of a subject. The scene is illuminated by harsh midday sun lighting. Captured with a Sony FX6. Applied effect(s): Desaturated Grunge. No blurred faces. The image should be in a 21:9 format. Reframe the shot. Maintain the character and scene details from the reference, but change the camera viewpoint. With new details about the environment."
    },
    {
      "id": 2,
      "shot_type": "Cowboy-shot",
      "prompt": "A photorealistic image of a cowboy-shot of a subject. The scene is illuminated by harsh midday sun lighting. Captured with a Sony FX6, 200mm Super Telephoto Lens. Applied effect(s): Desaturated Grunge. No blurred faces. The image should be in a 21:9 format. Reframe the shot. Maintain the character and scene details from the reference, but change the camera viewpoint. With new details about the environment."
    },
    {
      "id": 3,
      "shot_type": "Dutch angle",
      "prompt": "A photorealistic image of a dutch angle of a subject. What would the Subject do next? Show us the results of that action. The scene is illuminated by harsh midday sun lighting. Captured with a Sony FX6. Applied effect(s): Desaturated Grunge. No blurred faces. The image should be in a 21:9 format. Reframe the shot. Maintain the character and scene details from the reference, but change the camera viewpoint. With new details about the environment."
    },
    {
      "id": 4,
      "shot_type": "Three quarter body shot of the scene facing the left side of the camera:",
      "prompt": "A photorealistic image of a three quarter body shot of the scene facing the left side of the camera: of a subject. The scene is illuminated by harsh midday sun lighting. Captured with a Sony FX6, 24mm Wide angle Lens. Applied effect(s): Desaturated Grunge. No blurred faces. The image should be in a 21:9 format. Reframe the shot. Maintain the character and scene details from the reference, but change the camera viewpoint. With new details about the environment."
    }
  ]
}
`;

        const GRID_3X3_PREFIX = `3x3 Cinematic Contact Sheet, 3:4 AR. Full-bleed, no margins, thin dark dividers. Frozen scene logic: static subject/env consistency with dynamic cinematic lighting/DOF. Arri Alexa 35, 35mm, f/2.8, 8k, color-graded. 9 Panels: 1.ELS, 2.LS, 3.MLS, 4.MS, 5.MCU, 6.CU, 7.ECU (detail), 8.Low Angle, 9.High Angle.
`;



        const SKIN_RENDER_CONFIG = `"skin_render_config": {
  "texture_quality": "8K_micro_detail",
  "epidermal_physics": {
    "surface": "natural skin grain with distinct visible pores (t-zone emphasis)",
    "hair": "visible vellus hair (peach fuzz) on cheeks and jawline",
    "light_interaction": "subsurface scattering (SSS) for translucent flesh tone",
    "reflectivity": "natural sebum sheen on high points (nose, cheekbones), no plastic gloss"
  },
  "imperfections": {
    "type": "dermatological irregularities",
    "details": ["fine lines", "tiny moles", "hyper-pigmentation", "micro-capillaries"],
    "distribution": "randomized, non-symmetrical"
  },
  "eyes": {
    "texture": "crystalline iris structure with wet-surface reflections",
    "details": "distinct lacrimal caruncle, individual eyelash strands"
  },
  "negative_constraints": ["airbrushed", "wax figure", "smooth filter", "doll-like", "flat lighting"]
}`;

        const HAIR_RENDER_CONFIG = `"hair_render_config": {
  "rendering_mode": "strand_based_simulation",
  "texture_details": {
    "structure": "individual strands visible, not mesh-like",
    "density": "natural follicle density with scalp visibility at parting",
    "micro_imperfections": ["flyaways", "frizz", "uneven breaks", "baby hairs at hairline"],
    "finish": "organic keratin sheen, anisotropic reflection"
  },
  "physics_and_movement": {
    "weight": "gravity-induced drape",
    "interaction": "blowing gently in wind, strands covering part of face",
    "chaos_factor": "high (avoiding plastic helmet look)"
  },
  "facial_integration": {
    "transition": "gradual hairline blending, not a hard line",
    "vellus": "visible peach fuzz on temples and neck"
  }
}`;

        const MAX_CONSISTENCY_PREFIX = `FACE ID LOCKED from reference. Exact facial match required - all features preserved.
"CONSISTENCY PROTOCOL": "100% facial feature".
"preservation from reference image".
"Preserve skin texture and micro-details".
"FACE LOCKED": "NON-NEGOTIABLE"
"FACE CONSISTENCY": "100% - All facial features must remain IDENTICAL to locked reference CHARACTER INTEGRITY: Maintain key features across all variations ZERO DEVIATION from specified eye color, hair color, face structure, unique identifiers
"Keep the facial features of the person in the uploaded image exactly consistent. Do not modify their identity. Maintain 70% identical bone structure, skin tone, and facial imperfections (moles, scars)."
--cw 100
`;

        // =============================================
        // UTILS
        // =============================================
        const $ = id => document.getElementById(id);
        const esc = s => (s ?? "").toString().replace(/[&<>"']/g, m => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;" })[m]);

        function notify(msg, type = "success") {
          const n = $("notification");
          n.textContent = msg;
          n.className = "notification " + type;
          n.classList.add("show");
          clearTimeout(n._t);
          n._t = setTimeout(() => n.classList.remove("show"), 2500);
        }

        function wordCount(t) { const s = (t || "").trim(); return s ? s.split(/\s+/).length : 0; }
        function deepClone(o) { return JSON.parse(JSON.stringify(o)); }

        // =============================================
        // INIT
        // =============================================
        document.addEventListener("DOMContentLoaded", function () {
          // Detect file:// and warn user about limited functionality
          if (window.location.protocol === "file:") {
            var offlineBar = document.createElement("div");
            offlineBar.style.cssText = "background:#2d1f00;color:#fdcb6e;padding:8px 16px;font-size:.82em;text-align:center;border-bottom:1px solid #fdcb6e;position:sticky;top:0;z-index:9999;";
            offlineBar.innerHTML = "üìÅ –õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º (file://) ‚Äî –ø–µ—Ä–µ–≤–æ–¥ –∏ —à—Ä–∏—Ñ—Ç—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã. –î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä.";
            document.body.insertBefore(offlineBar, document.body.firstChild);
          }
          initPresets();
          bindEvents();
          setPromptFormat(state.promptFormat);
          updateAll();
        });

        function initPresets() {
          const g = $("presetGrid");
          g.innerHTML = "";
          presets.forEach((p, i) => {
            const b = document.createElement("button");
            b.className = "option-btn";
            b.style.borderColor = "var(--green)";
            b.style.borderWidth = "2px";
            b.dataset.presetIndex = String(i);
            b.textContent = p.name;
            b.addEventListener("click", () => applyPreset(i));
            g.appendChild(b);
          });
        }

        function bindEvents() {
          // Delegated clicks on option buttons
          document.addEventListener("click", (e) => {
            const btn = e.target.closest(".option-btn");
            if (!btn) return;

            if (btn.dataset.action === "addNegative") {
              addNegative(btn.dataset.value || "");
              return;
            }

            const group = btn.dataset.group;
            if (!group) return;
            handleSelect(group, btn.dataset.value || "");
          });

          $("referenceImages").addEventListener("change", handleImageUpload);
          $("refWeightSlider").addEventListener("input", (e) => {
            state.referenceWeight = parseInt(e.target.value, 10);
            $("weightValue").textContent = String(state.referenceWeight);
            updateAll();
          });

          // Gen params sliders
          $("mjStylizeSlider").addEventListener("input", (e) => { state.mjStylize = +e.target.value; $("mjStylizeVal").textContent = state.mjStylize; updateAll(); });
          $("mjChaosSlider").addEventListener("input", (e) => { state.mjChaos = +e.target.value; $("mjChaosVal").textContent = state.mjChaos; updateAll(); });
          $("mjWeirdSlider").addEventListener("input", (e) => { state.mjWeird = +e.target.value; $("mjWeirdVal").textContent = state.mjWeird; updateAll(); });
          $("sdCfgSlider").addEventListener("input", (e) => { state.sdCfg = +e.target.value; $("sdCfgVal").textContent = state.sdCfg; updateAll(); });
          $("sdStepsSlider").addEventListener("input", (e) => { state.sdSteps = +e.target.value; $("sdStepsVal").textContent = state.sdSteps; updateAll(); });
          $("fluxGuidanceSlider").addEventListener("input", (e) => { state.fluxGuidance = +e.target.value; $("fluxGuidanceVal").textContent = state.fluxGuidance; updateAll(); });
          $("fluxStepsSlider").addEventListener("input", (e) => { state.fluxSteps = +e.target.value; $("fluxStepsVal").textContent = state.fluxSteps; updateAll(); });

          // Compact button
          $("compactBtn").addEventListener("click", compactPrompt);

          $("copyPromptBtn").addEventListener("click", copyPrompt);
          $("copyJsonBtn").addEventListener("click", copyJson);
          $("resetBtn").addEventListener("click", resetAll);
          $("saveBtn").addEventListener("click", savePrompt);

          // Special modes checkboxes ‚Äî bind via JS, not inline
          ["generateFourMode", "grid3x3Mode", "maxConsistency", "beforeAfter", "seamlessPattern", "skinRenderBoost", "hairRenderBoost"].forEach(id => {
            const cb = $(id);
            if (cb) {
              cb.addEventListener("change", () => {
                state[id] = cb.checked;

                // Visual feedback on label
                cb.closest(".toggle-label").classList.toggle("checked", cb.checked);
                updateAll();
              });
              // Also handle click on label itself for robustness
              cb.closest("label").addEventListener("click", (e) => {
                // Only handle if the click was on the label text, not the checkbox itself
                if (e.target === cb) return;
                e.preventDefault();
                cb.checked = !cb.checked;
                state[id] = cb.checked;
                cb.closest(".toggle-label").classList.toggle("checked", cb.checked);
                updateAll();
              });
            }
          });

          // Seed buttons
          $("randomSeedBtn").addEventListener("click", () => {
            const seed = Math.floor(Math.random() * 4294967295);
            $("seedInput").value = seed; state.seed = String(seed); updateAll();
            notify("Seed: " + seed);
          });
          $("clearSeedBtn").addEventListener("click", () => {
            $("seedInput").value = "";
            state.seed = "";
            updateAll();
          });
        }

        function handleInput() { updateAll(); }

        // =============================================
        // TRANSLATE SCENE ‚Äî MyMemory API (free, no key)
        // =============================================
        function translateScene() {
          var textarea = $("mainSubject");
          var text = textarea.value.trim();
          var status = $("translateStatus");
          var btn = $("translateBtn");

          if (!text) { notify("–ü–æ–ª–µ –ø—É—Å—Ç–æ–µ", "warn"); return; }

          // Detect if already English
          var nonAscii = text.replace(/[a-zA-Z0-9\s.,!?;:\'"()\-\/\\@#$%^&*=+\[\]{}|<>~`]/g, "");
          if (nonAscii.length < text.length * 0.15) {
            notify("–¢–µ–∫—Å—Ç —É–∂–µ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º", "warn");
            return;
          }

          btn.disabled = true;
          status.textContent = "–ü–µ—Ä–µ–≤–æ–¥–∏–º...";
          status.style.color = "var(--accent-light)";

          var encoded = encodeURIComponent(text);
          var url = "https://api.mymemory.translated.net/get?q=" + encoded + "&langpair=ru|en";

          // Use XMLHttpRequest for max compatibility (works where fetch doesn't)
          var xhr = new XMLHttpRequest();
          xhr.open("GET", url, true);
          xhr.timeout = 10000;

          xhr.onload = function () {
            try {
              var data = JSON.parse(xhr.responseText);
              if (data.responseStatus === 200 && data.responseData && data.responseData.translatedText) {
                var translated = data.responseData.translatedText;
                if (translated === translated.toUpperCase() && translated.length > 20) {
                  translated = translated.charAt(0).toUpperCase() + translated.slice(1).toLowerCase();
                }
                textarea.value = translated;
                state.mainSubject = translated;
                status.textContent = "‚úÖ –ü–µ—Ä–µ–≤–µ–¥–µ–Ω–æ";
                status.style.color = "var(--green)";
                updateAll();
                notify("–¢–µ–∫—Å—Ç –ø–µ—Ä–µ–≤–µ–¥—ë–Ω –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π");
              } else {
                throw new Error("API –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É");
              }
            } catch (e) {
              status.textContent = "‚ùå –û—à–∏–±–∫–∞";
              status.style.color = "var(--red, #ff7675)";
              notify("–û—à–∏–±–∫–∞ —Ä–∞–∑–±–æ—Ä–∞ –æ—Ç–≤–µ—Ç–∞: " + e.message, "err");
            }
            btn.disabled = false;
            setTimeout(function () { status.textContent = ""; }, 4000);
          };

          xhr.onerror = function () {
            status.textContent = "‚ùå –ù–µ—Ç —Å–µ—Ç–∏";
            status.style.color = "var(--red, #ff7675)";
            // Detect file:// protocol
            if (window.location.protocol === "file:") {
              notify("–ü–µ—Ä–µ–≤–æ–¥ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∏–∑ —Ñ–∞–π–ª–∞. –û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–Ω–ª–∞–π–Ω.", "err");
            } else {
              notify("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç", "err");
            }
            btn.disabled = false;
            setTimeout(function () { status.textContent = ""; }, 5000);
          };

          xhr.ontimeout = function () {
            status.textContent = "‚ùå –¢–∞–π–º–∞—É—Ç";
            status.style.color = "var(--red, #ff7675)";
            notify("–°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–≤–æ–¥–∞ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç", "err");
            btn.disabled = false;
            setTimeout(function () { status.textContent = ""; }, 4000);
          };

          try {
            xhr.send();
          } catch (e) {
            status.textContent = "‚ùå –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ";
            status.style.color = "var(--red, #ff7675)";
            if (window.location.protocol === "file:") {
              notify("–ü–µ—Ä–µ–≤–æ–¥ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∏–∑ —Ñ–∞–π–ª–∞ (file://). –û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ http://", "err");
            } else {
              notify("–ó–∞–ø—Ä–æ—Å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω: " + e.message, "err");
            }
            btn.disabled = false;
            setTimeout(function () { status.textContent = ""; }, 5000);
          }
        }

        // =============================================
        // SELECTION LOGIC
        // =============================================
        function handleSelect(group, value) {
          const mode = (groupConfig[group] && groupConfig[group].mode) || "single";

          if (mode === "single") {
            // Toggle off if clicking same value
            if (state[group] === value) state[group] = "";
            else state[group] = value;

            document.querySelectorAll(`[data-group="${group}"]`).forEach(b => {
              b.classList.toggle("active", b.dataset.value === state[group]);
              b.querySelectorAll(".slot-tag").forEach(t => t.remove());
            });

            if (group === "aspectRatio") {
              state.resolution = "";
              rebuildResolution();
            }
            if (group === "aiModel") {
              updateModelHint();
            }
          }

          if (mode === "multi") {
            if (!Array.isArray(state[group])) state[group] = [];
            const arr = state[group];
            const idx = arr.indexOf(value);
            if (idx >= 0) arr.splice(idx, 1); else arr.push(value);

            document.querySelectorAll(`[data-group="${group}"]`).forEach(b => {
              b.classList.toggle("active", arr.includes(b.dataset.value));
            });
          }

          if (mode === "primaryAccent") {
            togglePA(group, value);
          }

          updateAll();
        }

        function togglePA(group, value) {
          const cur = state[group] || { primary: "", accent: "" };

          if (cur.primary === value) { cur.primary = ""; }
          else if (cur.accent === value) { cur.accent = ""; }
          else if (!cur.primary) { cur.primary = value; }
          else if (!cur.accent) { cur.accent = value; }
          else { cur.accent = value; }

          state[group] = cur;
          syncPAUI(group);
        }

        function syncPAUI(group) {
          const cur = state[group] || { primary: "", accent: "" };
          document.querySelectorAll(`[data-group="${group}"]`).forEach(b => {
            const v = b.dataset.value;
            b.classList.toggle("active", v === cur.primary || v === cur.accent);
            b.querySelectorAll(".slot-tag").forEach(t => t.remove());

            if (v === cur.primary) {
              const t = document.createElement("span");
              t.className = "slot-tag primary"; t.textContent = "P";
              b.appendChild(t);
            }
            if (v === cur.accent) {
              const t = document.createElement("span");
              t.className = "slot-tag accent"; t.textContent = "A";
              b.appendChild(t);
            }
          });
        }

        function syncGroup(group) {
          const mode = groupConfig[group] && groupConfig[group].mode;
          if (mode === "single") {
            document.querySelectorAll(`[data-group="${group}"]`).forEach(b => {
              b.classList.toggle("active", b.dataset.value === state[group]);
              b.querySelectorAll(".slot-tag").forEach(t => t.remove());
            });
          }
          if (mode === "multi") {
            const arr = state[group] || [];
            document.querySelectorAll(`[data-group="${group}"]`).forEach(b => {
              b.classList.toggle("active", arr.includes(b.dataset.value));
            });
          }
          if (mode === "primaryAccent") syncPAUI(group);
        }

        // =============================================
        // RESOLUTION
        // =============================================
        function rebuildResolution() {
          const ar = state.aspectRatio;
          const info = $("resolutionInfo");
          const opts = $("resolutionOptions");
          opts.innerHTML = "";

          if (!ar || !resolutionMap[ar]) {
            info.style.display = "block";
            opts.style.display = "none";
            return;
          }
          info.style.display = "none";
          opts.style.display = "grid";

          resolutionMap[ar].forEach(r => {
            const b = document.createElement("button");
            b.className = "option-btn";
            b.dataset.group = "resolution";
            b.dataset.value = r.value;
            b.textContent = r.label;
            if (state.resolution === r.value) b.classList.add("active");
            opts.appendChild(b);
          });
        }

        // =============================================
        // MODEL HINTS
        // =============================================
        function updateModelHint() {
          const h = $("modelHint");
          if (state.aiModel && modelTips[state.aiModel]) {
            h.textContent = modelTips[state.aiModel];
            h.style.display = "block";
          } else {
            h.style.display = "none";
          }
        }

        function updateRefUI() {
          const isMJ = state.aiModel === "midjourney";
          const sec = $("referencesSection");
          const input = $("referenceImages");

          // Midjourney mode: disable reference upload entirely
          if (isMJ) {
            if (sec) sec.classList.add("disabled-section");
            if (input) {
              input.value = "";
              input.disabled = true;
            }
            state.referenceImages = [];
            $("imagePreviewContainer").style.display = "none";
            $("referenceOptions").style.display = "none";
            $("referenceWeight").style.display = "none";
            $("refUploadHint").innerHTML = "–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –æ—Ç–∫–ª—é—á–µ–Ω–∞ –¥–ª—è <b>Midjourney</b> –≤ —ç—Ç–æ–π –≤–µ—Ä—Å–∏–∏ –±–∏–ª–¥–µ—Ä–∞.";
            return;
          }

          // Non-MJ engines: enable references
          if (sec) sec.classList.remove("disabled-section");
          if (input) input.disabled = false;

          $("refUploadHint").textContent = "–î–æ 3 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π. –û–ø–∏—à–∏—Ç–µ, —á—Ç–æ –≤–∑—è—Ç—å –∏–∑ –∫–∞–∂–¥–æ–≥–æ.";
          $("referenceImages").setAttribute("multiple", "");

          const hasRefs = state.referenceImages.length > 0;
          if (!hasRefs) {
            $("imagePreviewContainer").style.display = "none";
            $("referenceOptions").style.display = "none";
            $("referenceWeight").style.display = "none";
            return;
          }

          $("imagePreviewContainer").style.display = "block";
          $("referenceOptions").style.display = "block";
          // Weight slider: useful for SD and Flux (IP-Adapter). Not useful for chatgpt/nano/dall-e/ideogram/etc.
          const needsWeight = ["stable-diffusion", "flux"].includes(state.aiModel);
          $("referenceWeight").style.display = needsWeight ? "block" : "none";
        }

        function updateGenParamsUI() {
          const m = state.aiModel;
          $("mjGenParams").style.display = m === "midjourney" ? "block" : "none";
          $("sdGenParams").style.display = m === "stable-diffusion" ? "block" : "none";
          $("fluxGenParams").style.display = m === "flux" ? "block" : "none";
          $("dalleGenParams").style.display = m === "dall-e-3" ? "block" : "none";
          $("noGenParams").style.display = ["midjourney", "stable-diffusion", "flux", "dall-e-3", ""].includes(m) ? "none" : "block";
        }

        // =============================================
        // COMPACT PROMPT ‚Äî strip to essential core
        // =============================================
        function compactPrompt() {
          const outBox = $("promptOutput");
          let text = outBox.textContent || "";
          if (!text.trim() || text.includes("Select parameters") || text.includes("–í—ã–±–µ—Ä–∏—Ç–µ")) {
            notify("–ü—Ä–æ–º–ø—Ç –ø—É—Å—Ç", "warn"); return;
          }

          // Remove quality spam keywords
          const qualitySpam = [
            "8k", "4k", "2k", "masterpiece", "best quality", "ultra detailed",
            "high quality", "detailed", "highly detailed", "professional",
            "award-winning", "amazing", "beautiful", "stunning"
          ];
          let parts = text.split(", ");
          parts = parts.filter(p => {
            const low = p.trim().toLowerCase();
            return !qualitySpam.some(q => low === q || low === q + ",");
          });

          // Remove duplicate semantic concepts
          const seen = new Set();
          parts = parts.filter(p => {
            const key = p.trim().toLowerCase().replace(/[^a-z0-9]/g, "").slice(0, 20);
            if (seen.has(key)) return false;
            seen.add(key);
            return true;
          });

          // Strip appended reference/negative sections
          let cleaned = parts.join(", ");
          cleaned = cleaned.replace(/\n\n--- Reference images ---[\s\S]*$/, "");
          cleaned = cleaned.replace(/\nNegative prompt:[\s\S]*$/, "");
          cleaned = cleaned.replace(/,\s*,/g, ",").replace(/,\s*$/, "").trim();

          outBox.textContent = cleaned;
          $("charCount").textContent = String(cleaned.length);
          $("wordCount").textContent = String(cleaned.split(/\s+/).filter(Boolean).length);
          notify("‚ö° –ü—Ä–æ–º–ø—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω ‚Äî —É–±—Ä–∞–Ω—ã –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ —Å–ª–æ–≤–∞");
        }

        // =============================================
        // REFERENCES
        // =============================================
        function handleImageUpload(event) {
          const files = Array.from(event.target.files || []).slice(0, 3);
          if (!files.length) return;

          // Disabled for Midjourney in this build
          if (state.aiModel === "midjourney") {
            event.target.value = "";
            notify("–†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç–∫–ª—é—á–µ–Ω—ã –¥–ª—è Midjourney", "warn");
            return;
          }

          state.referenceImages = [];
          const previews = $("imagePreviews");
          previews.innerHTML = "";

          files.forEach((file, index) => {
            const reader = new FileReader();
            reader.onload = (e) => {
              const imgData = { name: file.name, data: e.target.result, size: (file.size / 1024).toFixed(1) + " KB", description: "", width: 0, height: 0 };

              // Capture actual image dimensions
              const tempImg = new Image();
              tempImg.onload = () => {
                imgData.width = tempImg.naturalWidth;
                imgData.height = tempImg.naturalHeight;
              };
              tempImg.src = e.target.result;

              state.referenceImages.push(imgData);

              const card = document.createElement("div");
              card.className = "image-preview-card";
              imgData.extract = [];
              card.innerHTML = `
            <button class="image-remove-btn" data-remove-index="${index}">√ó</button>
            <div><img src="${e.target.result}" alt="${esc(file.name)}"></div>
            <div class="image-preview-details">
              <div class="image-preview-info">
                <div style="font-weight:800;color:var(--accent-light);margin-bottom:3px;">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ${index + 1}</div>
                <div>${esc(file.name)} ¬∑ ${esc(imgData.size)}</div>
              </div>
              <div class="ref-extract-row">
                ${REF_EXTRACT_OPTIONS.map((opt, oi) => `<label class="ref-extract-label"><input type="checkbox" data-ext-img="${index}" data-ext-opt="${oi}"> ${opt}</label>`).join("")}
              </div>
              <textarea class="image-description-input" data-desc-index="${index}" placeholder="–î–æ–ø. –æ–ø–∏—Å–∞–Ω–∏–µ: —á—Ç–æ –∏–º–µ–Ω–Ω–æ –≤–∑—è—Ç—å..."></textarea>
            </div>`;
              // Wire extract checkboxes
              card.querySelectorAll('[data-ext-img]').forEach(cb => {
                cb.addEventListener('change', function () {
                  const ii = parseInt(this.dataset.extImg, 10), oo = parseInt(this.dataset.extOpt, 10), opt = REF_EXTRACT_OPTIONS[oo];
                  if (!state.referenceImages[ii]) return;
                  if (!state.referenceImages[ii].extract) state.referenceImages[ii].extract = [];
                  const ex = state.referenceImages[ii].extract;
                  this.closest(".ref-extract-label").classList.toggle("ext-checked", this.checked);
                  if (this.checked) { if (!ex.includes(opt)) ex.push(opt) } else { const i = ex.indexOf(opt); if (i >= 0) ex.splice(i, 1) }
                  updateAll();
                });
              });
              previews.appendChild(card);

              card.querySelector(`[data-remove-index="${index}"]`).addEventListener("click", () => removeImage(index));
              card.querySelector(`[data-desc-index="${index}"]`).addEventListener("input", (ev) => {
                const i = parseInt(ev.target.dataset.descIndex, 10);
                if (state.referenceImages[i]) state.referenceImages[i].description = ev.target.value;
                updateAll();
              });

              $("imagePreviewContainer").style.display = "block";
              // Show reference controls for supported engines
              $("referenceOptions").style.display = "block";
              $("referenceWeight").style.display = ["stable-diffusion", "flux"].includes(state.aiModel) ? "block" : "none";
              updateAll();
            };
            reader.readAsDataURL(file);
          });
          notify(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${files.length} —Ñ–∞–π–ª(–æ–≤)`);
        }

        function removeImage(index) {
          state.referenceImages.splice(index, 1);
          if (!state.referenceImages.length) {
            $("imagePreviewContainer").style.display = "none";
            $("referenceOptions").style.display = "none";
            $("referenceWeight").style.display = "none";
            $("referenceImages").value = "";
            updateAll();
            return;
          }
          rebuildImageCards();
          updateAll();
        }

        function rebuildImageCards() {
          const previews = $("imagePreviews");
          previews.innerHTML = "";
          state.referenceImages.forEach((img, idx) => {
            const card = document.createElement("div");
            card.className = "image-preview-card";
            const extractChecks = REF_EXTRACT_OPTIONS.map((opt, oi) => {
              const checked = (img.extract || []).includes(opt) ? "checked" : "";
              return `<label class="ref-extract-label"><input type="checkbox" data-ext-img="${idx}" data-ext-opt="${oi}" ${checked}> ${opt}</label>`;
            }).join("");
            card.innerHTML = `
          <button class="image-remove-btn" data-remove-index="${idx}">√ó</button>
          <div><img src="${img.data}" alt="${esc(img.name)}"></div>
          <div class="image-preview-details">
            <div class="image-preview-info">
              <div style="font-weight:800;color:var(--accent-light);margin-bottom:3px;">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ${idx + 1}</div>
              <div>${esc(img.name)} ¬∑ ${esc(img.size)}</div>
            </div>
            <div class="ref-extract-row">${extractChecks}</div>
            <textarea class="image-description-input" data-desc-index="${idx}" placeholder="–ß—Ç–æ –≤–∑—è—Ç—å: –ø–∞–ª–∏—Ç—Ä—É, –ø–æ–∑—É, —Å—Ç–∏–ª—å, —Ç–µ–∫—Å—Ç—É—Ä—É...">${esc(img.description || "")}</textarea>
          </div>`;
            previews.appendChild(card);
            // Wire extract checkboxes
            card.querySelectorAll('[data-ext-img]').forEach(cb => {
              cb.addEventListener('change', function () {
                const ii = parseInt(this.dataset.extImg, 10), oo = parseInt(this.dataset.extOpt, 10), opt = REF_EXTRACT_OPTIONS[oo];
                if (!state.referenceImages[ii]) return;
                if (!state.referenceImages[ii].extract) state.referenceImages[ii].extract = [];
                const ex = state.referenceImages[ii].extract;
                if (this.checked) { if (!ex.includes(opt)) ex.push(opt) } else { const i = ex.indexOf(opt); if (i >= 0) ex.splice(i, 1) }
                updateAll();
              });
            });
            card.querySelector(`[data-remove-index="${idx}"]`).addEventListener("click", () => removeImage(idx));
            card.querySelector(`[data-desc-index="${idx}"]`).addEventListener("input", (ev) => {
              const i = parseInt(ev.target.dataset.descIndex, 10);
              if (state.referenceImages[i]) state.referenceImages[i].description = ev.target.value;
              updateAll();
            });
          });
        }

        // =============================================
        // NEGATIVES
        // =============================================
        function addNegative(text) {
          const f = $("negativePrompt");
          const cur = (f.value || "").trim();
          // Avoid duplicates
          const existing = cur.split(",").map(s => s.trim().toLowerCase());
          const newParts = text.split(",").map(s => s.trim()).filter(s => !existing.includes(s.toLowerCase()));
          if (!newParts.length) { notify("–£–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ", "warn"); return; }
          f.value = cur ? (cur + ", " + newParts.join(", ")) : newParts.join(", ");
          state.negativePrompt = f.value;
          updateAll();
        }

        // =============================================
        // PROMPT FORMAT
        // =============================================
        function setPromptFormat(fmt) {
          state.promptFormat = fmt;
          document.querySelectorAll(".format-tab").forEach(t => {
            t.classList.toggle("active", t.dataset.format === fmt);
          });
          const labels = { flat: "Flat (–ü–ª–æ—Å–∫–∏–π)", structured: "Structured (–°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π)", midjourney: "Midjourney —Å–∏–Ω—Ç–∞–∫—Å–∏—Å" };
          $("promptFormatLabel").textContent = labels[fmt] || fmt;
          updateAll();
        }


        // ChatGPT Image: style descriptions without author names (content policy)
        var CHATGPT_STYLE_MAP = {
          "in the style of Annie Leibovitz, dramatic portrait lighting, rich colors": "dramatic editorial portrait, rich warm saturated colors, deep shadows with golden highlights, intimate cinematic composition",
          "in the style of Peter Lindbergh, black and white, raw beauty, minimal retouching": "raw black-and-white portrait, unretouched natural beauty, high contrast silver gelatin aesthetic, emotional authenticity",
          "in the style of Steve McCurry, vivid saturated colors, documentary": "vivid hypersaturated documentary photograph, intense eye contact, Kodachrome warmth, National Geographic composition",
          "in the style of Helmut Newton, high contrast, provocative glamour, black and white": "high contrast glamour noir, provocative fashion pose, hard directional light, bold black-and-white with deep blacks",
          "in the style of Mario Testino, warm golden tones, glossy fashion": "warm golden fashion tones, sun-kissed glossy skin, aspirational luxury aesthetic, bright editorial warmth",
          "in the style of Tim Walker, surreal, fantastical, pastel dreamlike": "surreal fantastical set design, pastel dreamlike palette, whimsical oversized props, fairy-tale fashion fantasy",
          "in the style of Ansel Adams, high dynamic range landscape, deep blacks, zone system": "extreme tonal range landscape, pure black to bright white, zone-system exposure, majestic wilderness clarity",
          "in the style of Richard Avedon, stark white background, high contrast portrait": "stark pure white background, high contrast minimalist portrait, sharp focus on facial character, fashion-documentary hybrid",
          "in the style of Guy Bourdin, bold saturated colors, surreal fashion, strong shadows": "bold saturated pop colors, surreal fashion narrative, hard geometric shadows, provocative avant-garde composition",
          "in the style of Gregory Crewdson, cinematic suburban, eerie twilight, elaborate staged": "cinematic suburban tableau, eerie twilight atmosphere, elaborate staged scene, uncanny everyday mystery",
          "cinematography by Roger Deakins, naturalistic light, precise framing, atmospheric": "naturalistic motivated lighting, precise geometric framing, atmospheric haze, restrained palette with emotional depth",
          "cinematography by Emmanuel Lubezki, long takes, natural light, immersive": "pure natural light, immersive wide-angle perspective, ethereal luminosity, spiritual fluid movement feel",
          "cinematography by Hoyte van Hoytema, IMAX, desaturated palette, epic scale": "IMAX large-format clarity, desaturated cool palette, epic monumental scale, tactile film grain texture",
          "cinematography by Robert Richardson, high contrast, bold color, dynamic lighting": "aggressive high-contrast lighting, bold expressive color, dramatic rim lights, kinetic visual energy",
          "cinematography by Bradford Young, low-key lighting, rich shadows, warm undertones": "low-key intimate lighting, rich layered shadows, warm amber undertones, textured underexposed beauty",
          "cinematography by Janusz Kaminski, overexposed highlights, bleach bypass": "overexposed blown highlights, bleach bypass silver tones, diffused backlight halos, raw documentary feel",
          "cinematography by Vittorio Storaro, painterly light, rich color symbolism": "painterly Renaissance lighting, rich symbolic color storytelling, warm-to-cool emotional transitions, operatic grandeur",
          "cinematography by Greig Fraser, anamorphic, moody atmosphere, teal and orange": "anamorphic lens distortion, moody atmospheric haze, teal-and-orange grade, modern epic texture",
          "cinematography by Linus Sandgren, warm nostalgic tones, golden light, film grain": "warm nostalgic golden tones, classic Hollywood glamour, visible film grain, romantic soft focus",
          "cinematography by Ari Wegner, textured natural light, intimate framing, muted palette": "textured available-light naturalism, intimate observational framing, muted period-authentic palette",
          "directed by Denis Villeneuve, vast scale, muted desaturated palette, atmospheric silence, epic compositions": "vast monumental scale, muted desaturated palette, atmospheric silence and negative space, geometric epic compositions",
          "directed by Wes Anderson, symmetrical framing, pastel color palette, whimsical miniature aesthetic": "obsessively symmetrical framing, curated pastel palette, whimsical dollhouse aesthetic, centered compositions",
          "directed by Christopher Nolan, IMAX large format, desaturated blue tones, practical effects, epic scope": "IMAX large-format grandeur, desaturated cool blue tones, grounded practical realism, epic cerebral scope",
          "directed by David Fincher, dark muted palette, precise framing, cold blue-green tones, clinical aesthetic": "dark muted palette, mathematically precise framing, cold blue-green undertones, clinical sterile aesthetic",
          "directed by Ridley Scott, atmospheric haze, painterly compositions, epic historical grandeur": "atmospheric haze and smoke, painterly Renaissance compositions, epic historical grandeur, chiaroscuro depth",
          "directed by Quentin Tarantino, bold saturated colors, dynamic angles, retro grindhouse aesthetic": "bold oversaturated retro colors, dynamic low-angle shots, vintage grindhouse grain, pop-culture pastiche",
          "directed by Greta Gerwig, warm natural light, soft pastels, intimate handheld framing, nostalgic warmth": "warm natural window light, soft nostalgic pastels, intimate handheld framing, gentle feminine warmth",
          "directed by Jordan Peele, unsettling suburban beauty, vivid colors, horror tension, surreal undertones": "unsettling suburban uncanny beauty, vivid hyper-real colors, creeping horror tension, surreal social undertones",
          "directed by Bong Joon-ho, social contrast, sharp compositions, dark humor, class division visual metaphor": "sharp architectural compositions, visual class-division metaphors, dark satirical tone, spatial contrast storytelling",
          "directed by Chloe Zhao, golden hour landscapes, natural light, documentary intimacy, vast American West": "golden hour vast landscape, purely natural light, documentary intimate realism, poetic frontier beauty"
        };
        // =============================================
        // BUILD PROMPT ‚Äî FLAT (universal, recommended)
        // =============================================
        function buildFlatPrompt() {
          const headers = [];
          const parts = [];

          // 1. Headers (Metadata)
          // Aspect ratio & resolution ‚Äî prepend as metadata tags
          if (state.aspectRatio) headers.push(`[Aspect: ${state.aspectRatio}]`);
          if (state.resolution) headers.push(`[Resolution: ${state.resolution}]`);

          // 2. Styles & Parameters
          // Skip quality keywords for MJ (uses --q parameter instead)
          if (state.quality && state.aiModel !== "midjourney") parts.push(state.quality);
          if (state.purpose) parts.push(state.purpose);
          // Skip "photorealistic" if purpose already implies it (Photography, Cinematic Still)
          if (state.format) {
            const skipPhotoreal = state.format === "photorealistic" && ["Photography", "Cinematic Still", "Product Photography"].includes(state.purpose);
            if (!skipPhotoreal) parts.push(state.format);
          }

          // NOTE: Main Subject is handled separately below

          // Camera
          if (state.cameraBody) parts.push(state.cameraBody);
          if (state.lens) parts.push(state.lens);
          if (state.aperture) parts.push(state.aperture);
          if (state.filmStock) parts.push(state.filmStock);
          if (state.angle) parts.push(state.angle);
          if (state.composition) parts.push(state.composition);

          // Lighting ‚Äî flat, no curly braces
          if (state.lightType.primary) parts.push(state.lightType.primary);
          if (state.lightType.accent) parts.push(state.lightType.accent);
          if (state.timeOfDay.primary) parts.push(state.timeOfDay.primary);
          if (state.timeOfDay.accent) parts.push(state.timeOfDay.accent);

          // Effects
          state.lightFX.forEach(fx => parts.push(fx));
          if (state.colorPalette) parts.push(state.colorPalette);

          // Skin
          state.skinDetail.forEach(s => parts.push(s));
          state.hairDetail.forEach(h => parts.push(h));

          // Materials
          state.material.forEach(m => parts.push(m));

          // Text
          if (state.textContent) parts.push(`text "${state.textContent}"`);
          state.typography.forEach(t => parts.push(t));

          // Modes
          // Styles ‚Äî ChatGPT: swap author names for descriptions
          var _cg = state.aiModel === "chatgpt-image";
          if (state.photoStyle) parts.push(_cg ? (CHATGPT_STYLE_MAP[state.photoStyle] || state.photoStyle) : state.photoStyle);
          if (state.cinemaStyle) parts.push(_cg ? (CHATGPT_STYLE_MAP[state.cinemaStyle] || state.cinemaStyle) : state.cinemaStyle);
          if (state.directorStyle) parts.push(_cg ? (CHATGPT_STYLE_MAP[state.directorStyle] || state.directorStyle) : state.directorStyle);
          // Quick Style Preset
          if (state.quickStyle && QUICK_STYLES[state.quickStyle]) parts.push(QUICK_STYLES[state.quickStyle]);

          // Special modes
          if (state.beforeAfter) parts.push("before and after side-by-side comparison");
          if (state.seamlessPattern) parts.push("seamless tileable pattern");
          // Seed is passed as parameter, not in prompt text

          // 3. Construct Final String
          let finalPrompt = "Generate an image.\n";

          // Add Headers
          if (headers.length > 0) finalPrompt += headers.join(", ") + "\n";

          // Add Subject (on new line with prefix)
          if (state.mainSubject && state.mainSubject.trim()) {
            finalPrompt += `subject: ${state.mainSubject.trim()}\n`;
          }

          // Add Modifiers
          const modifiers = parts.filter(Boolean).join(", ");
          if (modifiers) finalPrompt += modifiers;

          // References note (not part of actual prompt, but informational)
          let refs = "";
          if (state.referenceImages.length) {
            refs += "\n\n--- Reference images ---\n";
            refs += `${state.referenceImages.length} image(s), weight: ${state.referenceWeight}%`;
            if (state.referenceType) refs += `, type: ${state.referenceType}`;
            state.referenceImages.forEach((img, i) => {
              if ((img.description || "").trim()) refs += `\nImage ${i + 1}: ${img.description.trim()}`;
            });
          }

          return (finalPrompt + refs).trim() || "Select parameters on the left...";
        }

        // =============================================
        // BUILD PROMPT ‚Äî STRUCTURED
        // =============================================
        function buildStructuredPrompt() {
          let out = "";

          if (state.aiModel) out += `[Model: ${state.aiModel}]\n`;
          if (state.aspectRatio) out += `[Aspect: ${state.aspectRatio}]`;
          if (state.resolution) out += ` [Resolution: ${state.resolution}]`;
          if (state.aspectRatio || state.resolution) out += "\n";
          out += "\n";

          // Main prompt
          const parts = [];
          if (state.quality && state.aiModel !== "midjourney") parts.push(state.quality);
          if (state.purpose) parts.push(state.purpose);
          if (state.format && !(state.format === "photorealistic" && ["Photography", "Cinematic Still", "Product Photography"].includes(state.purpose))) parts.push(state.format);
          if (state.mainSubject) parts.push(state.mainSubject.trim());
          out += parts.filter(Boolean).join(", ") + "\n\n";

          // Camera
          if (state.cameraBody || state.lens || state.aperture || state.angle || state.composition) {
            out += "CAMERA: ";
            const cam = [];
            if (state.cameraBody) cam.push(state.cameraBody);
            if (state.lens) cam.push(state.lens);
            if (state.aperture) cam.push(state.aperture);
            if (state.angle) cam.push(state.angle);
            if (state.composition) cam.push(state.composition);
            out += cam.join(", ") + "\n";
          }

          // Lighting
          const lightParts = [];
          if (state.lightType.primary) lightParts.push(state.lightType.primary);
          if (state.lightType.accent) lightParts.push(state.lightType.accent);
          if (state.timeOfDay.primary) lightParts.push(state.timeOfDay.primary);
          if (state.timeOfDay.accent) lightParts.push(state.timeOfDay.accent);
          if (lightParts.length) out += "LIGHTING: " + lightParts.join(", ") + "\n";

          if (state.lightFX.length) out += "EFFECTS: " + state.lightFX.join(", ") + "\n";
          if (state.colorPalette) out += "PALETTE: " + state.colorPalette + "\n";
          if (state.skinDetail.length) out += "SKIN: " + state.skinDetail.join(", ") + "\n";
          if (state.hairDetail.length) out += "HAIR: " + state.hairDetail.join(", ") + "\n";
          if (state.material.length) out += "MATERIALS: " + state.material.join(", ") + "\n";

          if (state.textContent) {
            out += `TEXT: "${state.textContent}"`;
            if (state.typography.length) out += ` [${state.typography.join(", ")}]`;
            out += "\n";
          }

          // Modes
          var _cgs = state.aiModel === "chatgpt-image";
          if (state.photoStyle) out += "STYLE: " + (_cgs ? (CHATGPT_STYLE_MAP[state.photoStyle] || state.photoStyle) : state.photoStyle) + "\n";
          if (state.cinemaStyle) out += "CINEMATOGRAPHY: " + (_cgs ? (CHATGPT_STYLE_MAP[state.cinemaStyle] || state.cinemaStyle) : state.cinemaStyle) + "\n";
          if (state.directorStyle) out += "DIRECTOR: " + (_cgs ? (CHATGPT_STYLE_MAP[state.directorStyle] || state.directorStyle) : state.directorStyle) + "\n";
          if (state.quickStyle && QUICK_STYLES[state.quickStyle]) out += "STYLE PRESET: " + QUICK_STYLES[state.quickStyle] + "\n";
          const modes = [];
          if (state.generateFourMode) modes.push("Generate 4 Variations");
          if (state.beforeAfter) modes.push("before/after");
          if (state.seamlessPattern) modes.push("seamless pattern");
          if (modes.length) out += "MODES: " + modes.join(", ") + "\n";
          if (state.seed) out += "SEED: " + state.seed + "\n";
          // Engine-specific params
          if (state.aiModel === "stable-diffusion") {
            out += `CFG: ${state.sdCfg} | Steps: ${state.sdSteps}\n`;
          }
          if (state.aiModel === "flux") {
            out += `Model: flux-${state.fluxModel} | Guidance: ${state.fluxGuidance} | Steps: ${state.fluxSteps}\n`;
          }
          if (state.aiModel === "dall-e-3") {
            out += `Style: ${state.dalleStyle} | Quality: ${state.dalleQuality}\n`;
          }

          // References
          if (state.referenceImages.length) {
            out += "\n--- REFERENCES ---\n";
            out += `Images: ${state.referenceImages.length}, Weight: ${state.referenceWeight}%`;
            if (state.referenceType) out += `, Type: ${state.referenceType}`;
            out += "\n";
            state.referenceImages.forEach((img, i) => {
              if ((img.description || "").trim()) out += `  #${i + 1}: ${img.description.trim()}\n`;
            });
          }

          return out.trim() || "Select parameters on the left...";
        }

        // =============================================
        // BUILD PROMPT ‚Äî MIDJOURNEY V7
        // =============================================
        function buildMidjourneyPrompt() {
          // MJ V7 best practice: natural language scene description, no quality spam
          // Structure: [scene/subject], [style cues], [technical], --params
          const desc = [];

          // Core scene
          if (state.mainSubject) desc.push(state.mainSubject.trim());

          // Format/style (only if NOT photorealistic ‚Äî MJ defaults to photo)
          if (state.format && state.format !== "photorealistic") desc.push(state.format);

          // Camera cues (MJ understands camera language well)
          if (state.cameraBody) {
            // Strip "shot on " prefix for cleaner MJ syntax
            desc.push(state.cameraBody.replace(/^shot on\s*/i, ""));
          }
          if (state.lens) desc.push(state.lens);
          if (state.aperture) {
            // Extract just f-number for MJ
            const fMatch = state.aperture.match(/f\/[\d.]+/);
            if (fMatch) desc.push(fMatch[0]);
          }
          if (state.filmStock) desc.push(state.filmStock);
          if (state.angle) desc.push(state.angle);
          if (state.composition) desc.push(state.composition);

          // Lighting ‚Äî combine primary + accent naturally
          if (state.lightType.primary) desc.push(state.lightType.primary);
          if (state.lightType.accent) desc.push(state.lightType.accent);
          if (state.timeOfDay.primary) desc.push(state.timeOfDay.primary);

          // Light FX (MJ handles these well)
          state.lightFX.forEach(fx => desc.push(fx));
          if (state.colorPalette) desc.push(state.colorPalette);

          // Materials & textures (compact)
          state.skinDetail.forEach(s => desc.push(s));
          state.hairDetail.forEach(h => desc.push(h));
          state.material.forEach(m => desc.push(m));

          // Text in image
          if (state.textContent) desc.push(`"${state.textContent}"`);
          state.typography.forEach(t => desc.push(t));

          // Artistic styles
          if (state.photoStyle) desc.push(state.photoStyle);
          if (state.cinemaStyle) desc.push(state.cinemaStyle);
          if (state.directorStyle) desc.push(state.directorStyle);
          if (state.quickStyle && QUICK_STYLES[state.quickStyle]) desc.push(QUICK_STYLES[state.quickStyle]);

          // Purpose as style hint
          if (state.purpose && state.purpose !== "Photography") desc.push(state.purpose);

          // Special modes
          if (state.beforeAfter) desc.push("before and after comparison");
          if (state.seamlessPattern) desc.push("seamless pattern");

          // Build prompt ‚Äî comma separated, clean
          let prompt = desc.filter(Boolean).join(", ");
          // Clean: remove double commas, trim
          prompt = prompt.replace(/,\s*,/g, ",").replace(/,\s*$/, "").trim();

          // === MJ PARAMETERS ===
          const params = [];

          // AR
          if (state.aspectRatio) params.push(`--ar ${state.aspectRatio}`);

          // Quality
          if (state.quality && state.quality.includes("8k")) params.push("--q 1");

          // Stylize
          params.push(`--s ${state.mjStylize}`);

          // Chaos
          if (state.mjChaos > 0) params.push(`--chaos ${state.mjChaos}`);

          // Weird
          if (state.mjWeird > 0) params.push(`--weird ${state.mjWeird}`);

          // Style raw
          if (state.mjStyle === "raw") params.push("--style raw");

          // Version
          params.push(`--v ${state.mjVersion}`);

          // Tile for seamless
          if (state.seamlessPattern) params.push("--tile");

          // Seed
          if (state.seed) params.push("--seed " + state.seed);

          if (params.length) prompt += " " + params.join(" ");

          return prompt.trim() || "Select parameters on the left...";
        }

        // =============================================
        // BUILD JSON
        // =============================================
        function buildJson() {
          return {
            schema: "vpe-prompt-builder-v2",
            model: state.aiModel || null,
            subject: state.mainSubject || "",
            prompt_flat: buildFlatPrompt(),
            prompt_midjourney: state.aiModel === "midjourney" ? buildMidjourneyPrompt() : undefined,
            technical: {
              aspect_ratio: state.aspectRatio || null,
              resolution: state.resolution || null
            },
            parameters: {
              purpose: state.purpose || null,
              format: state.format || null,
              camera: { body: state.cameraBody || null, lens: state.lens || null, aperture: state.aperture || null, angle: state.angle || null, composition: state.composition || null },
              lighting: {
                type: { primary: state.lightType.primary || null, accent: state.lightType.accent || null },
                time: { primary: state.timeOfDay.primary || null, accent: state.timeOfDay.accent || null },
                effects: state.lightFX,
                palette: state.colorPalette || null
              },
              materials: { skin: state.skinDetail, hair: state.hairDetail, objects: state.material },
              text: state.textContent ? { content: state.textContent, style: state.typography } : null,
              quality: state.quality || null,
              photo_style: state.photoStyle || null,
              cinema_style: state.cinemaStyle || null,
              director_style: state.directorStyle || null,
              film_stock: state.filmStock || null,
              quick_style: state.quickStyle || null
            },
            modes: { generateFour: state.generateFourMode, grid3x3: state.grid3x3Mode, maxConsistency: state.maxConsistency, before_after: state.beforeAfter, seamless_pattern: state.seamlessPattern },
            renderBoost: { skin: state.skinRenderBoost, hair: state.hairRenderBoost },
            seed: state.seed || null,
            engine_params: (function () {
              const m = state.aiModel;
              if (m === "midjourney") return { version: state.mjVersion, style: state.mjStyle || "default", stylize: state.mjStylize, chaos: state.mjChaos, weird: state.mjWeird };
              if (m === "stable-diffusion") return { cfg_scale: state.sdCfg, steps: state.sdSteps };
              if (m === "flux") return { model: "flux-" + state.fluxModel, guidance: state.fluxGuidance, steps: state.fluxSteps };
              if (m === "dall-e-3") return { style: state.dalleStyle, quality: state.dalleQuality };
              return null;
            })(),
            references: {
              type: (state.referenceType || null),
              weight: state.referenceWeight,
              images: state.referenceImages.map((img, i) => ({
                name: img.name, size: img.size, description: img.description || "", extract: img.extract || [],
                role: state.aiModel === "midjourney" ? (i === 0 ? "omni-reference" : "style-reference") : undefined
              }))
            },
            negative: (state.negativePrompt || "").trim() || ""
          };
        }

        // =============================================
        // ACTIVE TAGS
        // =============================================
        function updateActiveTags() {
          const area = $("activeTags");
          area.innerHTML = "";

          const addTag = (label, value, type, onRemove) => {
            const tag = document.createElement("span");
            tag.className = `tag-item ${type || ""}`.trim();
            tag.innerHTML = `<span>${esc(label)}: <b>${esc(value)}</b></span><span class="remove">√ó</span>`;
            tag.querySelector(".remove").addEventListener("click", onRemove);
            area.appendChild(tag);
          };

          // Singles
          ["aiModel", "cameraBody", "aspectRatio", "resolution", "purpose", "format", "lens", "aperture", "angle", "composition", "quality", "colorPalette", "referenceType", "photoStyle", "cinemaStyle", "directorStyle", "filmStock", "quickStyle"].forEach(k => {
            if (state[k]) {
              addTag(k, state[k], "", () => {
                state[k] = "";
                syncGroup(k);
                if (k === "aspectRatio") { state.resolution = ""; rebuildResolution(); syncGroup("resolution"); }
                if (k === "aiModel") updateModelHint();
                updateAll();
              });
            }
          });

          // PA
          ["lightType", "timeOfDay"].forEach(k => {
            const v = state[k] || { primary: "", accent: "" };
            if (v.primary) addTag(k, v.primary, "primary", () => { state[k].primary = ""; syncPAUI(k); updateAll(); });
            if (v.accent) addTag(k, v.accent, "accent", () => { state[k].accent = ""; syncPAUI(k); updateAll(); });
          });

          // Multi
          ["lightFX", "skinDetail", "hairDetail", "material", "typography"].forEach(k => {
            (state[k] || []).forEach(val => {
              addTag(k, val, "", () => { state[k] = state[k].filter(x => x !== val); syncGroup(k); updateAll(); });
            });
          });

          // Modes
          if (state.generateFourMode) addTag("mode", "Generate 4", "", () => { $("generateFourMode").checked = false; state.generateFourMode = false; updateAll(); });
          if (state.grid3x3Mode) addTag("mode", "3√ó3 Contact Sheet", "", () => { $("grid3x3Mode").checked = false; state.grid3x3Mode = false; updateAll(); });
          if (state.maxConsistency) addTag("mode", "üîí Consistency", "", () => { $("maxConsistency").checked = false; state.maxConsistency = false; updateAll(); });
          // Engine params tags
          if (state.aiModel === "midjourney") {
            if (state.mjStyle === "raw") addTag("engine", "--style raw", "", () => { state.mjStyle = ""; syncGroup("mjStyle"); updateAll(); });
            if (state.mjChaos > 0) addTag("engine", "--chaos " + state.mjChaos, "");
            if (state.mjWeird > 0) addTag("engine", "--weird " + state.mjWeird, "");
          }
          if (state.aiModel === "dall-e-3") {
            addTag("engine", state.dalleStyle, "");
            addTag("engine", state.dalleQuality, "");
          }
          if (state.skinRenderBoost) addTag("render", "Skin Boost", "", () => { $("skinRenderBoost").checked = false; state.skinRenderBoost = false; updateAll(); });
          if (state.hairRenderBoost) addTag("render", "Hair Boost", "", () => { $("hairRenderBoost").checked = false; state.hairRenderBoost = false; updateAll(); });
          if (state.beforeAfter) addTag("mode", "before/after", "", () => { $("beforeAfter").checked = false; state.beforeAfter = false; updateAll(); });
          if (state.seamlessPattern) addTag("mode", "seamless", "", () => { $("seamlessPattern").checked = false; state.seamlessPattern = false; updateAll(); });
          if (state.seed) addTag("seed", "seed: " + state.seed, "", () => { $("seedInput").value = ""; state.seed = ""; updateAll(); });

          if (state.referenceImages.length) {
            addTag("refs", `${state.referenceImages.length} image(s)`, "", () => {
              state.referenceImages = []; $("referenceImages").value = "";
              $("imagePreviewContainer").style.display = "none";
              $("referenceOptions").style.display = "none";
              $("referenceWeight").style.display = "none";
              updateAll();
            });
          }
        }

        // =============================================
        // COUNT PARAMS
        // =============================================
        function countParams() {
          let c = 0;
          ["aiModel", "cameraBody", "aspectRatio", "resolution", "purpose", "format", "lens", "aperture", "angle", "composition", "quality", "referenceType", "photoStyle", "cinemaStyle", "directorStyle", "filmStock", "quickStyle"].forEach(k => { if (state[k]) c++; });
          ["lightFX", "skinDetail", "hairDetail", "material", "typography"].forEach(k => { if ((state[k] || []).length) c++; });
          if (state.colorPalette) c++;
          if (state.lightType.primary) c++;
          if (state.lightType.accent) c++;
          if (state.timeOfDay.primary) c++;
          if (state.timeOfDay.accent) c++;
          if ((state.mainSubject || "").trim()) c++;
          if ((state.textContent || "").trim()) c++;
          if ((state.negativePrompt || "").trim()) c++;
          if (state.generateFourMode) c++;
          if (state.grid3x3Mode) c++;
          if (state.maxConsistency) c++;
          if (state.skinRenderBoost) c++;
          if (state.hairRenderBoost) c++;
          if (state.mjStyle) c++;
          if (state.dalleStyle) c++;
          if (state.dalleQuality) c++;
          if (state.fluxModel) c++;
          if (state.beforeAfter) c++;
          if (state.seamlessPattern) c++;
          if (state.seed) c++;
          if (state.referenceImages.length) c++;
          return c;
        }

        // =============================================
        // UPDATE ALL
        // =============================================

        // =============================================
        // NEGATIVE ‚Äî always appended at the very end
        // =============================================
        function appendNegativeLast(text) {
          const negRaw = (state.negativePrompt || "").trim();
          if (!negRaw) return text;

          // Midjourney syntax: always last
          if (state.promptFormat === "midjourney" || state.aiModel === "midjourney") {
            const noWords = negRaw.replace(/,\s*/g, ", ");
            return (text.trim() + " --no " + noWords).trim();
          }

          if (state.promptFormat === "structured") {
            return (text.trim() + "\n\nNEGATIVE: " + negRaw).trim();
          }

          return (text.trim() + "\n\nNegative prompt: " + negRaw).trim();
        }


        function updateAll() {
          // Sync inputs to state
          state.mainSubject = $("mainSubject").value || "";
          state.textContent = $("textContent").value || "";
          state.negativePrompt = $("negativePrompt").value || "";
          state.generateFourMode = $("generateFourMode").checked;
          // Sync engine-specific button groups
          // (mjVersion, mjStyle, dalleStyle, dalleQuality, fluxModel are synced via handleSelect)
          state.grid3x3Mode = $("grid3x3Mode").checked;
          state.maxConsistency = $("maxConsistency").checked;
          state.beforeAfter = $("beforeAfter").checked;
          state.skinRenderBoost = $("skinRenderBoost").checked;
          state.hairRenderBoost = $("hairRenderBoost").checked;
          state.seamlessPattern = $("seamlessPattern").checked;
          state.seed = $("seedInput").value || "";

          // Sync PA UI
          syncPAUI("lightType");
          syncPAUI("timeOfDay");

          // === Update engine-specific panels ===
          updateRefUI();
          updateGenParamsUI();

          // Auto-switch prompt format when Midjourney selected
          if (state.aiModel === "midjourney" && state.promptFormat !== "midjourney") {
            setPromptFormat("midjourney");
          }
          // Return to flat format when Midjourney is deselected
          if (state.aiModel !== "midjourney" && state.promptFormat === "midjourney") {
            setPromptFormat("flat");
          }

          // === Generate 4 Mode: disable lens section ===
          if (state.generateFourMode) {
            $("lensSection").classList.add("disabled-section");
          } else {
            $("lensSection").classList.remove("disabled-section");
          }

          // === 3x3 Mode: disable lens, aperture, angle, composition (overridden by contact sheet) ===
          if (state.grid3x3Mode) {
            $("lensSection").classList.add("disabled-section");
          }

          // === CONFLICT DISABLING SYSTEM ===
          applyConflictRules();

          // Resolution
          rebuildResolution();

          // Tags
          updateActiveTags();

          // Build prompt based on format
          let promptText;
          if (state.promptFormat === "midjourney") promptText = buildMidjourneyPrompt();
          else if (state.promptFormat === "structured") promptText = buildStructuredPrompt();
          else promptText = buildFlatPrompt();

          // === RENDER BOOST CONFIGS ‚Äî append after main prompt ===
          if (state.skinRenderBoost) {
            promptText += "\n\n" + SKIN_RENDER_CONFIG;
          }
          if (state.hairRenderBoost) {
            promptText += "\n\n" + HAIR_RENDER_CONFIG;
          }

          // === SPECIAL MODE WRAPPING ===

          // Max Consistency ‚Äî prepend identity lock protocol (most effective at the very start)
          if (state.maxConsistency) {
            promptText = MAX_CONSISTENCY_PREFIX + "\n" + promptText;
          }

          // 3x3 Contact Sheet ‚Äî prepend the block to the beginning of the prompt
          if (state.grid3x3Mode) {
            promptText = GRID_3X3_PREFIX + promptText;
          }

          // Generate 4 ‚Äî prepend the JSON block, replacing "subject" with scene description if filled
          if (state.generateFourMode) {
            let g4block = GENERATE_FOUR_PREFIX;

            // Replace "subject" with scene description
            if (state.mainSubject && state.mainSubject.trim()) {
              g4block = g4block.replace(/of a subject/g, "of " + state.mainSubject.trim());
              g4block = g4block.replace(/the Subject/g, state.mainSubject.trim());
            }

            // Replace 21:9 with reference image aspect ratio if a reference is loaded
            if (state.referenceImages.length && state.referenceImages[0].width && state.referenceImages[0].height) {
              const w = state.referenceImages[0].width;
              const h = state.referenceImages[0].height;
              const ratio = w / h;

              // Find closest standard AR
              const standardARs = [
                { label: "1:1", val: 1 },
                { label: "4:5", val: 4 / 5 },
                { label: "3:4", val: 3 / 4 },
                { label: "2:3", val: 2 / 3 },
                { label: "9:16", val: 9 / 16 },
                { label: "5:4", val: 5 / 4 },
                { label: "4:3", val: 4 / 3 },
                { label: "3:2", val: 3 / 2 },
                { label: "16:9", val: 16 / 9 },
                { label: "21:9", val: 21 / 9 },
              ];
              let closest = standardARs[0];
              let minDiff = Math.abs(ratio - closest.val);
              for (const ar of standardARs) {
                const diff = Math.abs(ratio - ar.val);
                if (diff < minDiff) { minDiff = diff; closest = ar; }
              }

              const refAR = closest.label;
              if (refAR !== "21:9") {
                g4block = g4block.replace(/"aspect_ratio": "21:9"/g, '"aspect_ratio": "' + refAR + '"');
                g4block = g4block.replace(/in a 21:9 format/g, "in a " + refAR + " format");
              }
            }

            promptText = g4block + "\n\n" + promptText;
          }

          // Ensure NEGATIVE block is always the very last part of the final prompt
          promptText = appendNegativeLast(promptText);

          const outBox = $("promptOutput");
          outBox.textContent = promptText;
          outBox.classList.toggle("empty", promptText.includes("Select parameters"));

          // Stats
          $("charCount").textContent = String(promptText.length);
          $("wordCount").textContent = String(wordCount(promptText));
          $("paramCount").textContent = String(countParams());

          // JSON
          $("jsonOutput").textContent = JSON.stringify(buildJson(), null, 2);

          // Check conflicts
          checkConflicts();
        }

        // =============================================
        // CONFLICT RULES ‚Äî disables incompatible buttons
        // =============================================
        function applyConflictRules() {
          // Reset all conflict-disabled buttons first
          document.querySelectorAll(".option-btn.conflict-disabled").forEach(b => {
            b.disabled = false;
            b.classList.remove("conflict-disabled");
            b.title = "";
          });

          // Reset disabled-section overlay from previous Quick Style evaluation
          document.querySelectorAll(".left-panel > .section.disabled-section").forEach(sec => {
            sec.classList.remove("disabled-section");
          });

          // Helper: disable all buttons in a group
          function disableGroup(group, reason) {
            document.querySelectorAll(`[data-group="${group}"]`).forEach(b => {
              if (!b.classList.contains("active")) {
                b.disabled = true;
                b.classList.add("conflict-disabled");
                b.title = reason;
              }
            });
          }

          // Helper: disable specific buttons by value substring match
          function disableByValue(group, valuePart, reason) {
            document.querySelectorAll(`[data-group="${group}"]`).forEach(b => {
              const v = b.dataset.value || "";
              if (v.toLowerCase().includes(valuePart.toLowerCase()) && !b.classList.contains("active")) {
                b.disabled = true;
                b.classList.add("conflict-disabled");
                b.title = reason;
              }
            });
          }

          // Helper: disable specific buttons by exact value
          function disableExact(group, value, reason) {
            document.querySelectorAll(`[data-group="${group}"]`).forEach(b => {
              if (b.dataset.value === value && !b.classList.contains("active")) {
                b.disabled = true;
                b.classList.add("conflict-disabled");
                b.title = reason;
              }
            });
          }

          // Helper: disable/enable a toggle checkbox
          function disableToggle(id, reason) {
            const cb = $(id);
            if (cb && !cb.checked) {
              cb.disabled = true;
              const lbl = cb.closest(".toggle-label");
              if (lbl) { lbl.title = reason; lbl.style.opacity = "0.4"; }
            }
          }
          function enableToggle(id) {
            const cb = $(id);
            if (cb) {
              cb.disabled = false;
              const lbl = cb.closest(".toggle-label");
              if (lbl) { lbl.title = ""; lbl.style.opacity = ""; }
            }
          }

          const fmt = state.format;
          const purpose = state.purpose;
          const isArtistic = ["oil painting", "pencil sketch", "pixel art", "watercolor", "anime style", "vector illustration"].includes(fmt);
          const isAbstract = ["Logo Design", "UI Design", "Infographic"].includes(purpose);

          // =========================================
          // RULE 0a: Generate 4 ‚Üî 3x3 ‚Äî mutual exclusion
          // =========================================
          if (state.generateFourMode) {
            disableToggle("grid3x3Mode", "–ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å Generate 4");
          } else {
            enableToggle("grid3x3Mode");
          }
          if (state.grid3x3Mode) {
            disableToggle("generateFourMode", "–ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å 3√ó3 Contact Sheet");
          } else {
            if (!state.grid3x3Mode) enableToggle("generateFourMode");
          }

          // =========================================
          // RULE 0b: 3x3 Contact Sheet ‚Üí disable lens, aperture, angle, composition
          // (the contact sheet defines its own 9 shot types, camera, and aperture)
          // =========================================
          if (state.grid3x3Mode) {
            const reason3x3 = "–ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ 3√ó3 Contact Sheet";
            disableGroup("lens", reason3x3);
            disableGroup("aperture", reason3x3);
            disableGroup("angle", reason3x3);
            disableGroup("composition", reason3x3);
          }

          // =========================================
          // RULE 0c: Generate 4 ‚Üí disable lens (already handled by disabled-section on lensSection)
          // Also disable angle and composition since variations define their own shots
          // =========================================
          if (state.generateFourMode) {
            const reasonG4 = "–ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ Generate 4 Variations";
            disableGroup("angle", reasonG4);
            disableGroup("composition", reasonG4);
          }

          // =========================================
          // RULE 0d: Generate 4 / 3x3 ‚Üî beforeAfter, seamlessPattern ‚Äî mutually exclusive with grid modes
          // =========================================
          if (state.generateFourMode || state.grid3x3Mode) {
            disableToggle("beforeAfter", "–ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å —Ä–µ–∂–∏–º–æ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏");
            disableToggle("seamlessPattern", "–ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å —Ä–µ–∂–∏–º–æ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏");
          }

          // RULE 1: Artistic format ‚Üí camera body, lens, aperture non-selectable
          if (isArtistic) {
            const reason = `–§–æ—Ä–º–∞—Ç ¬´${fmt}¬ª –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–∞–º–µ—Ä—É/–æ–ø—Ç–∏–∫—É`;
            disableGroup("cameraBody", reason);
            disableGroup("lens", reason);
            disableGroup("aperture", reason);
          }

          // RULE 1b: TimeOfDay ‚Äî conflicting combinations
          // Night cannot be combined with midday/golden hour
          const nightValues = ["night, artificial lighting"];
          const dayValues = ["bright midday sun", "golden hour warm sunlight", "overcast diffused light"];
          if (state.timeOfDay.primary) {
            const isPrimNight = nightValues.some(v => state.timeOfDay.primary.includes(v));
            const isPrimDay = dayValues.some(v => state.timeOfDay.primary.includes(v));
            document.querySelectorAll('[data-group="timeOfDay"]').forEach(b => {
              if (b.classList.contains("active")) return;
              const val = b.dataset.value || "";
              const isNight = nightValues.some(v => val.includes(v));
              const isDay = dayValues.some(v => val.includes(v));
              if ((isPrimNight && isDay) || (isPrimDay && isNight)) {
                b.disabled = true;
                b.classList.add("conflict-disabled");
                b.title = isPrimNight ? "–ù–æ—á—å –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å –¥–Ω–µ–≤–Ω—ã–º —Å–≤–µ—Ç–æ–º" : "–î–Ω–µ–≤–Ω–æ–π —Å–≤–µ—Ç –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º —Å –Ω–æ—á—å—é";
              }
            });
          }

          // RULE 2: Pixel art / anime ‚Üí skin detail & hair detail non-selectable
          if (fmt === "pixel art" || fmt === "anime style") {
            const reason = `–§–æ—Ä–º–∞—Ç ¬´${fmt}¬ª –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ–æ—Ç–æ-–¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é`;
            disableGroup("skinDetail", reason);
            disableGroup("hairDetail", reason);
            // Also disable render boost checkboxes
            disableToggle("skinRenderBoost", reason);
            disableToggle("hairRenderBoost", reason);
          } else {
            if (!isAbstract) { enableToggle("skinRenderBoost"); enableToggle("hairRenderBoost"); }
          }

          // RULE 3: Logo / UI / Infographic ‚Üí skin, hair, aperture, styles non-selectable
          if (isAbstract) {
            const reason = `–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ ¬´${purpose}¬ª –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ä—Ç—Ä–µ—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏`;
            disableGroup("skinDetail", reason);
            disableGroup("hairDetail", reason);
            disableToggle("skinRenderBoost", reason);
            disableToggle("hairRenderBoost", reason);
            disableGroup("photoStyle", reason);
            disableGroup("cinemaStyle", reason);
            disableGroup("directorStyle", reason);
            disableGroup("aperture", reason);
          }

          // RULE 4: Macro lens + wide compositions
          if (state.lens && (state.lens.includes("Macro") || state.lens.includes("105mm"))) {
            disableByValue("composition", "wide shot", "–ú–∞–∫—Ä–æ-–æ–±—ä–µ–∫—Ç–∏–≤ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º —Å —à–∏—Ä–æ–∫–∏–º –ø–ª–∞–Ω–æ–º");
            disableByValue("composition", "extreme wide", "–ú–∞–∫—Ä–æ-–æ–±—ä–µ–∫—Ç–∏–≤ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º —Å –¥–∞–ª—å–Ω–∏–º –ø–ª–∞–Ω–æ–º");
          }

          // RULE 5: Ultra-wide lens + extreme close-up
          if (state.lens && (state.lens.includes("14mm") || state.lens.includes("14-24mm") || state.lens.includes("15-35mm"))) {
            disableByValue("composition", "extreme close-up", "–£–ª—å—Ç—Ä–∞-—à–∏—Ä–æ–∫–∏–π –æ–±—ä–µ–∫—Ç–∏–≤ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º —Å —ç–∫—Å—Ç—Ä. –∫—Ä—É–ø–Ω—ã–º –ø–ª–∞–Ω–æ–º");
          }

          // RULE 6: Flat lay ‚Üí only top-down angles
          if (state.composition && state.composition.includes("flat lay")) {
            const reason = "Flat Lay ‚Äî —Ç–æ–ª—å–∫–æ –≤–∏–¥ —Å–≤–µ—Ä—Ö—É";
            ["extreme low angle", "low angle shot", "slightly low angle", "eye level", "dutch angle", "over-the-shoulder", "POV first person"].forEach(v => {
              disableByValue("angle", v, reason);
            });
          }

          // RULE 7: Drone ‚Üí disable studio lighting
          if (state.angle && state.angle.includes("drone")) {
            disableByValue("lightType", "studio three-point", "–°—Ç—É–¥–∏–π–Ω—ã–π —Å–≤–µ—Ç –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º —Å –¥—Ä–æ–Ω-—Å—ä—ë–º–∫–æ–π");
            disableByValue("lightType", "softbox", "Softbox –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º —Å –¥—Ä–æ–Ω-—Å—ä—ë–º–∫–æ–π");
            disableByValue("lightType", "clamshell", "Clamshell –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º —Å –¥—Ä–æ–Ω-—Å—ä—ë–º–∫–æ–π");
            disableByValue("lightType", "butterfly", "Butterfly –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º —Å –¥—Ä–æ–Ω-—Å—ä—ë–º–∫–æ–π");
            disableByValue("lightType", "Rembrandt", "–†–µ–º–±—Ä–∞–Ω–¥—Ç –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º —Å –¥—Ä–æ–Ω-—Å—ä—ë–º–∫–æ–π");
            disableByValue("lightType", "split lighting", "–°–ø–ª–∏—Ç –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º —Å –¥—Ä–æ–Ω-—Å—ä—ë–º–∫–æ–π");
            disableByValue("lightType", "broad lighting", "Broad light –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º —Å –¥—Ä–æ–Ω-—Å—ä—ë–º–∫–æ–π");
          }

          // RULE 8: Studio lighting ‚Üí disable drone
          if (state.lightType.primary && (
            state.lightType.primary.includes("studio") || state.lightType.primary.includes("softbox") ||
            state.lightType.primary.includes("clamshell") || state.lightType.primary.includes("butterfly") ||
            state.lightType.primary.includes("Rembrandt") || state.lightType.primary.includes("split") ||
            state.lightType.primary.includes("broad")
          )) {
            disableByValue("angle", "drone", "–î—Ä–æ–Ω –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º —Å–æ —Å—Ç—É–¥–∏–π–Ω—ã–º —Å–≤–µ—Ç–æ–º");
          }

          // RULE 9: B&W style ‚Üí disable neon
          if (state.photoStyle && state.photoStyle.includes("black and white")) {
            disableByValue("lightType", "neon", "–ù–µ–æ–Ω –Ω–µ –≤–∏–¥–µ–Ω –≤ —á/–± —Å—Ç–∏–ª–µ");
          }

          // RULE 10: Neon ‚Üí disable B&W styles
          if ((state.lightType.primary && state.lightType.primary.includes("neon")) ||
            (state.lightType.accent && state.lightType.accent.includes("neon"))) {
            document.querySelectorAll(`[data-group="photoStyle"]`).forEach(b => {
              if ((b.dataset.value || "").includes("black and white") && !b.classList.contains("active")) {
                b.disabled = true;
                b.classList.add("conflict-disabled");
                b.title = "–ß/–± —Å—Ç–∏–ª—å –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º —Å –Ω–µ–æ–Ω–æ–≤—ã–º –æ—Å–≤–µ—â–µ–Ω–∏–µ–º";
              }
            });
          }

          // RULE 11: beforeAfter ‚Üî seamlessPattern ‚Äî mutual exclusion
          if (state.beforeAfter) {
            disableToggle("seamlessPattern", "–ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å Before/After");
          } else if (!state.generateFourMode && !state.grid3x3Mode) {
            enableToggle("seamlessPattern");
          }
          if (state.seamlessPattern) {
            disableToggle("beforeAfter", "–ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å Seamless Pattern");
          } else if (!state.generateFourMode && !state.grid3x3Mode) {
            enableToggle("beforeAfter");
          }

          // RULE 12: f/1.2 ‚Üí disable extreme wide
          if (state.aperture && state.aperture.includes("f/1.2")) {
            disableByValue("composition", "extreme wide shot", "f/1.2 –Ω–µ—Ç–∏–ø–∏—á–Ω–∞ –¥–ª—è –¥–∞–ª—å–Ω–µ–≥–æ –ø–ª–∞–Ω–∞ (–Ω—É–∂–Ω–∞ f/8+)");
          }

          // RULE 13: Extreme wide ‚Üí disable f/1.2
          if (state.composition && state.composition.includes("extreme wide shot")) {
            disableByValue("aperture", "f/1.2", "–î–∞–ª—å–Ω–∏–π –ø–ª–∞–Ω –Ω–µ—Ç–∏–ø–∏—á–µ–Ω —Å f/1.2 (–Ω—É–∂–Ω–∞ f/8+)");
          }

          // RULE 14: Anamorphic ‚Üí only cinema/advertising
          if (state.lens && state.lens.includes("Anamorphic")) {
            document.querySelectorAll(`[data-group="purpose"]`).forEach(b => {
              const v = b.dataset.value || "";
              if (!["Cinematic Still", "Advertising campaign"].includes(v) && !b.classList.contains("active")) {
                b.disabled = true;
                b.classList.add("conflict-disabled");
                b.title = "–ê–Ω–∞–º–æ—Ä—Ñ–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –∫–∏–Ω–æ/—Ä–µ–∫–ª–∞–º–µ";
              }
            });
          }

          // RULE 15: Character Sheet + seamless pattern
          if (state.purpose === "Character Sheet") {
            disableToggle("seamlessPattern", "Seamless –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º —Å Character Sheet");
          }

          // RULE 16: One author style per category, BUT allow known collaborations
          // Known director-cinematographer pairs that worked together:
          const COLLABS = {
            // Director ‚Üí array of compatible cinematographer value substrings
            "Denis Villeneuve": ["Roger Deakins", "Greig Fraser"],
            "Christopher Nolan": ["Hoyte van Hoytema"],
            "Quentin Tarantino": ["Robert Richardson"],
            "Ridley Scott": ["Vittorio Storaro"],
            "David Fincher": ["Roger Deakins"],   // SE7EN planned, The Killer
            "Bong Joon-ho": ["Greig Fraser"],
          };
          // Photo style always conflicts with cinema/director (different domains)
          if (state.photoStyle) {
            disableGroup("cinemaStyle", "–°—Ç–∏–ª—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∞ —É–∂–µ –≤—ã–±—Ä–∞–Ω ‚Äî –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å—Ç–∏–ª–µ–π");
            disableGroup("directorStyle", "–°—Ç–∏–ª—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∞ —É–∂–µ –≤—ã–±—Ä–∞–Ω ‚Äî –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å—Ç–∏–ª–µ–π");
          }

          // Cinema + Director: allow if they are a known collaboration pair
          if (state.cinemaStyle && state.directorStyle) {
            // Both selected ‚Äî check if compatible
            let isCollab = false;
            for (const [dir, cins] of Object.entries(COLLABS)) {
              if (state.directorStyle.includes(dir) && cins.some(c => state.cinemaStyle.includes(c))) {
                isCollab = true; break;
              }
            }
            if (!isCollab) {
              // Not a known pair ‚Äî just show warning but don't disable (they're already selected)
            }
          } else if (state.cinemaStyle) {
            // Cinema selected, allow only compatible directors
            disableGroup("photoStyle", "–°—Ç–∏–ª—å –∫–∏–Ω–æ–æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ —É–∂–µ –≤—ã–±—Ä–∞–Ω ‚Äî –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å—Ç–∏–ª–µ–π");
            document.querySelectorAll('[data-group="directorStyle"]').forEach(b => {
              if (b.classList.contains("active")) return;
              const val = b.dataset.value || "";
              let compatible = false;
              for (const [dir, cins] of Object.entries(COLLABS)) {
                if (val.includes(dir) && cins.some(c => state.cinemaStyle.includes(c))) {
                  compatible = true; break;
                }
              }
              if (!compatible) {
                b.disabled = true;
                b.classList.add("conflict-disabled");
                b.title = "–ù–µ—Ç –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Å–æ–≤–º–µ—Å—Ç–Ω—ã—Ö —Ä–∞–±–æ—Ç —Å —ç—Ç–∏–º –∫–∏–Ω–æ–æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º";
              }
            });
          } else if (state.directorStyle) {
            // Director selected, allow only compatible cinematographers
            disableGroup("photoStyle", "–°—Ç–∏–ª—å —Ä–µ–∂–∏—Å—Å—ë—Ä–∞ —É–∂–µ –≤—ã–±—Ä–∞–Ω ‚Äî –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å—Ç–∏–ª–µ–π");
            document.querySelectorAll('[data-group="cinemaStyle"]').forEach(b => {
              if (b.classList.contains("active")) return;
              const val = b.dataset.value || "";
              let compatible = false;
              for (const [dir, cins] of Object.entries(COLLABS)) {
                if (state.directorStyle.includes(dir) && cins.some(c => val.includes(c))) {
                  compatible = true; break;
                }
              }
              if (!compatible) {
                b.disabled = true;
                b.classList.add("conflict-disabled");
                b.title = "–ù–µ—Ç –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Å–æ–≤–º–µ—Å—Ç–Ω—ã—Ö —Ä–∞–±–æ—Ç —Å —ç—Ç–∏–º —Ä–µ–∂–∏—Å—Å—ë—Ä–æ–º";
              }
            });
          }

          // RULE 18: Quick Style ‚Äî BLANKET DISABLE
          // Quick Style presets define complete visual language (camera, lens, lighting, color, texture).
          // When ANY preset is selected, ALL menus are disabled except: Aspect Ratio, Resolution, AI Model, and Quick Style itself.
          if (state.quickStyle) {
            const reason = "–°—Ç–∏–ª–µ–≤–æ–π –ø—Ä–µ—Å–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã. –°–Ω–∏–º–∏—Ç–µ –ø—Ä–µ—Å–µ—Ç –¥–ª—è —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.";

            // Disable ALL parameter groups except aspectRatio, resolution, aiModel, quickStyle
            const blanketDisableGroups = [
              "purpose", "format", "quality", "cameraBody", "lens", "aperture",
              "angle", "composition", "lightType", "timeOfDay", "lightFX",
              "colorPalette", "skinDetail", "hairDetail", "material",
              "photoStyle", "cinemaStyle", "directorStyle", "filmStock", "typography",
              "referenceType"
            ];
            blanketDisableGroups.forEach(g => disableGroup(g, reason));

            // Disable all toggle checkboxes
            disableToggle("skinRenderBoost", reason);
            disableToggle("hairRenderBoost", reason);
            disableToggle("generateFourMode", reason);
            disableToggle("grid3x3Mode", reason);
            disableToggle("maxConsistency", reason);
            disableToggle("beforeAfter", reason);
            disableToggle("seamlessPattern", reason);

            // Visually disable all sections except quickStyle and aspectRatio
            document.querySelectorAll(".left-panel > .section").forEach(sec => {
              const id = sec.id || "";
              // Keep quickStyleSection and aspectRatioSection enabled
              if (id === "quickStyleSection" || id === "aspectRatioSection") return;
              // Keep AI Model section enabled (needed to switch output format)
              if (sec.querySelector('[data-group="aiModel"]')) return;
              // Keep Scene Description enabled (user still needs to describe the subject)
              if (sec.querySelector('#mainSubject')) return;
              sec.classList.add("disabled-section");
            });
          }
          if (state.photoStyle || state.cinemaStyle || state.directorStyle) {
            disableGroup("quickStyle", "–ê–≤—Ç–æ—Ä—Å–∫–∏–π —Å—Ç–∏–ª—å —É–∂–µ –≤—ã–±—Ä–∞–Ω ‚Äî –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å–æ —Å—Ç–∏–ª–µ–≤—ã–º –ø—Ä–µ—Å–µ—Ç–æ–º");
          }

          // RULE 17: Seamless pattern ‚Üí only flat lay composition
          if (state.seamlessPattern) {
            document.querySelectorAll(`[data-group="composition"]`).forEach(b => {
              const v = b.dataset.value || "";
              if (!v.includes("flat lay") && !b.classList.contains("active")) {
                b.disabled = true;
                b.classList.add("conflict-disabled");
                b.title = "–ë–µ—Å—à–æ–≤–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å Flat Lay";
              }
            });
          }
        }

        // =============================================
        // PRESETS
        // =============================================
        function applyPreset(index) {
          const p = presets[index];
          if (!p) return;
          const v = deepClone(p.values);

          // Reset all selectable state
          ["aiModel", "cameraBody", "aspectRatio", "resolution", "purpose", "format", "lens", "aperture", "angle", "composition", "quality", "referenceType", "photoStyle", "cinemaStyle", "directorStyle"].forEach(k => state[k] = "");
          state.lightType = { primary: "", accent: "" };
          state.timeOfDay = { primary: "", accent: "" };
          state.lightFX = []; state.colorPalette = ""; state.skinDetail = []; state.hairDetail = []; state.material = []; state.typography = [];

          // Apply from preset
          Object.entries(v).forEach(([k, val]) => {
            if (k === "lightType" || k === "timeOfDay") {
              state[k] = val && typeof val === "object" ? val : { primary: "", accent: "" };
              return;
            }
            if (!groupConfig[k]) return;
            const mode = groupConfig[k].mode;
            if (mode === "single") state[k] = val || "";
            if (mode === "multi") state[k] = Array.isArray(val) ? val : [];
          });

          // Validate AR exists in buttons
          if (state.aspectRatio && !resolutionMap[state.aspectRatio]) {
            state.aspectRatio = ""; state.resolution = "";
            notify("AR –∏–∑ –ø—Ä–µ—Å–µ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å–±—Ä–æ—à–µ–Ω", "warn");
          } else {
            state.resolution = "";
          }

          // Sync all UI buttons
          Object.keys(groupConfig).forEach(syncGroup);
          updateModelHint();
          rebuildResolution();
          updateAll();
          notify("–ü—Ä–µ—Å–µ—Ç ¬´" + p.name.replace(/[^\w\s–∞-—è—ë–ê-–Ø–Å]/gi, "").trim() + "¬ª –ø—Ä–∏–º–µ–Ω—ë–Ω");
        }

        // =============================================
        // ACTIONS
        // =============================================
        // Reference extract handling
        const REF_EXTRACT_OPTIONS = ["–õ–∏—Ü–æ", "–ü–∞–ª–∏—Ç—Ä—É", "–ü–æ–∑—É", "–°—Ç–∏–ª—å", "–¢–µ–∫—Å—Ç—É—Ä—É"];

        // Conflict checking
        function checkConflicts() {
          const warnings = [];
          const isArtistic = ["oil painting", "pencil sketch", "pixel art", "watercolor", "anime style", "vector illustration"].includes(state.format);
          // photoStyle + cinemaStyle + directorStyle simultaneously
          const styleCount = [state.photoStyle, state.cinemaStyle, state.directorStyle].filter(Boolean).length;
          if (state.quickStyle && styleCount > 0) warnings.push("–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∏–ª–µ–≤–æ–π –ø—Ä–µ—Å–µ—Ç + –∞–≤—Ç–æ—Ä—Å–∫–∏–π —Å—Ç–∏–ª—å ‚Äî –∫–æ–Ω—Ñ–ª–∏–∫—Ç. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—Å—Ç–∞–≤–∏—Ç—å —á—Ç–æ-—Ç–æ –æ–¥–Ω–æ.");
          if (state.quickStyle && (state.cameraBody || state.lens)) warnings.push("–°—Ç–∏–ª–µ–≤–æ–π –ø—Ä–µ—Å–µ—Ç —É–∂–µ –∑–∞–¥–∞—ë—Ç –∫–∞–º–µ—Ä—É/–æ–ø—Ç–∏–∫—É ‚Äî –≤–∞—à –≤—ã–±–æ—Ä –º–æ–∂–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å.");
          if (styleCount > 1) warnings.push("–í—ã–±—Ä–∞–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä—Å–∫–∏—Ö —Å—Ç–∏–ª–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ ‚Äî –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—Å—Ç–∞–≤–∏—Ç—å –æ–¥–∏–Ω.");
          // Negative prompt with DALL-E/Flux
          if ((state.negativePrompt || "").trim() && (state.aiModel === "dall-e-3" || state.aiModel === "flux")) warnings.push("DALL¬∑E 3 –∏ Flux –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã ‚Äî –æ–Ω–∏ –±—É–¥—É—Ç –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω—ã.");
          // Macro lens + wide composition
          if (state.lens && (state.lens.includes("Macro") || state.lens.includes("105mm")) && state.composition && (state.composition.includes("wide shot") || state.composition.includes("extreme wide"))) warnings.push("–ú–∞–∫—Ä–æ-–æ–±—ä–µ–∫—Ç–∏–≤ + —à–∏—Ä–æ–∫–∏–π/–¥–∞–ª—å–Ω–∏–π –ø–ª–∞–Ω ‚Äî –Ω–µ—Ç–∏–ø–∏—á–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è.");
          // Ultra-wide + close-up
          if (state.lens && (state.lens.includes("14mm") || state.lens.includes("14-24mm") || state.lens.includes("15-35mm")) && state.composition && state.composition.includes("extreme close-up")) warnings.push("–£–ª—å—Ç—Ä–∞-—à–∏—Ä–æ–∫–∏–π –æ–±—ä–µ–∫—Ç–∏–≤ + —ç–∫—Å—Ç—Ä. –∫—Ä—É–ø–Ω—ã–π –ø–ª–∞–Ω ‚Äî –≤–æ–∑–º–æ–∂–Ω—ã —Å–∏–ª—å–Ω—ã–µ –∏—Å–∫–∞–∂–µ–Ω–∏—è.");
          // Anamorphic without cinema purpose
          if (state.lens && state.lens.includes("Anamorphic") && state.purpose && !["Cinematic Still", "Advertising campaign"].includes(state.purpose)) warnings.push("–ê–Ω–∞–º–æ—Ä—Ñ–æ—Ç–Ω–∞—è –æ–ø—Ç–∏–∫–∞ –Ω–µ—Ç–∏–ø–∏—á–Ω–∞ –¥–ª—è ¬´" + state.purpose + "¬ª.");
          // B&W photographer style + neon lighting
          if (state.photoStyle && state.photoStyle.includes("black and white") && ((state.lightType.primary && state.lightType.primary.includes("neon")) || (state.lightType.accent && state.lightType.accent.includes("neon")))) warnings.push("–ß/–± —Å—Ç–∏–ª—å + –Ω–µ–æ–Ω–æ–≤–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ ‚Äî –Ω–µ–æ–Ω –Ω–µ –≤–∏–¥–µ–Ω –≤ —á/–±.");
          // Text in MJ/SD
          if ((state.textContent || "").trim() && (state.aiModel === "midjourney" || state.aiModel === "stable-diffusion")) warnings.push("Midjourney –∏ Stable Diffusion –ø–ª–æ—Ö–æ —Ä–µ–Ω–¥–µ—Ä—è—Ç —Ç–µ–∫—Å—Ç. –î–ª—è —Ç–µ–∫—Å—Ç–∞ –ª—É—á—à–µ Ideogram –∏–ª–∏ DALL¬∑E 3.");
          // Artistic format + camera/lens
          if (["oil painting", "pencil sketch", "pixel art", "watercolor", "anime style", "vector illustration"].includes(state.format) && (state.cameraBody || state.lens)) warnings.push(`–§–æ—Ä–º–∞—Ç ¬´${state.format}¬ª + –∫–∞–º–µ—Ä–∞/–æ–±—ä–µ–∫—Ç–∏–≤ ‚Äî –Ω–µ—Ç–∏–ø–∏—á–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è.`);
          // Pixel art + skin/hair detail
          if ((state.format === "pixel art" || state.format === "anime style") && (state.skinDetail.length || state.hairDetail.length)) warnings.push(`–§–æ—Ä–º–∞—Ç ¬´${state.format}¬ª + —Ñ–æ—Ç–æ-–¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–∂–∏/–≤–æ–ª–æ—Å ‚Äî –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ.`);
          // Abstract purpose + portrait settings
          if (["Logo Design", "UI Design", "Infographic"].includes(state.purpose) && (state.skinDetail.length || state.hairDetail.length || state.photoStyle)) warnings.push(`–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ ¬´${state.purpose}¬ª + –ø–æ—Ä—Ç—Ä–µ—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Äî –Ω–µ—Ç–∏–ø–∏—á–Ω–æ.`);
          // Flat lay + wrong angle
          if (state.composition && state.composition.includes("flat lay") && state.angle && !state.angle.includes("drone") && !state.angle.includes("high angle") && !state.angle.includes("slightly high")) warnings.push("Flat Lay –æ–±—ã—á–Ω–æ —Å–Ω–∏–º–∞–µ—Ç—Å—è —Å–≤–µ—Ä—Ö—É ‚Äî —Ç–µ–∫—É—â–∏–π —É–≥–æ–ª –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º.");
          // Drone + studio light
          if (state.angle && state.angle.includes("drone") && state.lightType.primary && (state.lightType.primary.includes("studio") || state.lightType.primary.includes("softbox") || state.lightType.primary.includes("clamshell"))) warnings.push("–î—Ä–æ–Ω + —Å—Ç—É–¥–∏–π–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ ‚Äî –Ω–µ—Ç–∏–ø–∏—á–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è.");
          // Night + day conflict
          const todP = state.timeOfDay.primary || "";
          const todA = state.timeOfDay.accent || "";
          const hasNight = todP.includes("night") || todA.includes("night");
          const hasDay = todP.includes("midday") || todA.includes("midday") || todP.includes("golden") || todA.includes("golden") || todP.includes("overcast") || todA.includes("overcast");
          if (hasNight && hasDay) warnings.push("–ù–æ—á—å + –¥–Ω–µ–≤–Ω–æ–π —Å–≤–µ—Ç ‚Äî –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è.");
          // f/1.2 + extreme wide
          if (state.aperture && state.aperture.includes("f/1.2") && state.composition && state.composition.includes("extreme wide")) warnings.push("f/1.2 + –¥–∞–ª—å–Ω–∏–π –ø–ª–∞–Ω ‚Äî –Ω–µ—Ç–∏–ø–∏—á–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è (–æ–±—ã—á–Ω–æ f/8-f/16).");
          // beforeAfter + seamlessPattern
          if (state.beforeAfter && state.seamlessPattern) warnings.push("Before/After + Seamless Pattern ‚Äî –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏–µ —Ä–µ–∂–∏–º—ã.");
          // Generate4 + 3x3
          if (state.generateFourMode && state.grid3x3Mode) warnings.push("Generate 4 + 3√ó3 Contact Sheet ‚Äî –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏–µ —Ä–µ–∂–∏–º—ã.");
          // Skin/Hair boost with non-portrait formats
          if (state.skinRenderBoost && isArtistic) warnings.push("–£—Å–∏–ª–µ–Ω–Ω–∞—è –ø—Ä–æ—Ä–∏—Å–æ–≤–∫–∞ –∫–æ–∂–∏ –Ω–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å —Ñ–æ—Ä–º–∞—Ç–æ–º ¬´" + state.format + "¬ª.");
          if (state.hairRenderBoost && isArtistic) warnings.push("–£—Å–∏–ª–µ–Ω–Ω–∞—è –ø—Ä–æ—Ä–∏—Å–æ–≤–∫–∞ –≤–æ–ª–æ—Å –Ω–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å —Ñ–æ—Ä–º–∞—Ç–æ–º ¬´" + state.format + "¬ª.");
          // Consistency without reference images
          if (state.maxConsistency && !state.referenceImages.length) warnings.push("üîí –ú–∞–∫—Å. –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ –≤—Å–µ–≥–æ —Å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º–∏ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω—ã–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏.");
          // 3x3 + custom lens/angle/composition (if somehow still set)
          if (state.grid3x3Mode && (state.lens || state.angle || state.composition || state.aperture)) warnings.push("3√ó3 Contact Sheet –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç–∏–≤, —É–≥–æ–ª, –ø–ª–∞–Ω –∏ –¥–∏–∞—Ñ—Ä–∞–≥–º—É ‚Äî –≤–∞—à –≤—ã–±–æ—Ä –±—É–¥–µ—Ç –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω.");
          // Generate4/3x3 + beforeAfter/seamless
          if ((state.generateFourMode || state.grid3x3Mode) && (state.beforeAfter || state.seamlessPattern)) warnings.push("–†–µ–∂–∏–º –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º —Å Before/After –∏ Seamless Pattern.");

          const box = $("conflictWarnings");
          if (warnings.length) { box.style.display = "block"; box.innerHTML = "‚ö†Ô∏è <b>–í–æ–∑–º–æ–∂–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã:</b><br>" + warnings.map(w => "‚Ä¢ " + w).join("<br>") }
          else box.style.display = "none";
        }

        function safeCopy(text, label) {
          if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(text).then(function () {
              notify(label + " —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω");
            }).catch(function () {
              fallbackCopy(text, label);
            });
          } else {
            fallbackCopy(text, label);
          }
        }

        function fallbackCopy(text, label) {
          var ta = document.createElement("textarea");
          ta.value = text;
          ta.style.position = "fixed";
          ta.style.left = "-9999px";
          ta.style.top = "-9999px";
          ta.style.opacity = "0";
          document.body.appendChild(ta);
          ta.focus();
          ta.select();
          try {
            document.execCommand("copy");
            notify(label + " —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω");
          } catch (e) {
            notify("–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è", "err");
          }
          document.body.removeChild(ta);
        }

        function copyPrompt() {
          var text = $("promptOutput").textContent || "";
          if (!text.trim() || text.indexOf("Select parameters") >= 0 || text.indexOf("–í—ã–±–µ—Ä–∏—Ç–µ") >= 0) {
            notify("–°–Ω–∞—á–∞–ª–∞ —Å–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–º–ø—Ç", "warn"); return;
          }
          safeCopy(text, "–ü—Ä–æ–º–ø—Ç");
        }

        function copyJson() {
          try {
            var jsonData = buildJson();
            var text = JSON.stringify(jsonData, null, 2);
            if (!text || text === "{}" || text === "null") { notify("JSON –ø—É—Å—Ç", "warn"); return; }
            safeCopy(text, "JSON");
          } catch (e) {
            notify("–û—à–∏–±–∫–∞ JSON: " + e.message, "err");
          }
        }

        function savePrompt() {
          const text = $("promptOutput").textContent || "";
          if (!text.trim() || text.includes("Select parameters")) { notify("–ù–µ—á–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å", "warn"); return; }
          const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url; a.download = "vpe-prompt-" + Date.now() + ".txt"; a.click();
          URL.revokeObjectURL(url);
          notify("–§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—ë–Ω");
        }

        function resetAll() {
          // Reset state
          ["aiModel", "cameraBody", "aspectRatio", "resolution", "purpose", "format", "lens", "aperture", "angle", "composition", "quality", "referenceType", "photoStyle", "cinemaStyle", "directorStyle", "filmStock", "quickStyle", "mainSubject", "textContent", "negativePrompt"].forEach(k => state[k] = "");
          state.lightType = { primary: "", accent: "" };
          state.timeOfDay = { primary: "", accent: "" };
          state.lightFX = []; state.colorPalette = ""; state.skinDetail = []; state.hairDetail = []; state.material = []; state.typography = [];
          state.generateFourMode = false; state.grid3x3Mode = false; state.maxConsistency = false; state.beforeAfter = false; state.seamlessPattern = false; state.seed = "";
          state.mjVersion = "7"; state.mjStyle = ""; state.mjStylize = 250; state.mjChaos = 0; state.mjWeird = 0;
          state.sdCfg = 7; state.sdSteps = 25;
          state.fluxModel = "dev"; state.fluxGuidance = 3.5; state.fluxSteps = 28;
          state.dalleStyle = "vivid"; state.dalleQuality = "hd";
          state.skinRenderBoost = false; state.hairRenderBoost = false;
          state.referenceImages = []; state.referenceWeight = 50;
          state.promptFormat = "flat";

          // Reset inputs
          $("mainSubject").value = "";
          $("textContent").value = "";
          $("negativePrompt").value = "";
          $("generateFourMode").checked = false;
          $("grid3x3Mode").checked = false;
          $("maxConsistency").checked = false;
          $("skinRenderBoost").checked = false;
          $("hairRenderBoost").checked = false;
          $("lensSection").classList.remove("disabled-section");
          $("beforeAfter").checked = false;
          $("beforeAfter").disabled = false;
          $("seamlessPattern").checked = false;
          $("seamlessPattern").disabled = false;
          $("generateFourMode").disabled = false;
          $("grid3x3Mode").disabled = false;
          $("maxConsistency").disabled = false;
          $("skinRenderBoost").disabled = false;
          $("hairRenderBoost").disabled = false;
          $("seedInput").value = "";
          // Reset engine param sliders
          $("mjStylizeSlider").value = 250; $("mjStylizeVal").textContent = "250";
          $("mjChaosSlider").value = 0; $("mjChaosVal").textContent = "0";
          $("mjWeirdSlider").value = 0; $("mjWeirdVal").textContent = "0";
          $("sdCfgSlider").value = 7; $("sdCfgVal").textContent = "7";
          $("sdStepsSlider").value = 25; $("sdStepsVal").textContent = "25";
          $("fluxGuidanceSlider").value = 3.5; $("fluxGuidanceVal").textContent = "3.5";
          $("fluxStepsSlider").value = 28; $("fluxStepsVal").textContent = "28";
          $("referenceImages").value = "";
          $("refWeightSlider").value = 50;
          $("weightValue").textContent = "50";

          $("imagePreviewContainer").style.display = "none";
          $("referenceOptions").style.display = "none";
          $("referenceWeight").style.display = "none";
          $("imagePreviews").innerHTML = "";
          $("modelHint").style.display = "none";

          // Clear UI ‚Äî buttons, conflict states, toggle labels
          document.querySelectorAll(".option-btn[data-group]").forEach(b => {
            b.classList.remove("active", "conflict-disabled");
            b.disabled = false;
            b.title = "";
            b.querySelectorAll(".slot-tag").forEach(t => t.remove());
          });
          document.querySelectorAll(".toggle-label").forEach(l => {
            l.classList.remove("checked");
            l.style.opacity = "";
            l.title = "";
          });

          $("resolutionInfo").style.display = "block";
          $("resolutionOptions").style.display = "none";
          $("resolutionOptions").innerHTML = "";

          updateAll();
          notify("–í—Å—ë —Å–±—Ä–æ—à–µ–Ω–æ");
        }
      </script>
      <div class="notification success" id="notification">–í—Å—ë —Å–±—Ä–æ—à–µ–Ω–æ</div>


    </div>
  </div>




</body>

</html>